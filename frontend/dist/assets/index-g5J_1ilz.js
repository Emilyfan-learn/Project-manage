import{r as e,a as t,L as s,u as a,B as n,R as r,b as l,c as i}from"./react-vendor-CUU1aBPY.js";import{G as c}from"./chart-vendor-TVPKECDh.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var d={exports:{}},o={},x=e,m=Symbol.for("react.element"),u=Symbol.for("react.fragment"),p=Object.prototype.hasOwnProperty,h=x.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,g={key:!0,ref:!0,__self:!0,__source:!0};function j(e,t,s){var a,n={},r=null,l=null;for(a in void 0!==s&&(r=""+s),void 0!==t.key&&(r=""+t.key),void 0!==t.ref&&(l=t.ref),t)p.call(t,a)&&!g.hasOwnProperty(a)&&(n[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===n[a]&&(n[a]=t[a]);return{$$typeof:m,type:e,key:r,ref:l,props:n,_owner:h.current}}o.Fragment=u,o.jsx=j,o.jsxs=j,d.exports=o;var y=d.exports,f={},b=t;function v(e,t){return function(){return e.apply(t,arguments)}}f.createRoot=b.createRoot,f.hydrateRoot=b.hydrateRoot;const{toString:_}=Object.prototype,{getPrototypeOf:N}=Object,{iterator:w,toStringTag:k}=Symbol,S=(e=>t=>{const s=_.call(t);return e[s]||(e[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),C=e=>(e=e.toLowerCase(),t=>S(t)===e),E=e=>t=>typeof t===e,{isArray:O}=Array,D=E("undefined");function R(e){return null!==e&&!D(e)&&null!==e.constructor&&!D(e.constructor)&&P(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const F=C("ArrayBuffer");const T=E("string"),P=E("function"),$=E("number"),L=e=>null!==e&&"object"==typeof e,B=e=>{if("object"!==S(e))return!1;const t=N(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||k in e||w in e)},A=C("Date"),M=C("File"),I=C("Blob"),U=C("FileList"),W=C("URLSearchParams"),[H,q,z,J]=["ReadableStream","Request","Response","Headers"].map(C);function K(e,t,{allOwnKeys:s=!1}={}){if(null==e)return;let a,n;if("object"!=typeof e&&(e=[e]),O(e))for(a=0,n=e.length;a<n;a++)t.call(null,e[a],a,e);else{if(R(e))return;const n=s?Object.getOwnPropertyNames(e):Object.keys(e),r=n.length;let l;for(a=0;a<r;a++)l=n[a],t.call(null,e[l],l,e)}}function Y(e,t){if(R(e))return null;t=t.toLowerCase();const s=Object.keys(e);let a,n=s.length;for(;n-- >0;)if(a=s[n],t===a.toLowerCase())return a;return null}const V="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,G=e=>!D(e)&&e!==V;const X=(e=>t=>e&&t instanceof e)("undefined"!=typeof Uint8Array&&N(Uint8Array)),Q=C("HTMLFormElement"),Z=(({hasOwnProperty:e})=>(t,s)=>e.call(t,s))(Object.prototype),ee=C("RegExp"),te=(e,t)=>{const s=Object.getOwnPropertyDescriptors(e),a={};K(s,(s,n)=>{let r;!1!==(r=t(s,n,e))&&(a[n]=r||s)}),Object.defineProperties(e,a)};const se=C("AsyncFunction"),ae=(ne="function"==typeof setImmediate,re=P(V.postMessage),ne?setImmediate:re?(le=`axios@${Math.random()}`,ie=[],V.addEventListener("message",({source:e,data:t})=>{e===V&&t===le&&ie.length&&ie.shift()()},!1),e=>{ie.push(e),V.postMessage(le,"*")}):e=>setTimeout(e));var ne,re,le,ie;const ce="undefined"!=typeof queueMicrotask?queueMicrotask.bind(V):"undefined"!=typeof process&&process.nextTick||ae,de={isArray:O,isArrayBuffer:F,isBuffer:R,isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||P(e.append)&&("formdata"===(t=S(e))||"object"===t&&P(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&F(e.buffer),t},isString:T,isNumber:$,isBoolean:e=>!0===e||!1===e,isObject:L,isPlainObject:B,isEmptyObject:e=>{if(!L(e)||R(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(t){return!1}},isReadableStream:H,isRequest:q,isResponse:z,isHeaders:J,isUndefined:D,isDate:A,isFile:M,isBlob:I,isRegExp:ee,isFunction:P,isStream:e=>L(e)&&P(e.pipe),isURLSearchParams:W,isTypedArray:X,isFileList:U,forEach:K,merge:function e(){const{caseless:t,skipUndefined:s}=G(this)&&this||{},a={},n=(n,r)=>{const l=t&&Y(a,r)||r;B(a[l])&&B(n)?a[l]=e(a[l],n):B(n)?a[l]=e({},n):O(n)?a[l]=n.slice():s&&D(n)||(a[l]=n)};for(let r=0,l=arguments.length;r<l;r++)arguments[r]&&K(arguments[r],n);return a},extend:(e,t,s,{allOwnKeys:a}={})=>(K(t,(t,a)=>{s&&P(t)?e[a]=v(t,s):e[a]=t},{allOwnKeys:a}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,s,a)=>{e.prototype=Object.create(t.prototype,a),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),s&&Object.assign(e.prototype,s)},toFlatObject:(e,t,s,a)=>{let n,r,l;const i={};if(t=t||{},null==e)return t;do{for(n=Object.getOwnPropertyNames(e),r=n.length;r-- >0;)l=n[r],a&&!a(l,e,t)||i[l]||(t[l]=e[l],i[l]=!0);e=!1!==s&&N(e)}while(e&&(!s||s(e,t))&&e!==Object.prototype);return t},kindOf:S,kindOfTest:C,endsWith:(e,t,s)=>{e=String(e),(void 0===s||s>e.length)&&(s=e.length),s-=t.length;const a=e.indexOf(t,s);return-1!==a&&a===s},toArray:e=>{if(!e)return null;if(O(e))return e;let t=e.length;if(!$(t))return null;const s=new Array(t);for(;t-- >0;)s[t]=e[t];return s},forEachEntry:(e,t)=>{const s=(e&&e[w]).call(e);let a;for(;(a=s.next())&&!a.done;){const s=a.value;t.call(e,s[0],s[1])}},matchAll:(e,t)=>{let s;const a=[];for(;null!==(s=e.exec(t));)a.push(s);return a},isHTMLForm:Q,hasOwnProperty:Z,hasOwnProp:Z,reduceDescriptors:te,freezeMethods:e=>{te(e,(t,s)=>{if(P(e)&&-1!==["arguments","caller","callee"].indexOf(s))return!1;const a=e[s];P(a)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(e,t)=>{const s={},a=e=>{e.forEach(e=>{s[e]=!0})};return O(e)?a(e):a(String(e).split(t)),s},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,s){return t.toUpperCase()+s}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Y,global:V,isContextDefined:G,isSpecCompliantForm:function(e){return!!(e&&P(e.append)&&"FormData"===e[k]&&e[w])},toJSONObject:e=>{const t=new Array(10),s=(e,a)=>{if(L(e)){if(t.indexOf(e)>=0)return;if(R(e))return e;if(!("toJSON"in e)){t[a]=e;const n=O(e)?[]:{};return K(e,(e,t)=>{const r=s(e,a+1);!D(r)&&(n[t]=r)}),t[a]=void 0,n}}return e};return s(e,0)},isAsyncFn:se,isThenable:e=>e&&(L(e)||P(e))&&P(e.then)&&P(e.catch),setImmediate:ae,asap:ce,isIterable:e=>null!=e&&P(e[w])};function oe(e,t,s,a,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),s&&(this.config=s),a&&(this.request=a),n&&(this.response=n,this.status=n.status?n.status:null)}de.inherits(oe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:de.toJSONObject(this.config),code:this.code,status:this.status}}});const xe=oe.prototype,me={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{me[e]={value:e}}),Object.defineProperties(oe,me),Object.defineProperty(xe,"isAxiosError",{value:!0}),oe.from=(e,t,s,a,n,r)=>{const l=Object.create(xe);de.toFlatObject(e,l,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e);const i=e&&e.message?e.message:"Error",c=null==t&&e?e.code:t;return oe.call(l,i,c,s,a,n),e&&null==l.cause&&Object.defineProperty(l,"cause",{value:e,configurable:!0}),l.name=e&&e.name||"Error",r&&Object.assign(l,r),l};function ue(e){return de.isPlainObject(e)||de.isArray(e)}function pe(e){return de.endsWith(e,"[]")?e.slice(0,-2):e}function he(e,t,s){return e?e.concat(t).map(function(e,t){return e=pe(e),!s&&t?"["+e+"]":e}).join(s?".":""):t}const ge=de.toFlatObject(de,{},null,function(e){return/^is[A-Z]/.test(e)});function je(e,t,s){if(!de.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const a=(s=de.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!de.isUndefined(t[e])})).metaTokens,n=s.visitor||d,r=s.dots,l=s.indexes,i=(s.Blob||"undefined"!=typeof Blob&&Blob)&&de.isSpecCompliantForm(t);if(!de.isFunction(n))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(de.isDate(e))return e.toISOString();if(de.isBoolean(e))return e.toString();if(!i&&de.isBlob(e))throw new oe("Blob is not supported. Use a Buffer instead.");return de.isArrayBuffer(e)||de.isTypedArray(e)?i&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function d(e,s,n){let i=e;if(e&&!n&&"object"==typeof e)if(de.endsWith(s,"{}"))s=a?s:s.slice(0,-2),e=JSON.stringify(e);else if(de.isArray(e)&&function(e){return de.isArray(e)&&!e.some(ue)}(e)||(de.isFileList(e)||de.endsWith(s,"[]"))&&(i=de.toArray(e)))return s=pe(s),i.forEach(function(e,a){!de.isUndefined(e)&&null!==e&&t.append(!0===l?he([s],a,r):null===l?s:s+"[]",c(e))}),!1;return!!ue(e)||(t.append(he(n,s,r),c(e)),!1)}const o=[],x=Object.assign(ge,{defaultVisitor:d,convertValue:c,isVisitable:ue});if(!de.isObject(e))throw new TypeError("data must be an object");return function e(s,a){if(!de.isUndefined(s)){if(-1!==o.indexOf(s))throw Error("Circular reference detected in "+a.join("."));o.push(s),de.forEach(s,function(s,r){!0===(!(de.isUndefined(s)||null===s)&&n.call(t,s,de.isString(r)?r.trim():r,a,x))&&e(s,a?a.concat(r):[r])}),o.pop()}}(e),t}function ye(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function fe(e,t){this._pairs=[],e&&je(e,this,t)}const be=fe.prototype;function ve(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function _e(e,t,s){if(!t)return e;const a=s&&s.encode||ve;de.isFunction(s)&&(s={serialize:s});const n=s&&s.serialize;let r;if(r=n?n(t,s):de.isURLSearchParams(t)?t.toString():new fe(t,s).toString(a),r){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e}be.append=function(e,t){this._pairs.push([e,t])},be.toString=function(e){const t=e?function(t){return e.call(this,t,ye)}:ye;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};class Ne{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){de.forEach(this.handlers,function(t){null!==t&&e(t)})}}const we={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ke={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:fe,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Se="undefined"!=typeof window&&"undefined"!=typeof document,Ce="object"==typeof navigator&&navigator||void 0,Ee=Se&&(!Ce||["ReactNative","NativeScript","NS"].indexOf(Ce.product)<0),Oe="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,De=Se&&window.location.href||"http://localhost",Re={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Se,hasStandardBrowserEnv:Ee,hasStandardBrowserWebWorkerEnv:Oe,navigator:Ce,origin:De},Symbol.toStringTag,{value:"Module"})),...ke};function Fe(e){function t(e,s,a,n){let r=e[n++];if("__proto__"===r)return!0;const l=Number.isFinite(+r),i=n>=e.length;if(r=!r&&de.isArray(a)?a.length:r,i)return de.hasOwnProp(a,r)?a[r]=[a[r],s]:a[r]=s,!l;a[r]&&de.isObject(a[r])||(a[r]=[]);return t(e,s,a[r],n)&&de.isArray(a[r])&&(a[r]=function(e){const t={},s=Object.keys(e);let a;const n=s.length;let r;for(a=0;a<n;a++)r=s[a],t[r]=e[r];return t}(a[r])),!l}if(de.isFormData(e)&&de.isFunction(e.entries)){const s={};return de.forEachEntry(e,(e,a)=>{t(function(e){return de.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),a,s,0)}),s}return null}const Te={transitional:we,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",a=s.indexOf("application/json")>-1,n=de.isObject(e);n&&de.isHTMLForm(e)&&(e=new FormData(e));if(de.isFormData(e))return a?JSON.stringify(Fe(e)):e;if(de.isArrayBuffer(e)||de.isBuffer(e)||de.isStream(e)||de.isFile(e)||de.isBlob(e)||de.isReadableStream(e))return e;if(de.isArrayBufferView(e))return e.buffer;if(de.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let r;if(n){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return je(e,new Re.classes.URLSearchParams,{visitor:function(e,t,s,a){return Re.isNode&&de.isBuffer(e)?(this.append(t,e.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)},...t})}(e,this.formSerializer).toString();if((r=de.isFileList(e))||s.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return je(r?{"files[]":e}:e,t&&new t,this.formSerializer)}}return n||a?(t.setContentType("application/json",!1),function(e,t,s){if(de.isString(e))try{return(t||JSON.parse)(e),de.trim(e)}catch(a){if("SyntaxError"!==a.name)throw a}return(s||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Te.transitional,s=t&&t.forcedJSONParsing,a="json"===this.responseType;if(de.isResponse(e)||de.isReadableStream(e))return e;if(e&&de.isString(e)&&(s&&!this.responseType||a)){const s=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e,this.parseReviver)}catch(n){if(s){if("SyntaxError"===n.name)throw oe.from(n,oe.ERR_BAD_RESPONSE,this,null,this.response);throw n}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Re.classes.FormData,Blob:Re.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};de.forEach(["delete","get","head","post","put","patch"],e=>{Te.headers[e]={}});const Pe=de.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),$e=Symbol("internals");function Le(e){return e&&String(e).trim().toLowerCase()}function Be(e){return!1===e||null==e?e:de.isArray(e)?e.map(Be):String(e)}function Ae(e,t,s,a,n){return de.isFunction(a)?a.call(this,t,s):(n&&(t=s),de.isString(t)?de.isString(a)?-1!==t.indexOf(a):de.isRegExp(a)?a.test(t):void 0:void 0)}let Me=class{constructor(e){e&&this.set(e)}set(e,t,s){const a=this;function n(e,t,s){const n=Le(t);if(!n)throw new Error("header name must be a non-empty string");const r=de.findKey(a,n);(!r||void 0===a[r]||!0===s||void 0===s&&!1!==a[r])&&(a[r||t]=Be(e))}const r=(e,t)=>de.forEach(e,(e,s)=>n(e,s,t));if(de.isPlainObject(e)||e instanceof this.constructor)r(e,t);else if(de.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))r((e=>{const t={};let s,a,n;return e&&e.split("\n").forEach(function(e){n=e.indexOf(":"),s=e.substring(0,n).trim().toLowerCase(),a=e.substring(n+1).trim(),!s||t[s]&&Pe[s]||("set-cookie"===s?t[s]?t[s].push(a):t[s]=[a]:t[s]=t[s]?t[s]+", "+a:a)}),t})(e),t);else if(de.isObject(e)&&de.isIterable(e)){let s,a,n={};for(const t of e){if(!de.isArray(t))throw TypeError("Object iterator must return a key-value pair");n[a=t[0]]=(s=n[a])?de.isArray(s)?[...s,t[1]]:[s,t[1]]:t[1]}r(n,t)}else null!=e&&n(t,e,s);return this}get(e,t){if(e=Le(e)){const s=de.findKey(this,e);if(s){const e=this[s];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let a;for(;a=s.exec(e);)t[a[1]]=a[2];return t}(e);if(de.isFunction(t))return t.call(this,e,s);if(de.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Le(e)){const s=de.findKey(this,e);return!(!s||void 0===this[s]||t&&!Ae(0,this[s],s,t))}return!1}delete(e,t){const s=this;let a=!1;function n(e){if(e=Le(e)){const n=de.findKey(s,e);!n||t&&!Ae(0,s[n],n,t)||(delete s[n],a=!0)}}return de.isArray(e)?e.forEach(n):n(e),a}clear(e){const t=Object.keys(this);let s=t.length,a=!1;for(;s--;){const n=t[s];e&&!Ae(0,this[n],n,e,!0)||(delete this[n],a=!0)}return a}normalize(e){const t=this,s={};return de.forEach(this,(a,n)=>{const r=de.findKey(s,n);if(r)return t[r]=Be(a),void delete t[n];const l=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}(n):String(n).trim();l!==n&&delete t[n],t[l]=Be(a),s[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return de.forEach(this,(s,a)=>{null!=s&&!1!==s&&(t[a]=e&&de.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(e=>s.set(e)),s}static accessor(e){const t=(this[$e]=this[$e]={accessors:{}}).accessors,s=this.prototype;function a(e){const a=Le(e);t[a]||(!function(e,t){const s=de.toCamelCase(" "+t);["get","set","has"].forEach(a=>{Object.defineProperty(e,a+s,{value:function(e,s,n){return this[a].call(this,t,e,s,n)},configurable:!0})})}(s,e),t[a]=!0)}return de.isArray(e)?e.forEach(a):a(e),this}};function Ie(e,t){const s=this||Te,a=t||s,n=Me.from(a.headers);let r=a.data;return de.forEach(e,function(e){r=e.call(s,r,n.normalize(),t?t.status:void 0)}),n.normalize(),r}function Ue(e){return!(!e||!e.__CANCEL__)}function We(e,t,s){oe.call(this,null==e?"canceled":e,oe.ERR_CANCELED,t,s),this.name="CanceledError"}function He(e,t,s){const a=s.config.validateStatus;s.status&&a&&!a(s.status)?t(new oe("Request failed with status code "+s.status,[oe.ERR_BAD_REQUEST,oe.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):e(s)}Me.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),de.reduceDescriptors(Me.prototype,({value:e},t)=>{let s=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[s]=e}}}),de.freezeMethods(Me),de.inherits(We,oe,{__CANCEL__:!0});const qe=(e,t,s=3)=>{let a=0;const n=function(e,t){e=e||10;const s=new Array(e),a=new Array(e);let n,r=0,l=0;return t=void 0!==t?t:1e3,function(i){const c=Date.now(),d=a[l];n||(n=c),s[r]=i,a[r]=c;let o=l,x=0;for(;o!==r;)x+=s[o++],o%=e;if(r=(r+1)%e,r===l&&(l=(l+1)%e),c-n<t)return;const m=d&&c-d;return m?Math.round(1e3*x/m):void 0}}(50,250);return function(e,t){let s,a,n=0,r=1e3/t;const l=(t,r=Date.now())=>{n=r,s=null,a&&(clearTimeout(a),a=null),e(...t)};return[(...e)=>{const t=Date.now(),i=t-n;i>=r?l(e,t):(s=e,a||(a=setTimeout(()=>{a=null,l(s)},r-i)))},()=>s&&l(s)]}(s=>{const r=s.loaded,l=s.lengthComputable?s.total:void 0,i=r-a,c=n(i);a=r;e({loaded:r,total:l,progress:l?r/l:void 0,bytes:i,rate:c||void 0,estimated:c&&l&&r<=l?(l-r)/c:void 0,event:s,lengthComputable:null!=l,[t?"download":"upload"]:!0})},s)},ze=(e,t)=>{const s=null!=e;return[a=>t[0]({lengthComputable:s,total:e,loaded:a}),t[1]]},Je=e=>(...t)=>de.asap(()=>e(...t)),Ke=Re.hasStandardBrowserEnv?((e,t)=>s=>(s=new URL(s,Re.origin),e.protocol===s.protocol&&e.host===s.host&&(t||e.port===s.port)))(new URL(Re.origin),Re.navigator&&/(msie|trident)/i.test(Re.navigator.userAgent)):()=>!0,Ye=Re.hasStandardBrowserEnv?{write(e,t,s,a,n,r,l){if("undefined"==typeof document)return;const i=[`${e}=${encodeURIComponent(t)}`];de.isNumber(s)&&i.push(`expires=${new Date(s).toUTCString()}`),de.isString(a)&&i.push(`path=${a}`),de.isString(n)&&i.push(`domain=${n}`),!0===r&&i.push("secure"),de.isString(l)&&i.push(`SameSite=${l}`),document.cookie=i.join("; ")},read(e){if("undefined"==typeof document)return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function Ve(e,t,s){let a=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(a||0==s)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Ge=e=>e instanceof Me?{...e}:e;function Xe(e,t){t=t||{};const s={};function a(e,t,s,a){return de.isPlainObject(e)&&de.isPlainObject(t)?de.merge.call({caseless:a},e,t):de.isPlainObject(t)?de.merge({},t):de.isArray(t)?t.slice():t}function n(e,t,s,n){return de.isUndefined(t)?de.isUndefined(e)?void 0:a(void 0,e,0,n):a(e,t,0,n)}function r(e,t){if(!de.isUndefined(t))return a(void 0,t)}function l(e,t){return de.isUndefined(t)?de.isUndefined(e)?void 0:a(void 0,e):a(void 0,t)}function i(s,n,r){return r in t?a(s,n):r in e?a(void 0,s):void 0}const c={url:r,method:r,data:r,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:i,headers:(e,t,s)=>n(Ge(e),Ge(t),0,!0)};return de.forEach(Object.keys({...e,...t}),function(a){const r=c[a]||n,l=r(e[a],t[a],a);de.isUndefined(l)&&r!==i||(s[a]=l)}),s}const Qe=e=>{const t=Xe({},e);let{data:s,withXSRFToken:a,xsrfHeaderName:n,xsrfCookieName:r,headers:l,auth:i}=t;if(t.headers=l=Me.from(l),t.url=_e(Ve(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),i&&l.set("Authorization","Basic "+btoa((i.username||"")+":"+(i.password?unescape(encodeURIComponent(i.password)):""))),de.isFormData(s))if(Re.hasStandardBrowserEnv||Re.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if(de.isFunction(s.getHeaders)){const e=s.getHeaders(),t=["content-type","content-length"];Object.entries(e).forEach(([e,s])=>{t.includes(e.toLowerCase())&&l.set(e,s)})}if(Re.hasStandardBrowserEnv&&(a&&de.isFunction(a)&&(a=a(t)),a||!1!==a&&Ke(t.url))){const e=n&&r&&Ye.read(r);e&&l.set(n,e)}return t},Ze="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise(function(t,s){const a=Qe(e);let n=a.data;const r=Me.from(a.headers).normalize();let l,i,c,d,o,{responseType:x,onUploadProgress:m,onDownloadProgress:u}=a;function p(){d&&d(),o&&o(),a.cancelToken&&a.cancelToken.unsubscribe(l),a.signal&&a.signal.removeEventListener("abort",l)}let h=new XMLHttpRequest;function g(){if(!h)return;const a=Me.from("getAllResponseHeaders"in h&&h.getAllResponseHeaders());He(function(e){t(e),p()},function(e){s(e),p()},{data:x&&"text"!==x&&"json"!==x?h.response:h.responseText,status:h.status,statusText:h.statusText,headers:a,config:e,request:h}),h=null}h.open(a.method.toUpperCase(),a.url,!0),h.timeout=a.timeout,"onloadend"in h?h.onloadend=g:h.onreadystatechange=function(){h&&4===h.readyState&&(0!==h.status||h.responseURL&&0===h.responseURL.indexOf("file:"))&&setTimeout(g)},h.onabort=function(){h&&(s(new oe("Request aborted",oe.ECONNABORTED,e,h)),h=null)},h.onerror=function(t){const a=new oe(t&&t.message?t.message:"Network Error",oe.ERR_NETWORK,e,h);a.event=t||null,s(a),h=null},h.ontimeout=function(){let t=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const n=a.transitional||we;a.timeoutErrorMessage&&(t=a.timeoutErrorMessage),s(new oe(t,n.clarifyTimeoutError?oe.ETIMEDOUT:oe.ECONNABORTED,e,h)),h=null},void 0===n&&r.setContentType(null),"setRequestHeader"in h&&de.forEach(r.toJSON(),function(e,t){h.setRequestHeader(t,e)}),de.isUndefined(a.withCredentials)||(h.withCredentials=!!a.withCredentials),x&&"json"!==x&&(h.responseType=a.responseType),u&&([c,o]=qe(u,!0),h.addEventListener("progress",c)),m&&h.upload&&([i,d]=qe(m),h.upload.addEventListener("progress",i),h.upload.addEventListener("loadend",d)),(a.cancelToken||a.signal)&&(l=t=>{h&&(s(!t||t.type?new We(null,e,h):t),h.abort(),h=null)},a.cancelToken&&a.cancelToken.subscribe(l),a.signal&&(a.signal.aborted?l():a.signal.addEventListener("abort",l)));const j=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(a.url);j&&-1===Re.protocols.indexOf(j)?s(new oe("Unsupported protocol "+j+":",oe.ERR_BAD_REQUEST,e)):h.send(n||null)})},et=(e,t)=>{const{length:s}=e=e?e.filter(Boolean):[];if(t||s){let s,a=new AbortController;const n=function(e){if(!s){s=!0,l();const t=e instanceof Error?e:this.reason;a.abort(t instanceof oe?t:new We(t instanceof Error?t.message:t))}};let r=t&&setTimeout(()=>{r=null,n(new oe(`timeout ${t} of ms exceeded`,oe.ETIMEDOUT))},t);const l=()=>{e&&(r&&clearTimeout(r),r=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(n):e.removeEventListener("abort",n)}),e=null)};e.forEach(e=>e.addEventListener("abort",n));const{signal:i}=a;return i.unsubscribe=()=>de.asap(l),i}},tt=function*(e,t){let s=e.byteLength;if(s<t)return void(yield e);let a,n=0;for(;n<s;)a=n+t,yield e.slice(n,a),n=a},st=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},at=(e,t,s,a)=>{const n=async function*(e,t){for await(const s of st(e))yield*tt(s,t)}(e,t);let r,l=0,i=e=>{r||(r=!0,a&&a(e))};return new ReadableStream({async pull(e){try{const{done:t,value:a}=await n.next();if(t)return i(),void e.close();let r=a.byteLength;if(s){let e=l+=r;s(e)}e.enqueue(new Uint8Array(a))}catch(t){throw i(t),t}},cancel:e=>(i(e),n.return())},{highWaterMark:2})},{isFunction:nt}=de,rt=(({Request:e,Response:t})=>({Request:e,Response:t}))(de.global),{ReadableStream:lt,TextEncoder:it}=de.global,ct=(e,...t)=>{try{return!!e(...t)}catch(s){return!1}},dt=e=>{e=de.merge.call({skipUndefined:!0},rt,e);const{fetch:t,Request:s,Response:a}=e,n=t?nt(t):"function"==typeof fetch,r=nt(s),l=nt(a);if(!n)return!1;const i=n&&nt(lt),c=n&&("function"==typeof it?(e=>t=>e.encode(t))(new it):async e=>new Uint8Array(await new s(e).arrayBuffer())),d=r&&i&&ct(()=>{let e=!1;const t=new s(Re.origin,{body:new lt,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),o=l&&i&&ct(()=>de.isReadableStream(new a("").body)),x={stream:o&&(e=>e.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!x[e]&&(x[e]=(t,s)=>{let a=t&&t[e];if(a)return a.call(t);throw new oe(`Response type '${e}' is not supported`,oe.ERR_NOT_SUPPORT,s)})});const m=async(e,t)=>{const a=de.toFiniteNumber(e.getContentLength());return null==a?(async e=>{if(null==e)return 0;if(de.isBlob(e))return e.size;if(de.isSpecCompliantForm(e)){const t=new s(Re.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return de.isArrayBufferView(e)||de.isArrayBuffer(e)?e.byteLength:(de.isURLSearchParams(e)&&(e+=""),de.isString(e)?(await c(e)).byteLength:void 0)})(t):a};return async e=>{let{url:n,method:l,data:i,signal:c,cancelToken:u,timeout:p,onDownloadProgress:h,onUploadProgress:g,responseType:j,headers:y,withCredentials:f="same-origin",fetchOptions:b}=Qe(e),v=t||fetch;j=j?(j+"").toLowerCase():"text";let _=et([c,u&&u.toAbortSignal()],p),N=null;const w=_&&_.unsubscribe&&(()=>{_.unsubscribe()});let k;try{if(g&&d&&"get"!==l&&"head"!==l&&0!==(k=await m(y,i))){let e,t=new s(n,{method:"POST",body:i,duplex:"half"});if(de.isFormData(i)&&(e=t.headers.get("content-type"))&&y.setContentType(e),t.body){const[e,s]=ze(k,qe(Je(g)));i=at(t.body,65536,e,s)}}de.isString(f)||(f=f?"include":"omit");const t=r&&"credentials"in s.prototype,c={...b,signal:_,method:l.toUpperCase(),headers:y.normalize().toJSON(),body:i,duplex:"half",credentials:t?f:void 0};N=r&&new s(n,c);let u=await(r?v(N,b):v(n,c));const p=o&&("stream"===j||"response"===j);if(o&&(h||p&&w)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=u[t]});const t=de.toFiniteNumber(u.headers.get("content-length")),[s,n]=h&&ze(t,qe(Je(h),!0))||[];u=new a(at(u.body,65536,s,()=>{n&&n(),w&&w()}),e)}j=j||"text";let S=await x[de.findKey(x,j)||"text"](u,e);return!p&&w&&w(),await new Promise((t,s)=>{He(t,s,{data:S,headers:Me.from(u.headers),status:u.status,statusText:u.statusText,config:e,request:N})})}catch(S){if(w&&w(),S&&"TypeError"===S.name&&/Load failed|fetch/i.test(S.message))throw Object.assign(new oe("Network Error",oe.ERR_NETWORK,e,N),{cause:S.cause||S});throw oe.from(S,S&&S.code,e,N)}}},ot=new Map,xt=e=>{let t=e&&e.env||{};const{fetch:s,Request:a,Response:n}=t,r=[a,n,s];let l,i,c=r.length,d=ot;for(;c--;)l=r[c],i=d.get(l),void 0===i&&d.set(l,i=c?new Map:dt(t)),d=i;return i};xt();const mt={http:null,xhr:Ze,fetch:{get:xt}};de.forEach(mt,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(s){}Object.defineProperty(e,"adapterName",{value:t})}});const ut=e=>`- ${e}`,pt=e=>de.isFunction(e)||null===e||!1===e;const ht={getAdapter:function(e,t){e=de.isArray(e)?e:[e];const{length:s}=e;let a,n;const r={};for(let l=0;l<s;l++){let s;if(a=e[l],n=a,!pt(a)&&(n=mt[(s=String(a)).toLowerCase()],void 0===n))throw new oe(`Unknown adapter '${s}'`);if(n&&(de.isFunction(n)||(n=n.get(t))))break;r[s||"#"+l]=n}if(!n){const e=Object.entries(r).map(([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build"));throw new oe("There is no suitable adapter to dispatch the request "+(s?e.length>1?"since :\n"+e.map(ut).join("\n"):" "+ut(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n},adapters:mt};function gt(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new We(null,e)}function jt(e){gt(e),e.headers=Me.from(e.headers),e.data=Ie.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return ht.getAdapter(e.adapter||Te.adapter,e)(e).then(function(t){return gt(e),t.data=Ie.call(e,e.transformResponse,t),t.headers=Me.from(t.headers),t},function(t){return Ue(t)||(gt(e),t&&t.response&&(t.response.data=Ie.call(e,e.transformResponse,t.response),t.response.headers=Me.from(t.response.headers))),Promise.reject(t)})}const yt="1.13.2",ft={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{ft[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}});const bt={};ft.transitional=function(e,t,s){function a(e,t){return"[Axios v"+yt+"] Transitional option '"+e+"'"+t+(s?". "+s:"")}return(s,n,r)=>{if(!1===e)throw new oe(a(n," has been removed"+(t?" in "+t:"")),oe.ERR_DEPRECATED);return t&&!bt[n]&&(bt[n]=!0,console.warn(a(n," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(s,n,r)}},ft.spelling=function(e){return(t,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};const vt={assertOptions:function(e,t,s){if("object"!=typeof e)throw new oe("options must be an object",oe.ERR_BAD_OPTION_VALUE);const a=Object.keys(e);let n=a.length;for(;n-- >0;){const r=a[n],l=t[r];if(l){const t=e[r],s=void 0===t||l(t,r,e);if(!0!==s)throw new oe("option "+r+" must be "+s,oe.ERR_BAD_OPTION_VALUE);continue}if(!0!==s)throw new oe("Unknown option "+r,oe.ERR_BAD_OPTION)}},validators:ft},_t=vt.validators;let Nt=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Ne,response:new Ne}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{s.stack?t&&!String(s.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(s.stack+="\n"+t):s.stack=t}catch(a){}}throw s}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Xe(this.defaults,t);const{transitional:s,paramsSerializer:a,headers:n}=t;void 0!==s&&vt.assertOptions(s,{silentJSONParsing:_t.transitional(_t.boolean),forcedJSONParsing:_t.transitional(_t.boolean),clarifyTimeoutError:_t.transitional(_t.boolean)},!1),null!=a&&(de.isFunction(a)?t.paramsSerializer={serialize:a}:vt.assertOptions(a,{encode:_t.function,serialize:_t.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),vt.assertOptions(t,{baseUrl:_t.spelling("baseURL"),withXsrfToken:_t.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let r=n&&de.merge(n.common,n[t.method]);n&&de.forEach(["delete","get","head","post","put","patch","common"],e=>{delete n[e]}),t.headers=Me.concat(r,n);const l=[];let i=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,l.unshift(e.fulfilled,e.rejected))});const c=[];let d;this.interceptors.response.forEach(function(e){c.push(e.fulfilled,e.rejected)});let o,x=0;if(!i){const e=[jt.bind(this),void 0];for(e.unshift(...l),e.push(...c),o=e.length,d=Promise.resolve(t);x<o;)d=d.then(e[x++],e[x++]);return d}o=l.length;let m=t;for(;x<o;){const e=l[x++],t=l[x++];try{m=e(m)}catch(u){t.call(this,u);break}}try{d=jt.call(this,m)}catch(u){return Promise.reject(u)}for(x=0,o=c.length;x<o;)d=d.then(c[x++],c[x++]);return d}getUri(e){return _e(Ve((e=Xe(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};de.forEach(["delete","get","head","options"],function(e){Nt.prototype[e]=function(t,s){return this.request(Xe(s||{},{method:e,url:t,data:(s||{}).data}))}}),de.forEach(["post","put","patch"],function(e){function t(t){return function(s,a,n){return this.request(Xe(n||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:s,data:a}))}}Nt.prototype[e]=t(),Nt.prototype[e+"Form"]=t(!0)});const wt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(wt).forEach(([e,t])=>{wt[t]=e});const kt=function e(t){const s=new Nt(t),a=v(Nt.prototype.request,s);return de.extend(a,Nt.prototype,s,{allOwnKeys:!0}),de.extend(a,s,null,{allOwnKeys:!0}),a.create=function(s){return e(Xe(t,s))},a}(Te);kt.Axios=Nt,kt.CanceledError=We,kt.CancelToken=class e{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const s=this;this.promise.then(e=>{if(!s._listeners)return;let t=s._listeners.length;for(;t-- >0;)s._listeners[t](e);s._listeners=null}),this.promise.then=e=>{let t;const a=new Promise(e=>{s.subscribe(e),t=e}).then(e);return a.cancel=function(){s.unsubscribe(t)},a},e(function(e,a,n){s.reason||(s.reason=new We(e,a,n),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let t;return{token:new e(function(e){t=e}),cancel:t}}},kt.isCancel=Ue,kt.VERSION=yt,kt.toFormData=je,kt.AxiosError=oe,kt.Cancel=kt.CanceledError,kt.all=function(e){return Promise.all(e)},kt.spread=function(e){return function(t){return e.apply(null,t)}},kt.isAxiosError=function(e){return de.isObject(e)&&!0===e.isAxiosError},kt.mergeConfig=Xe,kt.AxiosHeaders=Me,kt.formToJSON=e=>Fe(de.isHTMLForm(e)?new FormData(e):e),kt.getAdapter=ht.getAdapter,kt.HttpStatusCode=wt,kt.default=kt;const{Axios:St,AxiosError:Ct,CanceledError:Et,isCancel:Ot,CancelToken:Dt,VERSION:Rt,all:Ft,Cancel:Tt,isAxiosError:Pt,spread:$t,toFormData:Lt,AxiosHeaders:Bt,HttpStatusCode:At,formToJSON:Mt,getAdapter:It,mergeConfig:Ut}=kt,Wt=kt.create({baseURL:"/api",timeout:1e4,headers:{"Content-Type":"application/json"}});Wt.interceptors.request.use(e=>e,e=>Promise.reject(e)),Wt.interceptors.response.use(e=>e.data,e=>{var t,s;const a=(null==(s=null==(t=e.response)?void 0:t.data)?void 0:s.detail)||e.message||"An error occurred";return Promise.reject(new Error(a))});const Ht=()=>{const[t,a]=e.useState({projects:{total:0,active:0},wbs:{total:0,completed:0,inProgress:0,notStarted:0,overdue:0},pending:{total:0,pending:0,inProgress:0,completed:0,overdue:0},issues:{total:0,open:0,inProgress:0,resolved:0,critical:0},dependencies:{total:0,active:0}}),[n,r]=e.useState([]),[l,i]=e.useState([]),[c,d]=e.useState([]),[o,x]=e.useState([]),[m,u]=e.useState(!0),[p,h]=e.useState(null);e.useEffect(()=>{g()},[]);const g=async()=>{var e;u(!0),h(null);try{const[t,s,n,l,c]=await Promise.all([Wt.get("/projects/"),Wt.get("/wbs/",{params:{limit:1e3}}),Wt.get("/pending/",{params:{limit:1e3}}),Wt.get("/issues/",{params:{limit:1e3}}),Wt.get("/dependencies/").catch(()=>({items:[],total:0}))]),o=(null==(e=t.items)?void 0:e.filter(e=>"Active"===e.status||"ÈÄ≤Ë°å‰∏≠"===e.status).length)||0,m=s.items||[],u=m.filter(e=>"Â∑≤ÂÆåÊàê"===e.status).length,p=m.filter(e=>"ÈÄ≤Ë°å‰∏≠"===e.status).length,h=m.filter(e=>"Êú™ÈñãÂßã"===e.status).length,g=m.filter(e=>e.is_overdue&&"Â∑≤ÂÆåÊàê"!==e.status).length,j=n.items||[],y=j.filter(e=>"ÂæÖËôïÁêÜ"===e.status).length,f=j.filter(e=>"ËôïÁêÜ‰∏≠"===e.status).length,b=j.filter(e=>"Â∑≤ÂÆåÊàê"===e.status).length,v=j.filter(e=>{if(!e.expected_reply_date||"Â∑≤ÂÆåÊàê"===e.status)return!1;return new Date(e.expected_reply_date)<new Date}).length,_=l.items||[],N=_.filter(e=>"Open"===e.status).length,w=_.filter(e=>"In Progress"===e.status).length,k=_.filter(e=>"Resolved"===e.status||"Closed"===e.status).length,S=_.filter(e=>("Critical"===e.severity||"Urgent"===e.priority)&&"Resolved"!==e.status&&"Closed"!==e.status).length,C=(c.items||[]).filter(e=>e.is_active).length;a({projects:{total:t.total||0,active:o},wbs:{total:s.total||0,completed:u,inProgress:p,notStarted:h,overdue:g},pending:{total:n.total||0,pending:y,inProgress:f,completed:b,overdue:v},issues:{total:l.total||0,open:N,inProgress:w,resolved:k,critical:S},dependencies:{total:c.total||0,active:C}});const E=[...m.filter(e=>e.is_overdue&&"Â∑≤ÂÆåÊàê"!==e.status).map(e=>({type:"WBS",id:e.wbs_id,code:e.wbs_id,name:e.task_name,dueDate:e.revised_planned_end||e.original_planned_end,status:e.status,projectId:e.project_id})),...j.filter(e=>{if(!e.expected_reply_date||"Â∑≤ÂÆåÊàê"===e.status)return!1;return new Date(e.expected_reply_date)<new Date}).map(e=>({type:"Pending",id:e.pending_id,code:e.pending_id,name:e.description,dueDate:e.expected_reply_date,status:e.status,projectId:e.project_id})),..._.filter(e=>{if(!e.target_resolution_date||"Resolved"===e.status||"Closed"===e.status)return!1;return new Date(e.target_resolution_date)<new Date}).map(e=>({type:"Issue",id:e.issue_id,code:e.issue_id,name:e.issue_title,dueDate:e.target_resolution_date,status:e.status,projectId:e.project_id}))];r(E.slice(0,5));const O=new Date,D=[...m.filter(e=>{if("Â∑≤ÂÆåÊàê"===e.status)return!1;const t=e.revised_planned_start||e.original_planned_start;if(!t)return!1;return!(new Date(t)>O)&&(!e.actual_start_date||"Êú™ÈñãÂßã"===e.status)}).map(e=>({type:"WBS",id:e.wbs_id,code:e.wbs_id,name:e.task_name,startDate:e.revised_planned_start||e.original_planned_start,status:e.status,projectId:e.project_id}))];i(D.slice(0,5));const R=new Date(O);R.setHours(0,0,0,0);const F=new Date(R);F.setDate(F.getDate()+1);const T=[...m.filter(e=>{if("Â∑≤ÂÆåÊàê"===e.status)return!1;const t=new Date(e.revised_planned_end||e.original_planned_end);return t.setHours(0,0,0,0),t.getTime()===R.getTime()}).map(e=>({type:"WBS",id:e.wbs_id,code:e.wbs_id,name:e.task_name,dueDate:e.revised_planned_end||e.original_planned_end,status:e.status,projectId:e.project_id})),...j.filter(e=>{if(!e.expected_reply_date||"Â∑≤ÂÆåÊàê"===e.status)return!1;const t=new Date(e.expected_reply_date);return t.setHours(0,0,0,0),t.getTime()===R.getTime()}).map(e=>({type:"Pending",id:e.pending_id,code:e.pending_id,name:e.description,dueDate:e.expected_reply_date,status:e.status,projectId:e.project_id})),..._.filter(e=>{if(!e.target_resolution_date||"Resolved"===e.status||"Closed"===e.status)return!1;const t=new Date(e.target_resolution_date);return t.setHours(0,0,0,0),t.getTime()===R.getTime()}).map(e=>({type:"Issue",id:e.issue_id,code:e.issue_id,name:e.issue_title,dueDate:e.target_resolution_date,status:e.status,projectId:e.project_id}))];d(T.slice(0,5));const P=new Date(O.getTime()+6048e5),$=[...m.filter(e=>{if("Â∑≤ÂÆåÊàê"===e.status)return!1;const t=new Date(e.revised_planned_end||e.original_planned_end);return t>O&&t<=P}).map(e=>({type:"WBS",id:e.wbs_id,code:e.wbs_id,name:e.task_name,dueDate:e.revised_planned_end||e.original_planned_end,daysUntilDue:Math.ceil((new Date(e.revised_planned_end||e.original_planned_end)-O)/864e5),projectId:e.project_id})),...j.filter(e=>{if(!e.expected_reply_date||"Â∑≤ÂÆåÊàê"===e.status)return!1;const t=new Date(e.expected_reply_date);return t>O&&t<=P}).map(e=>({type:"Pending",id:e.pending_id,code:e.pending_id,name:e.description,dueDate:e.expected_reply_date,daysUntilDue:Math.ceil((new Date(e.expected_reply_date)-O)/864e5),projectId:e.project_id}))];x($.slice(0,5))}catch(t){h(t.message)}finally{u(!1)}},j=({title:e,value:t,subtitle:a,color:n,icon:r,link:l,alert:i})=>y.jsx(s,{to:l,className:"bg-white overflow-hidden shadow rounded-lg hover:shadow-lg transition-shadow duration-200 "+(i?"ring-2 ring-red-500":""),children:y.jsx("div",{className:"p-5",children:y.jsx("div",{className:"flex items-center",children:y.jsxs("div",{className:"flex-1",children:[y.jsxs("dt",{className:"text-sm font-medium text-gray-500 truncate flex items-center gap-2",children:[r&&y.jsx("span",{children:r}),e,i&&y.jsx("span",{className:"text-red-500",children:"‚ö†Ô∏è"})]}),y.jsxs("dd",{className:"mt-1",children:[y.jsx("div",{className:`text-3xl font-semibold ${n}`,children:t}),a&&y.jsx("div",{className:"text-sm text-gray-600 mt-1",children:a})]})]})})})}),f=(()=>{const e=t.wbs.overdue+t.pending.overdue,s=t.wbs.total+t.pending.total,a=s>0?e/s*100:0;return 0===a?{color:"green",label:"ÂÅ•Â∫∑",icon:"üü¢"}:a<10?{color:"yellow",label:"Ê≥®ÊÑè",icon:"üü°"}:{color:"red",label:"Ë≠¶Âëä",icon:"üî¥"}})();return m?y.jsx("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:y.jsxs("div",{className:"text-center py-12",children:[y.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"}),y.jsx("p",{className:"mt-4 text-gray-600",children:"ËºâÂÖ•‰∏≠..."})]})}):p?y.jsx("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:y.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:p})}):y.jsx("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:y.jsxs("div",{className:"px-4 py-6 sm:px-0",children:[y.jsx("div",{className:"mb-8",children:y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs("div",{children:[y.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Â∞àÊ°àËøΩËπ§ÁÆ°ÁêÜÁ≥ªÁµ±"}),y.jsx("p",{className:"text-gray-600",children:"Êï¥ÂêàÂºèÂ∞àÊ°àÁÆ°ÁêÜÂÑÄË°®Êùø"})]}),y.jsxs("div",{className:"text-center",children:[y.jsx("div",{className:`text-5xl ${f.icon}`,children:f.icon}),y.jsx("div",{className:`text-sm font-semibold mt-1 text-${f.color}-600`,children:f.label})]})]})}),c.length>0&&y.jsxs("div",{className:"mb-6 bg-blue-50 border-l-4 border-blue-600 p-4 rounded shadow-md",children:[y.jsx("div",{className:"flex items-center mb-3",children:y.jsxs("span",{className:"text-blue-700 font-bold text-xl",children:["üéØ ‰ªäÊó•Âà∞ÊúüÈ†ÖÁõÆ (",c.length,")"]})}),y.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:c.map((e,t)=>{const a="WBS"===e.type?`/wbs?project=${e.projectId}`:"Pending"===e.type?`/pending?project=${e.projectId}`:`/issues?project=${e.projectId}`;return y.jsx(s,{to:a,className:"bg-white p-3 rounded border border-blue-200 hover:border-blue-400 hover:shadow-md transition-all cursor-pointer",children:y.jsxs("div",{className:"text-sm text-blue-900 flex justify-between items-center",children:[y.jsxs("span",{className:"flex-1",children:[y.jsx("span",{className:"inline-block px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs font-semibold mr-2",children:e.type}),y.jsxs("span",{className:"text-blue-600 font-mono text-xs mr-2",children:["[",e.code,"]"]}),y.jsx("span",{className:"font-medium hover:text-blue-700",children:e.name})]}),y.jsx("span",{className:"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded ml-2",children:e.status})]})},t)})})]}),(n.length>0||l.length>0||t.issues.critical>0)&&y.jsxs("div",{className:"mb-6 grid grid-cols-1 lg:grid-cols-2 gap-4",children:[n.length>0&&y.jsxs("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded",children:[y.jsx("div",{className:"flex items-center mb-2",children:y.jsxs("span",{className:"text-red-600 font-semibold text-lg",children:["‚ö†Ô∏è ÈÄæÊúüÈ†ÖÁõÆ (",n.length,")"]})}),y.jsx("div",{className:"space-y-2",children:n.map((e,t)=>{const a="WBS"===e.type?`/wbs?project=${e.projectId}`:"Pending"===e.type?`/pending?project=${e.projectId}`:`/issues?project=${e.projectId}`;return y.jsxs(s,{to:a,className:"flex justify-between items-center text-sm text-red-800 hover:text-red-900 hover:bg-red-100 p-2 rounded transition-colors",children:[y.jsxs("span",{children:[y.jsxs("span",{className:"font-semibold",children:["[",e.type,"]"]}),y.jsxs("span",{className:"text-red-600 font-mono text-xs mx-2",children:["[",e.code,"]"]}),e.name]}),y.jsx("span",{className:"text-red-600 text-xs",children:e.dueDate})]},t)})})]}),l.length>0&&y.jsxs("div",{className:"bg-purple-50 border-l-4 border-purple-500 p-4 rounded",children:[y.jsx("div",{className:"flex items-center mb-2",children:y.jsxs("span",{className:"text-purple-600 font-semibold text-lg",children:["üöÄ ÊáâË©≤ÈñãÂßãËÄåÊú™ÈñãÂßã (",l.length,")"]})}),y.jsx("div",{className:"space-y-2",children:l.map((e,t)=>{const a="WBS"===e.type?`/wbs?project=${e.projectId}`:"Pending"===e.type?`/pending?project=${e.projectId}`:`/issues?project=${e.projectId}`;return y.jsxs(s,{to:a,className:"flex justify-between items-center text-sm text-purple-800 hover:text-purple-900 hover:bg-purple-100 p-2 rounded transition-colors",children:[y.jsxs("span",{children:[y.jsxs("span",{className:"font-semibold",children:["[",e.type,"]"]}),y.jsxs("span",{className:"text-purple-600 font-mono text-xs mx-2",children:["[",e.code,"]"]}),e.name]}),y.jsx("span",{className:"text-purple-600 text-xs",children:e.startDate})]},t)})})]}),t.issues.critical>0&&y.jsxs("div",{className:"bg-orange-50 border-l-4 border-orange-500 p-4 rounded",children:[y.jsx("div",{className:"flex items-center mb-2",children:y.jsxs("span",{className:"text-orange-600 font-semibold text-lg",children:["üî• Á∑äÊÄ•ÂïèÈ°å (",t.issues.critical,")"]})}),y.jsxs("p",{className:"text-sm text-orange-800",children:["Êúâ ",t.issues.critical," ÂÄãÈ´òÂÑ™ÂÖàÁ¥öÊàñÈóúÈçµÂïèÈ°åÈúÄË¶ÅÁ´ãÂç≥ËôïÁêÜ"]}),y.jsx(s,{to:"/issues",className:"text-sm text-orange-600 hover:text-orange-800 font-semibold mt-2 inline-block",children:"Êü•ÁúãË©≥ÊÉÖ ‚Üí"})]})]}),o.length>0&&y.jsxs("div",{className:"mb-6 bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded",children:[y.jsx("div",{className:"flex items-center mb-2",children:y.jsxs("span",{className:"text-yellow-700 font-semibold text-lg",children:["üìÖ Êú¨ÈÄ±Âç≥Â∞áÂà∞Êúü (",o.length,")"]})}),y.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:o.map((e,t)=>{const a="WBS"===e.type?`/wbs?project=${e.projectId}`:"Pending"===e.type?`/pending?project=${e.projectId}`:`/issues?project=${e.projectId}`;return y.jsxs(s,{to:a,className:"flex justify-between items-center text-sm text-yellow-800 hover:text-yellow-900 hover:bg-yellow-100 p-2 rounded transition-colors",children:[y.jsxs("span",{children:[y.jsxs("span",{className:"font-semibold",children:["[",e.type,"]"]}),y.jsxs("span",{className:"text-yellow-700 font-mono text-xs mx-2",children:["[",e.code,"]"]}),e.name]}),y.jsxs("span",{className:"text-yellow-600 text-xs",children:[e.daysUntilDue," Â§©Âæå"]})]},t)})})]}),y.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8",children:[y.jsx(j,{title:"Â∞àÊ°àÁ∏ΩÊï∏",value:t.projects.total,subtitle:`${t.projects.active} ÂÄãÈÄ≤Ë°å‰∏≠`,color:"text-blue-600",icon:"üìÅ",link:"/projects"}),y.jsx(j,{title:"WBS È†ÖÁõÆ",value:t.wbs.total,subtitle:`${t.wbs.completed} Â∑≤ÂÆåÊàê / ${t.wbs.inProgress} ÈÄ≤Ë°å‰∏≠`,color:"text-green-600",icon:"üìä",link:"/wbs",alert:t.wbs.overdue>0}),y.jsx(j,{title:"ÂæÖËæ¶‰∫ãÈ†Ö",value:t.pending.total,subtitle:`${t.pending.pending} ÂæÖËôïÁêÜ / ${t.pending.inProgress} ËôïÁêÜ‰∏≠`,color:"text-orange-600",icon:"‚úÖ",link:"/pending",alert:t.pending.overdue>0}),y.jsx(j,{title:"ÂïèÈ°åËøΩËπ§",value:t.issues.total,subtitle:`${t.issues.open} ÂæÖËß£Ê±∫ / ${t.issues.inProgress} ËôïÁêÜ‰∏≠`,color:"text-red-600",icon:"üêõ",link:"/issues",alert:t.issues.critical>0})]}),y.jsxs("div",{className:"grid grid-cols-1 gap-5 lg:grid-cols-3 mb-8",children:[y.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:y.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[y.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"WBS ÈÄ≤Â∫¶ÂàÜ‰Ωà"}),y.jsxs("div",{className:"space-y-3",children:[y.jsxs("div",{children:[y.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[y.jsx("span",{className:"text-gray-600",children:"Â∑≤ÂÆåÊàê"}),y.jsxs("span",{className:"font-semibold text-green-600",children:[t.wbs.completed," (",t.wbs.total>0?Math.round(t.wbs.completed/t.wbs.total*100):0,"%)"]})]}),y.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:y.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:(t.wbs.total>0?t.wbs.completed/t.wbs.total*100:0)+"%"}})})]}),y.jsxs("div",{children:[y.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[y.jsx("span",{className:"text-gray-600",children:"ÈÄ≤Ë°å‰∏≠"}),y.jsxs("span",{className:"font-semibold text-blue-600",children:[t.wbs.inProgress," (",t.wbs.total>0?Math.round(t.wbs.inProgress/t.wbs.total*100):0,"%)"]})]}),y.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:y.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:(t.wbs.total>0?t.wbs.inProgress/t.wbs.total*100:0)+"%"}})})]}),y.jsxs("div",{children:[y.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[y.jsx("span",{className:"text-gray-600",children:"Êú™ÈñãÂßã"}),y.jsxs("span",{className:"font-semibold text-gray-600",children:[t.wbs.notStarted," (",t.wbs.total>0?Math.round(t.wbs.notStarted/t.wbs.total*100):0,"%)"]})]}),y.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:y.jsx("div",{className:"bg-gray-400 h-2 rounded-full",style:{width:(t.wbs.total>0?t.wbs.notStarted/t.wbs.total*100:0)+"%"}})})]}),t.wbs.overdue>0&&y.jsxs("div",{children:[y.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[y.jsx("span",{className:"text-gray-600",children:"ÈÄæÊúü"}),y.jsxs("span",{className:"font-semibold text-red-600",children:[t.wbs.overdue," (",t.wbs.total>0?Math.round(t.wbs.overdue/t.wbs.total*100):0,"%)"]})]}),y.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:y.jsx("div",{className:"bg-red-600 h-2 rounded-full",style:{width:(t.wbs.total>0?t.wbs.overdue/t.wbs.total*100:0)+"%"}})})]})]})]})}),y.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:y.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[y.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"ÂïèÈ°åÁãÄÊÖãÂàÜ‰Ωà"}),y.jsxs("div",{className:"space-y-3",children:[y.jsxs("div",{children:[y.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[y.jsx("span",{className:"text-gray-600",children:"ÂæÖËß£Ê±∫"}),y.jsxs("span",{className:"font-semibold text-red-600",children:[t.issues.open," (",t.issues.total>0?Math.round(t.issues.open/t.issues.total*100):0,"%)"]})]}),y.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:y.jsx("div",{className:"bg-red-600 h-2 rounded-full",style:{width:(t.issues.total>0?t.issues.open/t.issues.total*100:0)+"%"}})})]}),y.jsxs("div",{children:[y.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[y.jsx("span",{className:"text-gray-600",children:"ËôïÁêÜ‰∏≠"}),y.jsxs("span",{className:"font-semibold text-blue-600",children:[t.issues.inProgress," (",t.issues.total>0?Math.round(t.issues.inProgress/t.issues.total*100):0,"%)"]})]}),y.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:y.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:(t.issues.total>0?t.issues.inProgress/t.issues.total*100:0)+"%"}})})]}),y.jsxs("div",{children:[y.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[y.jsx("span",{className:"text-gray-600",children:"Â∑≤Ëß£Ê±∫"}),y.jsxs("span",{className:"font-semibold text-green-600",children:[t.issues.resolved," (",t.issues.total>0?Math.round(t.issues.resolved/t.issues.total*100):0,"%)"]})]}),y.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:y.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:(t.issues.total>0?t.issues.resolved/t.issues.total*100:0)+"%"}})})]})]})]})}),y.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:y.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[y.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"ÂÖ∂‰ªñÁµ±Ë®à"}),y.jsxs("div",{className:"space-y-4",children:[y.jsxs("div",{className:"flex justify-between items-center",children:[y.jsx("span",{className:"text-sm text-gray-600",children:"‰æùË≥¥Èóú‰øÇÁ∏ΩÊï∏"}),y.jsx("span",{className:"text-2xl font-semibold text-purple-600",children:t.dependencies.total})]}),y.jsxs("div",{className:"flex justify-between items-center",children:[y.jsx("span",{className:"text-sm text-gray-600",children:"ÂïüÁî®‰∏≠ÁöÑ‰æùË≥¥"}),y.jsx("span",{className:"text-lg font-semibold text-purple-500",children:t.dependencies.active})]}),y.jsx("div",{className:"border-t pt-3",children:y.jsxs("div",{className:"flex justify-between items-center",children:[y.jsx("span",{className:"text-sm text-gray-600",children:"Êï¥È´îÂÆåÊàêÁéá"}),y.jsxs("span",{className:"text-lg font-semibold text-green-600",children:[t.wbs.total>0?Math.round(t.wbs.completed/t.wbs.total*100):0,"%"]})]})}),y.jsx(s,{to:"/dependencies",className:"block text-center text-sm text-purple-600 hover:text-purple-800 font-semibold",children:"Êü•Áúã‰æùË≥¥Èóú‰øÇ ‚Üí"})]})]})})]}),y.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:y.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[y.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Âø´ÈÄüÊìç‰Ωú"}),y.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3",children:[y.jsxs(s,{to:"/projects",className:"flex flex-col items-center justify-center px-4 py-3 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:[y.jsx("span",{className:"text-2xl mb-1",children:"üìÅ"}),"Â∞àÊ°àÁÆ°ÁêÜ"]}),y.jsxs(s,{to:"/wbs",className:"flex flex-col items-center justify-center px-4 py-3 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:[y.jsx("span",{className:"text-2xl mb-1",children:"üìä"}),"WBS ÁÆ°ÁêÜ"]}),y.jsxs(s,{to:"/wbs/tree",className:"flex flex-col items-center justify-center px-4 py-3 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:[y.jsx("span",{className:"text-2xl mb-1",children:"üå≥"}),"WBS Ê®πÁãÄÂúñ"]}),y.jsxs(s,{to:"/dependencies",className:"flex flex-col items-center justify-center px-4 py-3 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:[y.jsx("span",{className:"text-2xl mb-1",children:"üîó"}),"‰æùË≥¥Èóú‰øÇ"]}),y.jsxs(s,{to:"/pending",className:"flex flex-col items-center justify-center px-4 py-3 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:[y.jsx("span",{className:"text-2xl mb-1",children:"‚úÖ"}),"ÂæÖËæ¶Ê∏ÖÂñÆ"]}),y.jsxs(s,{to:"/issues",className:"flex flex-col items-center justify-center px-4 py-3 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:[y.jsx("span",{className:"text-2xl mb-1",children:"üêõ"}),"ÂïèÈ°åËøΩËπ§"]}),y.jsxs(s,{to:"/gantt",className:"flex flex-col items-center justify-center px-4 py-3 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 transition-colors",children:[y.jsx("span",{className:"text-2xl mb-1",children:"üìÖ"}),"ÁîòÁâπÂúñ"]})]})]})})]})})},qt=()=>{const[t,s]=e.useState([]),[a,n]=e.useState(!1),[r,l]=e.useState(null),[i,c]=e.useState(0),d=e.useCallback(async(e={})=>{n(!0),l(null);try{const t={...e},a=await Wt.get("/projects/",{params:t});s(a.items||[]),c(a.total||0)}catch(t){l(t.message),s([])}finally{n(!1)}},[]),o=e.useCallback(async e=>{n(!0),l(null);try{return await Wt.get(`/projects/${e}`)}catch(t){throw l(t.message),t}finally{n(!1)}},[]),x=e.useCallback(async e=>{n(!0),l(null);try{return await Wt.get(`/projects/${e}/stats`)}catch(t){throw l(t.message),t}finally{n(!1)}},[]),m=e.useCallback(async e=>{n(!0),l(null);try{const t=await Wt.post("/projects/",e);return await d(),t}catch(t){throw l(t.message),t}finally{n(!1)}},[d]),u=e.useCallback(async(e,t)=>{n(!0),l(null);try{const s=await Wt.put(`/projects/${e}`,t);return await d(),s}catch(s){throw l(s.message),s}finally{n(!1)}},[d]),p=e.useCallback(async e=>{n(!0),l(null);try{await Wt.delete(`/projects/${e}`),await d()}catch(t){throw l(t.message),t}finally{n(!1)}},[d]);return e.useEffect(()=>{d()},[d]),{projectsList:t,loading:a,error:r,total:i,fetchProjects:d,getProject:o,getProjectStats:x,createProject:m,updateProject:u,deleteProject:p}},zt=({initialData:t=null,onSubmit:s,onCancel:a})=>{const[n,r]=e.useState({project_id:"",project_name:"",description:"",status:"Active"}),[l,i]=e.useState({});e.useEffect(()=>{t&&r({project_id:t.project_id||"",project_name:t.project_name||"",description:t.description||"",status:t.status||"Active"})},[t]);const c=e=>{const{name:t,value:s}=e.target;r(e=>({...e,[t]:s})),l[t]&&i(e=>({...e,[t]:null}))};return y.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!(()=>{const e={};return n.project_id?/^[A-Z0-9_-]+$/i.test(n.project_id)||(e.project_id="Â∞àÊ°à ID Âè™ËÉΩÂåÖÂê´Ëã±Êñá„ÄÅÊï∏Â≠ó„ÄÅÂ∫ïÁ∑öÂíåÈÄ£Â≠óËôü"):e.project_id="Ë´ãËº∏ÂÖ•Â∞àÊ°à ID",n.project_name||(e.project_name="Ë´ãËº∏ÂÖ•Â∞àÊ°àÂêçÁ®±"),i(e),0===Object.keys(e).length})())return;const t={...n,description:n.description||null};s(t)},className:"space-y-6 bg-white p-6 rounded-lg shadow",children:[y.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t?"Á∑®ËºØÂ∞àÊ°à":"Êñ∞Â¢ûÂ∞àÊ°à"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"project_id",className:"label",children:"Â∞àÊ°à ID *"}),y.jsx("input",{type:"text",id:"project_id",name:"project_id",value:n.project_id,onChange:c,disabled:!!t,placeholder:"‰æãÂ¶Ç: PRJ001, PROJECT_2024",className:"input-field"}),l.project_id&&y.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.project_id}),!t&&y.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Â∞àÊ°à ID ÂâµÂª∫ÂæåÁÑ°Ê≥ï‰øÆÊîπ"})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"status",className:"label",children:"ÁãÄÊÖã"}),y.jsxs("select",{id:"status",name:"status",value:n.status,onChange:c,className:"input-field",children:[y.jsx("option",{value:"Active",children:"ÈÄ≤Ë°å‰∏≠ (Active)"}),y.jsx("option",{value:"Completed",children:"Â∑≤ÂÆåÊàê (Completed)"}),y.jsx("option",{value:"On Hold",children:"Êö´ÂÅú (On Hold)"}),y.jsx("option",{value:"Cancelled",children:"Â∑≤ÂèñÊ∂à (Cancelled)"})]})]}),y.jsxs("div",{className:"md:col-span-2",children:[y.jsx("label",{htmlFor:"project_name",className:"label",children:"Â∞àÊ°àÂêçÁ®± *"}),y.jsx("input",{type:"text",id:"project_name",name:"project_name",value:n.project_name,onChange:c,placeholder:"Ë´ãËº∏ÂÖ•Â∞àÊ°àÂêçÁ®±",className:"input-field"}),l.project_name&&y.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.project_name})]}),y.jsxs("div",{className:"md:col-span-2",children:[y.jsx("label",{htmlFor:"description",className:"label",children:"Â∞àÊ°àÊèèËø∞"}),y.jsx("textarea",{id:"description",name:"description",value:n.description,onChange:c,rows:"4",placeholder:"Ë´ãËº∏ÂÖ•Â∞àÊ°àÊèèËø∞...",className:"input-field"})]})]}),y.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[y.jsx("button",{type:"button",onClick:a,className:"btn-secondary",children:"ÂèñÊ∂à"}),y.jsx("button",{type:"submit",className:"btn-primary",children:t?"Êõ¥Êñ∞":"Êñ∞Â¢û"})]})]})},Jt=()=>{const[t,a]=e.useState(!1),[n,r]=e.useState(null),[l,i]=e.useState({status:""}),[c,d]=e.useState({}),{projectsList:o,loading:x,error:m,total:u,fetchProjects:p,getProjectStats:h,createProject:g,updateProject:j,deleteProject:f}=qt();e.useEffect(()=>{p(l)},[p,l]),e.useEffect(()=>{o.length>0&&(async()=>{const e={};for(const s of o)try{const t=await h(s.project_id);e[s.project_id]=t}catch(t){console.error(`Failed to load stats for ${s.project_id}`,t)}d(e)})()},[o,h]);const b=()=>{r(null),a(!0)},v=async e=>{try{n?(await j(n.project_id,e),alert("Êõ¥Êñ∞ÊàêÂäü")):(await g(e),alert("Êñ∞Â¢ûÊàêÂäü")),a(!1),r(null)}catch(t){alert(`Êìç‰ΩúÂ§±Êïó: ${t.message}`)}},_=()=>{a(!1),r(null)},N=e=>{switch(e){case"Active":return"bg-green-100 text-green-800";case"Completed":return"bg-blue-100 text-blue-800";case"On Hold":return"bg-yellow-100 text-yellow-800";case"Cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},w=e=>{switch(e){case"Healthy":return"bg-green-100 text-green-800";case"Warning":return"bg-yellow-100 text-yellow-800";case"Critical":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return t?y.jsx("div",{className:"container mx-auto px-4 py-8",children:y.jsx(zt,{initialData:n,onSubmit:v,onCancel:_})}):y.jsxs("div",{className:"container mx-auto px-4 py-8",children:[y.jsxs("div",{className:"mb-6",children:[y.jsxs("div",{className:"flex justify-between items-center mb-4",children:[y.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Â∞àÊ°àÁÆ°ÁêÜ"}),y.jsx("button",{onClick:b,className:"btn-primary",children:"+ Êñ∞Â¢ûÂ∞àÊ°à"})]}),y.jsx("div",{className:"flex gap-4 items-center",children:y.jsxs("div",{children:[y.jsx("label",{htmlFor:"status-filter",className:"label",children:"ÁãÄÊÖãÁØ©ÈÅ∏"}),y.jsxs("select",{id:"status-filter",value:l.status,onChange:e=>i({...l,status:e.target.value}),className:"input-field",children:[y.jsx("option",{value:"",children:"ÂÖ®ÈÉ®"}),y.jsx("option",{value:"Active",children:"ÈÄ≤Ë°å‰∏≠"}),y.jsx("option",{value:"Completed",children:"Â∑≤ÂÆåÊàê"}),y.jsx("option",{value:"On Hold",children:"Êö´ÂÅú"}),y.jsx("option",{value:"Cancelled",children:"Â∑≤ÂèñÊ∂à"})]})]})})]}),m&&y.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4",children:m}),x&&y.jsxs("div",{className:"text-center py-8",children:[y.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),y.jsx("p",{className:"mt-2 text-gray-600",children:"ËºâÂÖ•‰∏≠..."})]}),!x&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:0===o.length?y.jsxs("div",{className:"col-span-full text-center py-12 text-gray-500",children:[y.jsx("p",{className:"text-lg",children:"Êö´ÁÑ°Â∞àÊ°à"}),y.jsx("button",{onClick:b,className:"mt-4 btn-primary",children:"Âª∫Á´ãÁ¨¨‰∏ÄÂÄãÂ∞àÊ°à"})]}):o.map(e=>{const t=c[e.project_id];return y.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[y.jsxs("div",{className:"flex justify-between items-start mb-4",children:[y.jsxs("div",{className:"flex-1",children:[y.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-1",children:e.project_name}),y.jsx("p",{className:"text-sm text-gray-500",children:e.project_id})]}),y.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${N(e.status)}`,children:e.status})]}),e.description&&y.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:e.description}),y.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 py-4 border-t border-b border-gray-200",children:[y.jsxs("div",{className:"text-center",children:[y.jsx("p",{className:"text-2xl font-bold text-blue-600",children:e.total_wbs}),y.jsx("p",{className:"text-xs text-gray-500",children:"WBS È†ÖÁõÆ"})]}),y.jsxs("div",{className:"text-center",children:[y.jsx("p",{className:"text-2xl font-bold text-orange-600",children:e.total_issues}),y.jsx("p",{className:"text-xs text-gray-500",children:"ÂïèÈ°å"})]}),y.jsxs("div",{className:"text-center",children:[y.jsx("p",{className:"text-2xl font-bold text-purple-600",children:e.total_pending}),y.jsx("p",{className:"text-xs text-gray-500",children:"ÂæÖËæ¶"})]})]}),t&&y.jsxs("div",{className:"mb-4",children:[y.jsxs("div",{className:"flex justify-between items-center mb-1",children:[y.jsx("span",{className:"text-sm text-gray-600",children:"Êï¥È´îÈÄ≤Â∫¶"}),y.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[t.overall_progress,"%"]})]}),y.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:y.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${t.overall_progress}%`}})}),y.jsxs("div",{className:"flex justify-between mt-2",children:[y.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${w(t.health_status)}`,children:t.health_status}),t.overdue_wbs>0&&y.jsxs("span",{className:"text-xs text-red-600",children:["‚ö†Ô∏è ",t.overdue_wbs," È†ÖÈÄæÊúü"]})]})]}),y.jsxs("div",{className:"flex gap-2",children:[y.jsx(s,{to:`/wbs?project=${e.project_id}`,className:"flex-1 text-center btn-primary text-sm py-2",children:"Êü•Áúã WBS"}),y.jsx("button",{onClick:()=>(e=>{r(e),a(!0)})(e),className:"flex-1 btn-secondary text-sm py-2",children:"Á∑®ËºØ"}),y.jsx("button",{onClick:()=>(async e=>{if(window.confirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§Â∞àÊ°à„Äå${e.project_name}„ÄçÂóéÔºü\n\n‚ö†Ô∏è Ë≠¶ÂëäÔºöÈÄôÂ∞áÂà™Èô§ÊâÄÊúâÁõ∏ÈóúÁöÑ WBS È†ÖÁõÆ„ÄÅÂïèÈ°åÂíåÂæÖËæ¶‰∫ãÈ†ÖÔºåÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©ÂéüÔºÅ`))try{await f(e.project_id),alert("Âà™Èô§ÊàêÂäü")}catch(t){alert(`Âà™Èô§Â§±Êïó: ${t.message}`)}})(e),className:"px-4 py-2 text-white bg-red-600 hover:bg-red-700 rounded-md text-sm font-medium transition-colors",title:"Âà™Èô§Â∞àÊ°à",children:"Âà™Èô§"})]})]},e.project_id)})}),y.jsxs("div",{className:"mt-6 text-sm text-gray-600",children:["ÂÖ± ",u," ÂÄãÂ∞àÊ°à"]})]})]})},Kt=(t=null)=>{const[s,a]=e.useState([]),[n,r]=e.useState(!1),[l,i]=e.useState(null),[c,d]=e.useState(0),o=e.useCallback(async(e={})=>{r(!0),i(null);try{const s={...e,project_id:t||e.project_id},n=await Wt.get("/wbs/",{params:s});a(n.items||[]),d(n.total||0)}catch(s){i(s.message),a([])}finally{r(!1)}},[t]),x=e.useCallback(async e=>{const s=e||t;if(!s)return i("Project ID is required for tree view"),[];r(!0),i(null);try{return(await Wt.get(`/wbs/tree/${s}`)).tree||[]}catch(a){return i(a.message),[]}finally{r(!1)}},[t]),m=e.useCallback(async e=>{r(!0),i(null);try{return await Wt.get(`/wbs/${e}`)}catch(t){throw i(t.message),t}finally{r(!1)}},[]),u=e.useCallback(async e=>{r(!0),i(null);try{const t=await Wt.post("/wbs/",e);return await o(),t}catch(t){throw i(t.message),t}finally{r(!1)}},[o]),p=e.useCallback(async(e,t)=>{r(!0),i(null);try{const s=await Wt.put(`/wbs/${e}`,t);return await o(),s}catch(s){throw i(s.message),s}finally{r(!1)}},[o]),h=e.useCallback(async e=>{r(!0),i(null);try{await Wt.delete(`/wbs/${e}`),await o()}catch(t){throw i(t.message),t}finally{r(!1)}},[o]),g=e.useCallback(async e=>{r(!0),i(null);try{const t=await Wt.post("/wbs/batch",e);return await o(),t}catch(t){throw i(t.message),t}finally{r(!1)}},[o]);return e.useEffect(()=>{t&&o()},[t,o]),{wbsList:s,loading:n,error:l,total:c,fetchWBS:o,fetchWBSTree:x,getWBS:m,createWBS:u,updateWBS:p,deleteWBS:h,createWBSBatch:g}},Yt=()=>{const[t,s]=e.useState(!1),[a,n]=e.useState(null);return{loading:t,error:a,importWBSFromExcel:e.useCallback(async(e,t)=>{s(!0),n(null);try{const s=new FormData;s.append("file",e);return await Wt.post(`/excel/import/wbs?project_id=${t}`,s,{headers:{"Content-Type":"multipart/form-data"}})}catch(a){throw n(a.message),a}finally{s(!1)}},[]),exportWBSToExcel:e.useCallback(async e=>{s(!0),n(null);try{const t=await fetch(`/api/excel/export/wbs/${e}`,{method:"GET",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}});if(!t.ok){const e=await t.json();throw new Error(e.detail||"Export failed")}const s=await t.blob(),a=window.URL.createObjectURL(s),n=document.createElement("a");return n.href=a,n.download=`WBS_${e}.xlsx`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a),{success:!0}}catch(t){throw n(t.message),t}finally{s(!1)}},[]),downloadWBSTemplate:e.useCallback(async()=>{s(!0),n(null);try{const e=await fetch("/api/excel/template/wbs",{method:"GET",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}});if(!e.ok){const t=await e.json();throw new Error(t.detail||"Template download failed")}const t=await e.blob(),s=window.URL.createObjectURL(t),a=document.createElement("a");return a.href=s,a.download="WBS_Template.xlsx",document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s),{success:!0}}catch(e){throw n(e.message),e}finally{s(!1)}},[]),exportPendingToExcel:e.useCallback(async e=>{s(!0),n(null);try{const t=await fetch(`/api/excel/export/pending/${e}`,{method:"GET",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}});if(!t.ok){const e=await t.json();throw new Error(e.detail||"Export failed")}const s=await t.blob(),a=window.URL.createObjectURL(s),n=document.createElement("a");return n.href=a,n.download=`ÂæÖËæ¶‰∫ãÈ†Ö_${e}.xlsx`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a),{success:!0}}catch(t){throw n(t.message),t}finally{s(!1)}},[]),exportIssuesToExcel:e.useCallback(async e=>{s(!0),n(null);try{const t=await fetch(`/api/excel/export/issues/${e}`,{method:"GET",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}});if(!t.ok){const e=await t.json();throw new Error(e.detail||"Export failed")}const s=await t.blob(),a=window.URL.createObjectURL(s),n=document.createElement("a");return n.href=a,n.download=`ÂïèÈ°åËøΩËπ§_${e}.xlsx`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a),{success:!0}}catch(t){throw n(t.message),t}finally{s(!1)}},[])}},Vt=()=>{const[t,s]=e.useState([]),[a,n]=e.useState(!1),[r,l]=e.useState(null),[i,c]=e.useState(0);return{issuesList:t,loading:a,error:r,total:i,fetchIssues:e.useCallback(async(e={})=>{n(!0),l(null);try{const t={...e},a=await Wt.get("/issues/",{params:t});s(a.items||[]),c(a.total||0)}catch(t){l(t.message),s([])}finally{n(!1)}},[]),getIssue:e.useCallback(async e=>{n(!0),l(null);try{return await Wt.get(`/issues/${e}`)}catch(t){throw l(t.message),t}finally{n(!1)}},[]),getIssueHistory:e.useCallback(async e=>{n(!0),l(null);try{return await Wt.get(`/issues/${e}/history`)}catch(t){throw l(t.message),t}finally{n(!1)}},[]),createIssue:e.useCallback(async e=>{n(!0),l(null);try{return await Wt.post("/issues/",e)}catch(t){throw l(t.message),t}finally{n(!1)}},[]),updateIssue:e.useCallback(async(e,t,s="User")=>{n(!0),l(null);try{return await Wt.put(`/issues/${e}?changed_by=${s}`,t)}catch(a){throw l(a.message),a}finally{n(!1)}},[]),deleteIssue:e.useCallback(async e=>{n(!0),l(null);try{await Wt.delete(`/issues/${e}`)}catch(t){throw l(t.message),t}finally{n(!1)}},[]),escalateIssue:e.useCallback(async(e,t)=>{n(!0),l(null);try{return await Wt.put(`/issues/${e}/escalate`,t)}catch(s){throw l(s.message),s}finally{n(!1)}},[]),resolveIssue:e.useCallback(async(e,t)=>{n(!0),l(null);try{return await Wt.put(`/issues/${e}/resolve`,t)}catch(s){throw l(s.message),s}finally{n(!1)}},[]),closeIssue:e.useCallback(async(e,t="User")=>{n(!0),l(null);try{return await Wt.put(`/issues/${e}/close?changed_by=${t}`)}catch(s){throw l(s.message),s}finally{n(!1)}},[]),getStats:e.useCallback(async(e=null)=>{n(!0),l(null);try{const t=e?{project_id:e}:{};return await Wt.get("/issues/stats",{params:t})}catch(t){throw l(t.message),t}finally{n(!1)}},[])}},Gt=()=>{const[t,s]=e.useState([]),[a,n]=e.useState([]),[r,l]=e.useState(!1),[i,c]=e.useState(null),d=e.useCallback(async()=>{l(!0),c(null);try{const e=await Wt.get("/settings/system");return s(e),e}catch(e){throw c(e.message),e}finally{l(!1)}},[]),o=e.useCallback(async(e,t)=>{try{const a=await Wt.put(`/settings/system/${e}`,{setting_value:t});return s(t=>t.map(t=>t.setting_key===e?a:t)),a}catch(a){throw c(a.message),a}},[]),x=e.useCallback((e,s=null)=>{const a=t.find(t=>t.setting_key===e);return a?"number"===a.setting_type?parseFloat(a.setting_value):"boolean"===a.setting_type?"true"===a.setting_value.toLowerCase():a.setting_value:s},[t]),m=e.useCallback(async(e,t=null)=>{l(!0),c(null);try{const s=`/settings/project/${e}${t?`?setting_key=${t}`:""}`,a=await Wt.get(s);return n(a),a}catch(s){throw c(s.message),s}finally{l(!1)}},[]),u=e.useCallback(async e=>{try{const t=await Wt.post("/settings/project",e);return n(e=>[...e,t]),t}catch(t){throw c(t.message),t}},[]),p=e.useCallback(async(e,t)=>{try{const s=await Wt.put(`/settings/project/${e}`,t);return n(t=>t.map(t=>t.setting_id===e?s:t)),s}catch(s){throw c(s.message),s}},[]),h=e.useCallback(async e=>{try{await Wt.delete(`/settings/project/${e}`),n(t=>t.filter(t=>t.setting_id!==e))}catch(t){throw c(t.message),t}},[]),g=e.useCallback(async e=>{try{return await Wt.get(`/settings/owner-units/${e}`)}catch(t){throw c(t.message),t}},[]),j=e.useCallback(async(e,t,s=0)=>{try{return await Wt.post("/settings/owner-units",{project_id:e,unit_name:t,display_order:s})}catch(a){throw c(a.message),a}},[]);return{systemSettings:t,projectSettings:a,loading:r,error:i,fetchSystemSettings:d,updateSystemSetting:o,getSystemSetting:x,fetchProjectSettings:m,createProjectSetting:u,updateProjectSetting:p,deleteProjectSetting:h,fetchOwnerUnits:g,addOwnerUnit:j}},Xt=({initialData:t=null,onSubmit:s,onCancel:a,projectId:n,availableWBSList:r=[]})=>{const[l,i]=e.useState([]),[c,d]=e.useState([]),{fetchOwnerUnits:o}=Gt(),[x,m]=e.useState({project_id:n||"",wbs_id:"",parent_id:"",task_name:"",category:"Task",owner_unit:"",original_planned_start:"",original_planned_end:"",revised_planned_start:"",revised_planned_end:"",actual_start_date:"",actual_end_date:"",work_days:"",actual_progress:0,status:"Êú™ÈñãÂßã",notes:"",is_internal:!1}),[u,p]=e.useState({}),h=(e,t)=>{if(!e||!t)return null;const s=new Date(e),a=new Date(t);if(isNaN(s.getTime())||isNaN(a.getTime()))return null;const n=Math.abs(a-s);return Math.ceil(n/864e5)+1},g=h(x.original_planned_start,x.original_planned_end),j=h(x.revised_planned_start,x.revised_planned_end),f=h(x.actual_start_date,x.actual_end_date);e.useEffect(()=>{if(t){let e=t.parent_id||"";e&&e.includes("_")&&(e=e.split("_")[1]),m({...t,parent_id:e,original_planned_start:t.original_planned_start||"",original_planned_end:t.original_planned_end||"",revised_planned_start:t.revised_planned_start||"",revised_planned_end:t.revised_planned_end||"",actual_start_date:t.actual_start_date||"",actual_end_date:t.actual_end_date||""})}},[t]),e.useEffect(()=>{const e=t?r.filter(e=>e.item_id!==t.item_id):r;i(e)},[r,t]),e.useEffect(()=>{n&&o(n).then(e=>{d(e)}).catch(e=>{console.error("Failed to fetch owner units:",e),d([])})},[n]),e.useEffect(()=>{if(!t&&x.parent_id&&l.length>0){const e=v(x.parent_id);e!==x.wbs_id&&m(t=>({...t,wbs_id:e}))}},[l,x.parent_id]);const b=e=>{const{name:s,value:a,type:n,checked:r}=e.target,l="checkbox"===n?r:a;if("parent_id"===s&&a&&!t){const e=v(a);m(t=>({...t,parent_id:a,wbs_id:e}))}else m(e=>({...e,[s]:l}));u[s]&&p(e=>({...e,[s]:null}))},v=e=>{if(!e)return"";const t=l.filter(t=>{if(!t.parent_id)return!1;return(t.parent_id.includes("_")?t.parent_id.split("_")[1]:t.parent_id)===e});if(0===t.length)return`${e}.1`;let s=0;return t.forEach(e=>{const t=e.wbs_id.split(".");if(t.length>0){const e=parseInt(t[t.length-1]);!isNaN(e)&&e>s&&(s=e)}}),`${e}.${s+1}`};return y.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!(()=>{const e={};return x.project_id||(e.project_id="Ë´ãËº∏ÂÖ•Â∞àÊ°à ID"),x.wbs_id||(e.wbs_id="Ë´ãËº∏ÂÖ• WBS Á∑®Ëôü"),x.task_name||(e.task_name="Ë´ãËº∏ÂÖ•‰ªªÂãôÂêçÁ®±"),p(e),0===Object.keys(e).length})())return;const a={...x,work_days:x.work_days?parseInt(x.work_days):null,actual_progress:parseInt(x.actual_progress)||0};Object.keys(a).forEach(e=>{""===a[e]&&(a[e]=null)}),s(a),t||m({project_id:n||"",wbs_id:"",parent_id:x.parent_id,task_name:"",category:"Task",owner_unit:x.owner_unit,original_planned_start:"",original_planned_end:"",revised_planned_start:"",revised_planned_end:"",actual_start_date:"",actual_end_date:"",work_days:"",actual_progress:0,status:"Êú™ÈñãÂßã",notes:""})},className:"space-y-6 bg-white p-6 rounded-lg shadow",children:[y.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t?"Á∑®ËºØ WBS È†ÖÁõÆ":"Êñ∞Â¢û WBS È†ÖÁõÆ"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"project_id",className:"label",children:"Â∞àÊ°à ID *"}),y.jsx("input",{type:"text",id:"project_id",name:"project_id",value:x.project_id,onChange:b,disabled:!!t,className:"input-field"}),u.project_id&&y.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.project_id})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"wbs_id",className:"label",children:"WBS Á∑®Ëôü *"}),y.jsx("input",{type:"text",id:"wbs_id",name:"wbs_id",value:x.wbs_id,onChange:b,disabled:!!t,placeholder:"‰æãÂ¶Ç: 1, 2.1, 2.1.3",className:"input-field"}),u.wbs_id&&y.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.wbs_id})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"parent_id",className:"label",children:"Áà∂È†ÖÁõÆ (ÈÅ∏Â°´)"}),y.jsxs("select",{id:"parent_id",name:"parent_id",value:x.parent_id,onChange:b,className:"input-field",children:[y.jsx("option",{value:"",children:"-- ÁÑ° (È†ÇÂ±§È†ÖÁõÆ) --"}),l.map(e=>y.jsxs("option",{value:e.wbs_id,children:[e.wbs_id," - ",e.task_name]},e.item_id))]}),y.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ÈÅ∏ÊìáÁà∂È†ÖÁõÆ‰ª•Âª∫Á´ãÈöéÂ±§Èóú‰øÇÔºåÁïôÁ©∫Ë°®Á§∫È†ÇÂ±§È†ÖÁõÆ"})]}),y.jsxs("div",{className:"md:col-span-2",children:[y.jsx("label",{htmlFor:"task_name",className:"label",children:"‰ªªÂãôÂêçÁ®± *"}),y.jsx("input",{type:"text",id:"task_name",name:"task_name",value:x.task_name,onChange:b,className:"input-field"}),u.task_name&&y.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.task_name})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"category",className:"label",children:"È°ûÂà•"}),y.jsxs("select",{id:"category",name:"category",value:x.category,onChange:b,className:"input-field",children:[y.jsx("option",{value:"Task",children:"Task"}),y.jsx("option",{value:"Milestone",children:"Milestone"})]})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"owner_unit",className:"label",children:"Ë≤†Ë≤¨ÂñÆ‰Ωç"}),y.jsx("input",{type:"text",id:"owner_unit",name:"owner_unit",value:x.owner_unit,onChange:b,list:"owner-units-list",placeholder:"ÈÅ∏ÊìáÊàñËº∏ÂÖ•Ë≤†Ë≤¨ÂñÆ‰Ωç",className:"input-field"}),y.jsx("datalist",{id:"owner-units-list",children:c.map((e,t)=>y.jsx("option",{value:e},t))}),y.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Âæû‰∏ãÊãâÈÅ∏ÂñÆÈÅ∏ÊìáÊàñÁõ¥Êé•Ëº∏ÂÖ•Êñ∞ÁöÑÂñÆ‰ΩçÂêçÁ®±"})]})]}),y.jsxs("div",{children:[y.jsxs("div",{className:"flex items-center justify-between mb-3",children:[y.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"ÈöéÊÆµ 1: ÂéüÂßãË®àÁï´"}),null!==g&&y.jsxs("span",{className:"text-sm font-medium text-blue-600 bg-blue-50 px-3 py-1 rounded-full",children:["Â∑•‰ΩúÂ§©Êï∏: ",g," Â§©"]})]}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"original_planned_start",className:"label",children:"È†êË®àÈñãÂßãÊó•Êúü"}),y.jsx("input",{type:"date",id:"original_planned_start",name:"original_planned_start",value:x.original_planned_start,onChange:b,className:"input-field"})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"original_planned_end",className:"label",children:"È†êË®àÁµêÊùüÊó•Êúü"}),y.jsx("input",{type:"date",id:"original_planned_end",name:"original_planned_end",value:x.original_planned_end,onChange:b,className:"input-field"})]})]})]}),y.jsxs("div",{children:[y.jsxs("div",{className:"flex items-center justify-between mb-3",children:[y.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"ÈöéÊÆµ 2: Ë™øÊï¥Ë®àÁï´"}),null!==j&&y.jsxs("span",{className:"text-sm font-medium text-purple-600 bg-purple-50 px-3 py-1 rounded-full",children:["Â∑•‰ΩúÂ§©Êï∏: ",j," Â§©"]})]}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"revised_planned_start",className:"label",children:"Ë™øÊï¥ÂæåÈñãÂßãÊó•Êúü"}),y.jsx("input",{type:"date",id:"revised_planned_start",name:"revised_planned_start",value:x.revised_planned_start,onChange:b,className:"input-field"})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"revised_planned_end",className:"label",children:"Ë™øÊï¥ÂæåÁµêÊùüÊó•Êúü"}),y.jsx("input",{type:"date",id:"revised_planned_end",name:"revised_planned_end",value:x.revised_planned_end,onChange:b,className:"input-field"})]})]})]}),y.jsxs("div",{children:[y.jsxs("div",{className:"flex items-center justify-between mb-3",children:[y.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"ÈöéÊÆµ 3: ÂØ¶ÈöõÂü∑Ë°å"}),null!==f&&y.jsxs("span",{className:"text-sm font-medium text-green-600 bg-green-50 px-3 py-1 rounded-full",children:["Â∑•‰ΩúÂ§©Êï∏: ",f," Â§©"]})]}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"actual_start_date",className:"label",children:"ÂØ¶ÈöõÈñãÂßãÊó•Êúü"}),y.jsx("input",{type:"date",id:"actual_start_date",name:"actual_start_date",value:x.actual_start_date,onChange:b,className:"input-field"})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"actual_end_date",className:"label",children:"ÂØ¶ÈöõÁµêÊùüÊó•Êúü"}),y.jsx("input",{type:"date",id:"actual_end_date",name:"actual_end_date",value:x.actual_end_date,onChange:b,className:"input-field"})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"work_days",className:"label",children:"Â∑•‰ΩúÂ§©Êï∏ (ÂèØÊâãÂãïËº∏ÂÖ•)"}),y.jsx("input",{type:"number",id:"work_days",name:"work_days",value:x.work_days,onChange:b,min:"0",placeholder:f?f.toString():"",className:"input-field"})]})]})]}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"actual_progress",className:"label",children:"ÂØ¶ÈöõÂÆåÊàêÈÄ≤Â∫¶ (%)"}),y.jsx("input",{type:"number",id:"actual_progress",name:"actual_progress",value:x.actual_progress,onChange:b,min:"0",max:"100",className:"input-field"})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"status",className:"label",children:"ÁãÄÊÖã"}),y.jsxs("select",{id:"status",name:"status",value:x.status,onChange:b,className:"input-field",children:[y.jsx("option",{value:"Êú™ÈñãÂßã",children:"Êú™ÈñãÂßã"}),y.jsx("option",{value:"ÈÄ≤Ë°å‰∏≠",children:"ÈÄ≤Ë°å‰∏≠"}),y.jsx("option",{value:"Â∑≤ÂÆåÊàê",children:"Â∑≤ÂÆåÊàê"})]})]})]}),y.jsxs("div",{className:"flex items-center",children:[y.jsx("input",{type:"checkbox",id:"is_internal",name:"is_internal",checked:x.is_internal,onChange:b,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),y.jsx("label",{htmlFor:"is_internal",className:"ml-2 block text-sm text-gray-700",children:"ÂÖßÈÉ®ÂÆâÊéí"})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"notes",className:"label",children:"ÂÇôË®ª"}),y.jsx("textarea",{id:"notes",name:"notes",value:x.notes,onChange:b,rows:"3",className:"input-field"})]}),y.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[y.jsx("button",{type:"button",onClick:a,className:"btn-secondary",children:"ÂèñÊ∂à"}),y.jsx("button",{type:"submit",className:"btn-primary",children:t?"Êõ¥Êñ∞":"Êñ∞Â¢û"})]})]})},Qt=()=>{const[t,s]=a(),[n,r]=e.useState(!1),[l,i]=e.useState(null),[c,d]=e.useState(t.get("project")||"PRJ001"),[o,x]=e.useState({status:"",parent_wbs_id:""}),[m,u]=e.useState({overdueOnly:!1,dueThisWeek:!1,ownerUnit:"",wbsCode:""}),[p,h]=e.useState(""),[g,j]=e.useState(!1),[f,b]=e.useState(new Set),[v,_]=e.useState(!1),[N,w]=e.useState(1),k=e.useRef(null),{wbsList:S,loading:C,error:E,total:O,fetchWBS:D,createWBS:R,updateWBS:F,deleteWBS:T}=Kt(),{loading:P,error:$,importWBSFromExcel:L,exportWBSToExcel:B,downloadWBSTemplate:A}=Yt(),{projectsList:M,fetchProjects:I}=qt(),{issuesList:U,fetchIssues:W}=Vt(),{systemSettings:H,fetchSystemSettings:q,getSystemSetting:z}=Gt();e.useEffect(()=>{I(),q()},[I,q]),e.useEffect(()=>{if(c){const e=z("items_per_page",1e3);W({project_id:c,limit:e})}},[W,c,H,z]),e.useEffect(()=>{const e=z("items_per_page",1e3),t=(N-1)*e;D({project_id:c,...o,limit:e,skip:t})},[D,c,o,N,H,z]),e.useEffect(()=>{w(1)},[c,o,m]),e.useEffect(()=>{c&&s({project:c})},[c,s]),e.useEffect(()=>{if(p){const e=setTimeout(()=>h(""),5e3);return()=>clearTimeout(e)}},[p]),e.useEffect(()=>{if(S.length>0&&!v){const e=new Set,t=V(S),s=t=>{t.forEach(t=>{t.children&&t.children.length>0&&(e.add(t.wbs_id),s(t.children))})};s(t),b(e),_(!0)}},[S,v]);const J=async e=>{try{l?(await F(l.item_id,e),h("Êõ¥Êñ∞ÊàêÂäü"),r(!1),i(null),j(!1)):(await R(e),h("Êñ∞Â¢ûÊàêÂäü"),i(null),j(!0));const t=z("items_per_page",1e3);D({project_id:c,...o,limit:t})}catch(t){alert(`Êìç‰ΩúÂ§±Êïó: ${t.message}`)}},K=()=>{r(!1),i(null),j(!1)},Y=e=>{switch(e){case"Â∑≤ÂÆåÊàê":return"bg-green-100 text-green-800";case"ÈÄ≤Ë°å‰∏≠":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},V=e=>{const t=new Map;e.forEach(e=>{t.set(e.wbs_id,{...e,children:[]})});const s=[];e.forEach(e=>{const a=t.get(e.wbs_id);if(e.parent_id){const n=e.parent_id.includes("_")?e.parent_id.split("_")[1]:e.parent_id,r=t.get(n);r?r.children.push(a):s.push(a)}else s.push(a)});const a=e=>{e.children&&e.children.length>0&&(e.children.sort((e,t)=>{const s=e.wbs_id.split(".").map(Number),a=t.wbs_id.split(".").map(Number);for(let n=0;n<Math.max(s.length,a.length);n++){const e=s[n]||0,t=a[n]||0;if(e!==t)return e-t}return 0}),e.children.forEach(e=>a(e)))};return s.sort((e,t)=>{const s=e.wbs_id.split(".").map(Number),a=t.wbs_id.split(".").map(Number);for(let n=0;n<Math.max(s.length,a.length);n++){const e=s[n]||0,t=a[n]||0;if(e!==t)return e-t}return 0}),s.forEach(e=>a(e)),s.length>0&&console.log("WBS Tree Structure:",s.map(e=>{var t,s;return{wbs_id:e.wbs_id,task_name:e.task_name,children_count:(null==(t=e.children)?void 0:t.length)||0,children:null==(s=e.children)?void 0:s.map(e=>e.wbs_id)}})),s},G=(e,t=0)=>{const s=[];return e.forEach(e=>{s.push({...e,level:t}),e.children&&e.children.length>0&&f.has(e.wbs_id)&&s.push(...G(e.children,t+1))}),s},X=(()=>{let e=[...S];if(o.parent_wbs_id&&(e=e.filter(e=>{if(e.wbs_id===o.parent_wbs_id)return!0;if(e.parent_id){return(e.parent_id.includes("_")?e.parent_id.split("_")[1]:e.parent_id)===o.parent_wbs_id}return!1})),m.ownerUnit&&m.ownerUnit.trim()&&(e=e.filter(e=>{var t;return null==(t=e.owner_unit)?void 0:t.toLowerCase().includes(m.ownerUnit.toLowerCase())})),m.wbsCode&&m.wbsCode.trim()&&(e=e.filter(e=>{var t;return null==(t=e.wbs_id)?void 0:t.toLowerCase().includes(m.wbsCode.toLowerCase())})),m.overdueOnly&&(e=e.filter(e=>!0===e.is_overdue)),m.dueThisWeek){const t=new Date,s=new Date(t);s.setDate(t.getDate()+7),e=e.filter(e=>{const a=e.revised_planned_end||e.original_planned_end;if(!a)return!1;const n=new Date(a);return n>=t&&n<=s})}const t=V(e);return G(t)})();return n?y.jsxs("div",{className:"container mx-auto px-4 py-8",children:[y.jsx(Xt,{initialData:l,onSubmit:J,onCancel:K,projectId:c,availableWBSList:S}),g&&!l&&y.jsx("div",{className:"mt-4 flex justify-center",children:y.jsx("button",{onClick:K,className:"btn-secondary",children:"‚Üê ÂõûÂà∞ÂàóË°®"})})]}):y.jsxs("div",{className:"container mx-auto px-4 py-8",children:[y.jsxs("div",{className:"mb-6",children:[y.jsxs("div",{className:"flex justify-between items-center mb-4",children:[y.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"WBS È†ÖÁõÆÁÆ°ÁêÜ"}),y.jsxs("div",{className:"flex gap-2",children:[y.jsx("button",{onClick:async()=>{try{await A(),h("ÁØÑÊú¨‰∏ãËºâÊàêÂäüÔºÅ")}catch(e){alert(`‰∏ãËºâÁØÑÊú¨Â§±Êïó: ${e.message}`)}},className:"btn-secondary",disabled:P,children:"üì• ‰∏ãËºâÁØÑÊú¨"}),y.jsx("button",{onClick:()=>{var e;null==(e=k.current)||e.click()},className:"btn-secondary",disabled:P||!c,children:"üì§ ÂåØÂÖ• Excel"}),y.jsx("button",{onClick:async()=>{if(c)try{await B(c),h("ÂåØÂá∫ÊàêÂäüÔºÅ")}catch(e){alert(`ÂåØÂá∫Â§±Êïó: ${e.message}`)}else alert("Ë´ãÂÖàÈÅ∏ÊìáÂ∞àÊ°à")},className:"btn-secondary",disabled:P||!c,children:"üìä ÂåØÂá∫ Excel"}),y.jsx("button",{onClick:()=>{i(null),r(!0)},className:"btn-primary",children:"+ Êñ∞Â¢û WBS"})]})]}),y.jsx("input",{type:"file",ref:k,onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s)if(c)try{const e=await L(s,c);let t=`ÊàêÂäüÂåØÂÖ• ${e.imported} Á≠ÜÔºåÂ§±Êïó ${e.failed} Á≠Ü`;if(e.failed>0&&e.failed_items&&(t+="\n\nÂ§±ÊïóÈ†ÖÁõÆË©≥ÊÉÖÔºö",e.failed_items.forEach(e=>{t+=`\nÁ¨¨ ${e.row} Ë°å (${e.wbs_id}): ${e.error}`})),e.imported>0?h(t):alert("ÂåØÂÖ•Â§±Êïó\n"+t),e.imported>0){const e=z("items_per_page",1e3);await D({project_id:c,...o,limit:e})}k.current&&(k.current.value="")}catch(a){alert(`ÂåØÂÖ•Â§±Êïó: ${a.message}`)}else alert("Ë´ãÂÖàÈÅ∏ÊìáÂ∞àÊ°à")},accept:".xlsx,.xls",className:"hidden"}),y.jsxs("div",{className:"flex gap-4 items-center",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"project-select",className:"label",children:"Â∞àÊ°à"}),y.jsx("select",{id:"project-select",value:c,onChange:e=>d(e.target.value),className:"input-field",children:0===M.length?y.jsx("option",{value:"",children:"Ë´ãÂÖàÂª∫Á´ãÂ∞àÊ°à"}):y.jsxs(y.Fragment,{children:[y.jsx("option",{value:"",children:"Ë´ãÈÅ∏ÊìáÂ∞àÊ°à"}),M.map(e=>y.jsxs("option",{value:e.project_id,children:[e.project_id," - ",e.project_name]},e.project_id))]})})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"parent-wbs-filter",className:"label",children:"Áà∂ WBS ID"}),y.jsxs("select",{id:"parent-wbs-filter",value:o.parent_wbs_id,onChange:e=>x({...o,parent_wbs_id:e.target.value}),className:"input-field",children:[y.jsx("option",{value:"",children:"ÂÖ®ÈÉ®"}),S.filter(e=>!e.parent_id).sort((e,t)=>{const s=e.wbs_id.split(".").map(Number),a=t.wbs_id.split(".").map(Number);for(let n=0;n<Math.max(s.length,a.length);n++){const e=s[n]||0,t=a[n]||0;if(e!==t)return e-t}return 0}).map(e=>y.jsxs("option",{value:e.wbs_id,children:[e.wbs_id," - ",e.task_name]},e.item_id))]})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"status-filter",className:"label",children:"ÁãÄÊÖã"}),y.jsxs("select",{id:"status-filter",value:o.status,onChange:e=>x({...o,status:e.target.value}),className:"input-field",children:[y.jsx("option",{value:"",children:"ÂÖ®ÈÉ®"}),y.jsx("option",{value:"Êú™ÈñãÂßã",children:"Êú™ÈñãÂßã"}),y.jsx("option",{value:"ÈÄ≤Ë°å‰∏≠",children:"ÈÄ≤Ë°å‰∏≠"}),y.jsx("option",{value:"Â∑≤ÂÆåÊàê",children:"Â∑≤ÂÆåÊàê"})]})]}),y.jsx("div",{className:"mt-6",children:y.jsx("button",{onClick:()=>{const e=z("items_per_page",1e3),t=(N-1)*e;D({project_id:c,...o,limit:e,skip:t})},className:"btn-secondary",children:"ÊêúÂ∞ã"})})]}),y.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[y.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Êô∫ÊÖßÁØ©ÈÅ∏"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:[y.jsxs("div",{className:"flex flex-col gap-1",children:[y.jsx("label",{className:"text-sm text-gray-700 font-medium",children:"Ë≤†Ë≤¨ÂñÆ‰Ωç"}),y.jsx("input",{type:"text",value:m.ownerUnit,onChange:e=>u({...m,ownerUnit:e.target.value}),placeholder:"Ëº∏ÂÖ•Ë≤†Ë≤¨ÂñÆ‰Ωç",className:"input-field text-sm"})]}),y.jsxs("div",{className:"flex flex-col gap-1",children:[y.jsx("label",{className:"text-sm text-gray-700 font-medium",children:"WBS Code"}),y.jsx("input",{type:"text",value:m.wbsCode,onChange:e=>u({...m,wbsCode:e.target.value}),placeholder:"Ëº∏ÂÖ• WBS Á∑®Ëôü",className:"input-field text-sm"})]}),y.jsxs("label",{className:"flex items-center text-sm",children:[y.jsx("input",{type:"checkbox",checked:m.overdueOnly,onChange:e=>u({...m,overdueOnly:e.target.checked}),className:"mr-2 rounded"}),y.jsxs("span",{className:"text-gray-700 flex items-center",children:["Âè™ÁúãÈÄæÊúüÈ†ÖÁõÆ",y.jsx("span",{className:"ml-1 text-red-500",children:"‚ö†Ô∏è"})]})]}),y.jsxs("label",{className:"flex items-center text-sm",children:[y.jsx("input",{type:"checkbox",checked:m.dueThisWeek,onChange:e=>u({...m,dueThisWeek:e.target.checked}),className:"mr-2 rounded"}),y.jsx("span",{className:"text-gray-700",children:"Âè™ÁúãÊú¨ÈÄ±Âà∞Êúü"})]}),(m.ownerUnit||m.wbsCode||m.overdueOnly||m.dueThisWeek)&&y.jsx("button",{onClick:()=>u({overdueOnly:!1,dueThisWeek:!1,ownerUnit:"",wbsCode:""}),className:"text-sm text-primary-600 hover:text-primary-800 underline self-end",children:"Ê∏ÖÈô§ÊâÄÊúâÁØ©ÈÅ∏"})]})]})]}),p&&y.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded mb-4",children:p}),(E||$)&&y.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4",children:E||$}),C&&y.jsxs("div",{className:"text-center py-8",children:[y.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),y.jsx("p",{className:"mt-2 text-gray-600",children:"ËºâÂÖ•‰∏≠..."})]}),!C&&y.jsxs(y.Fragment,{children:[y.jsxs("div",{className:"mb-3 flex justify-end gap-2",children:[y.jsx("button",{onClick:()=>{const e=new Set,t=s=>{s.forEach(s=>{s.children&&s.children.length>0&&(e.add(s.wbs_id),t(s.children))})},s=V(S);t(s),b(e)},className:"text-sm px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded",children:"‚ûï ÂÖ®ÈÉ®Â±ïÈñã"}),y.jsx("button",{onClick:()=>{b(new Set)},className:"text-sm px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded",children:"‚ûñ ÂÖ®ÈÉ®Êî∂Ëµ∑"})]}),y.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-x-auto",children:y.jsxs("table",{className:"w-full divide-y divide-gray-200 text-sm",children:[y.jsx("thead",{className:"bg-gray-50",children:y.jsxs("tr",{children:[y.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase",style:{width:"120px"},children:"WBS ID"}),y.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase",style:{minWidth:"150px"},children:"‰ªªÂãôÂêçÁ®±"}),y.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase",style:{width:"100px"},children:"Ë≤†Ë≤¨ÂñÆ‰Ωç"}),y.jsx("th",{className:"px-1 py-2 text-left text-xs font-medium text-gray-500 uppercase",style:{width:"85px"},children:"È†êË®àÈñãÂßã"}),y.jsx("th",{className:"px-1 py-2 text-left text-xs font-medium text-gray-500 uppercase",style:{width:"85px"},children:"È†êË®àÁµêÊùü"}),y.jsx("th",{className:"px-1 py-2 text-left text-xs font-medium text-gray-500 uppercase",style:{width:"85px"},children:"Ë™øÊï¥ÈñãÂßã"}),y.jsx("th",{className:"px-1 py-2 text-left text-xs font-medium text-gray-500 uppercase",style:{width:"85px"},children:"Ë™øÊï¥ÁµêÊùü"}),y.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase",style:{width:"100px"},children:"ÈÄ≤Â∫¶"}),y.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase",style:{width:"70px"},children:"ÁãÄÊÖã"}),y.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase",style:{width:"100px"},children:"Êìç‰Ωú"})]})}),y.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:0===X.length?y.jsx("tr",{children:y.jsx("td",{colSpan:"10",className:"px-6 py-4 text-center text-gray-500",children:0===S.length?"Êö´ÁÑ°Ë≥áÊñô":"ÁÑ°Á¨¶ÂêàÁØ©ÈÅ∏Ê¢ù‰ª∂ÁöÑË≥áÊñô"})}):X.map(e=>{return y.jsxs("tr",{className:e.is_overdue?"bg-red-50":"",children:[y.jsx("td",{className:"px-2 py-2 whitespace-nowrap text-xs font-medium text-gray-900",children:y.jsxs("div",{className:"flex items-center gap-1",children:[y.jsx("span",{style:{width:20*e.level+"px"},className:"inline-block"}),e.children&&e.children.length>0?y.jsx("button",{onClick:()=>{return t=e.wbs_id,void b(e=>{const s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s});var t},className:"w-5 h-5 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded",title:f.has(e.wbs_id)?"Êî∂Ëµ∑":"Â±ïÈñã",children:f.has(e.wbs_id)?"‚ñº":"‚ñ∂"}):y.jsx("span",{className:"w-5 h-5 inline-block"}),y.jsx("span",{className:e.level>0?"text-blue-600":"text-gray-900 font-bold",children:e.wbs_id})]})}),y.jsx("td",{className:"px-2 py-2 text-xs text-gray-900",children:y.jsxs("div",{className:"flex items-center gap-1",children:[y.jsx("span",{className:e.level>0?"font-normal":"font-semibold",children:e.task_name}),e.is_overdue&&y.jsx("span",{className:"text-red-500",children:"‚ö†Ô∏è"}),(()=>{const t=(s=e.wbs_id,U&&0!==U.length?U.filter(e=>!!e.affected_wbs&&e.affected_wbs.split(",").map(e=>e.trim()).includes(s)).length:0);var s;return t>0?y.jsxs("span",{className:"px-2 py-0.5 bg-orange-100 text-orange-800 text-xs rounded-full font-semibold",title:`${t} ÂÄãÁõ∏ÈóúÂïèÈ°å`,children:[t," ÂïèÈ°å"]}):null})()]})}),y.jsx("td",{className:"px-2 py-2 whitespace-nowrap text-xs text-gray-500",children:e.owner_unit||"-"}),y.jsx("td",{className:"px-1 py-2 whitespace-nowrap text-xs text-gray-500",children:e.original_planned_start?e.original_planned_start.substring(5).replace("-","/"):"-"}),y.jsx("td",{className:"px-1 py-2 whitespace-nowrap text-xs text-gray-500",children:e.original_planned_end?e.original_planned_end.substring(5).replace("-","/"):"-"}),y.jsx("td",{className:"px-1 py-2 whitespace-nowrap text-xs text-gray-500",children:e.revised_planned_start?y.jsx("span",{className:"text-blue-600",children:e.revised_planned_start.substring(5).replace("-","/")}):"-"}),y.jsx("td",{className:"px-1 py-2 whitespace-nowrap text-xs text-gray-500",children:e.revised_planned_end?y.jsx("span",{className:"text-blue-600",children:e.revised_planned_end.substring(5).replace("-","/")}):"-"}),y.jsx("td",{className:"px-2 py-2 whitespace-nowrap text-xs",children:y.jsxs("div",{className:"flex flex-col",children:[y.jsxs("div",{className:"flex items-center",children:[y.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2 mr-2",children:y.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${e.actual_progress}%`}})}),y.jsxs("span",{className:"text-gray-900 font-semibold",children:[e.actual_progress,"%"]}),void 0!==e.progress_variance&&0!==e.progress_variance&&y.jsxs("span",{className:"ml-2 text-xs "+(t=e.progress_variance,t>0?"text-green-600":t<0?"text-red-600":"text-gray-600"),children:["(",e.progress_variance>0?"+":"",e.progress_variance,")"]})]}),void 0!==e.estimated_progress&&y.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["È†ê‰º∞: ",e.estimated_progress,"%"]})]})}),y.jsx("td",{className:"px-2 py-2 whitespace-nowrap",children:y.jsx("span",{className:`px-1.5 py-0.5 inline-flex text-xs leading-tight font-semibold rounded ${Y(e.status)}`,children:e.status})}),y.jsxs("td",{className:"px-2 py-2 whitespace-nowrap text-xs font-medium",children:[y.jsx("button",{onClick:()=>(e=>{i(e),r(!0)})(e),className:"text-primary-600 hover:text-primary-900 mr-2",children:"Á∑®ËºØ"}),y.jsx("button",{onClick:()=>(async e=>{if(window.confirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§ WBS È†ÖÁõÆ„Äå${e.task_name}„ÄçÂóéÔºü`))try{await T(e.item_id),alert("Âà™Èô§ÊàêÂäü");const t=z("items_per_page",1e3);D({project_id:c,...o,limit:t})}catch(t){alert(`Âà™Èô§Â§±Êïó: ${t.message}`)}})(e),className:"text-red-600 hover:text-red-900",children:"Âà™Èô§"})]})]},e.item_id);var t})})]})}),y.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[y.jsx("div",{className:"text-sm text-gray-600",children:X.length!==S.length?y.jsxs(y.Fragment,{children:["È°ØÁ§∫ ",X.length," Á≠ÜÔºàÂÖ± ",O," Á≠ÜË≥áÊñôÔºâ"]}):y.jsxs(y.Fragment,{children:["ÂÖ± ",O," Á≠ÜË≥áÊñô",(()=>{const e=z("items_per_page",1e3);if(Math.ceil(O/e)>1){return` | È°ØÁ§∫Á¨¨ ${(N-1)*e+1}-${Math.min(N*e,O)} Á≠Ü`}return null})()]})}),(()=>{const e=z("items_per_page",1e3),t=Math.ceil(O/e);return t<=1?null:y.jsxs("div",{className:"flex items-center gap-2",children:[y.jsx("button",{onClick:()=>w(e=>Math.max(1,e-1)),disabled:1===N,className:"px-3 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"‚Üê ‰∏ä‰∏ÄÈ†Å"}),y.jsxs("span",{className:"text-sm text-gray-600",children:["Á¨¨ ",N," / ",t," È†Å"]}),y.jsx("button",{onClick:()=>w(e=>Math.min(t,e+1)),disabled:N===t,className:"px-3 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"‰∏ã‰∏ÄÈ†Å ‚Üí"}),y.jsx("select",{value:N,onChange:e=>w(Number(e.target.value)),className:"ml-2 px-2 py-1 text-sm border border-gray-300 rounded",children:Array.from({length:t},(e,t)=>t+1).map(e=>y.jsxs("option",{value:e,children:["Á¨¨ ",e," È†Å"]},e))})]})})()]})]})]})},Zt=()=>{const[t,s]=a(),n=t.get("project_id")||"",[r,l]=e.useState([]),[i,c]=e.useState(!1),[d,o]=e.useState(null),[x,m]=e.useState(new Set),{projectsList:u,fetchProjects:p}=qt();e.useEffect(()=>{p()},[]),e.useEffect(()=>{n?h():l([])},[n]);const h=async()=>{try{c(!0),o(null);const e=await Wt.get(`/wbs/tree/${n}`);l(e.tree||[]);const t=new Set,s=e=>{e.forEach(e=>{t.add(e.item_id),e.children&&e.children.length>0&&s(e.children)})};s(e.tree||[]),m(t)}catch(e){o(e.message||"ËºâÂÖ•Ê®πÁãÄÁµêÊßãÂ§±Êïó"),l([])}finally{c(!1)}},g=e=>{switch(e){case"Â∑≤ÂÆåÊàê":return"text-green-600 bg-green-50";case"ÈÄ≤Ë°å‰∏≠":return"text-blue-600 bg-blue-50";default:return"text-gray-600 bg-gray-50"}},j=({node:e,level:t=0})=>{const s=e.children&&e.children.length>0,a=x.has(e.item_id);return y.jsxs("div",{className:"tree-node",children:[y.jsxs("div",{className:"flex items-center py-2 px-3 hover:bg-gray-50 border-b border-gray-100",style:{paddingLeft:2*t+.75+"rem"},children:[y.jsx("div",{className:"w-6 flex-shrink-0",children:s&&y.jsx("button",{onClick:()=>{return t=e.item_id,void m(e=>{const s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s});var t},className:"text-gray-600 hover:text-gray-900 focus:outline-none",children:a?y.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}):y.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})}),y.jsx("div",{className:"w-24 flex-shrink-0 font-mono text-sm font-semibold text-gray-700",children:e.wbs_id}),y.jsx("div",{className:"flex-1 min-w-0 px-2",children:y.jsx("span",{className:"text-sm text-gray-900",children:e.task_name})}),y.jsx("div",{className:"w-20 flex-shrink-0 text-center",children:y.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-purple-50 text-purple-700",children:e.category})}),y.jsx("div",{className:"w-32 flex-shrink-0 text-sm text-gray-600 truncate",children:e.owner_unit}),y.jsx("div",{className:"w-24 flex-shrink-0 text-center",children:y.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${g(e.status)}`,children:e.status})}),y.jsxs("div",{className:"w-32 flex-shrink-0 text-sm text-center",children:[y.jsxs("span",{className:(e.actual_progress,n=e.progress_variance,n<-10?"text-red-600":n<0?"text-orange-600":n>10?"text-green-600":"text-gray-700"),children:[e.actual_progress,"%"]}),0!==e.progress_variance&&y.jsxs("span",{className:"text-xs ml-1",children:["(",e.progress_variance>0?"+":"",e.progress_variance,")"]})]}),y.jsx("div",{className:"w-64 flex-shrink-0 text-xs",children:e.revised_planned_start||e.revised_planned_end?y.jsxs("div",{className:"space-y-1",children:[y.jsxs("div",{className:"text-gray-400 line-through",children:["Âéü: ",e.original_planned_start," ~ ",e.original_planned_end]}),y.jsxs("div",{className:"text-blue-600 font-semibold",children:["Ë™ø: ",e.revised_planned_start||e.original_planned_start," ~ ",e.revised_planned_end||e.original_planned_end]})]}):y.jsxs("div",{className:"text-gray-600",children:[e.original_planned_start," ~ ",e.original_planned_end]})})]}),s&&a&&y.jsx("div",{className:"tree-children",children:e.children.map(e=>y.jsx(j,{node:e,level:t+1},e.item_id))})]});var n};return y.jsxs("div",{className:"container mx-auto px-4 py-6",children:[y.jsxs("div",{className:"mb-6",children:[y.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"WBS Ê®πÁãÄÈöéÂ±§Ë¶ñÂúñ"}),y.jsx("p",{className:"text-gray-600",children:"‰ª•ÈöéÂ±§ÁµêÊßãÊü•ÁúãÂ∞àÊ°à WBS È†ÖÁõÆ"})]}),y.jsx("div",{className:"bg-white rounded-lg shadow mb-6 p-4",children:y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"project_id",className:"label",children:"ÈÅ∏ÊìáÂ∞àÊ°à *"}),y.jsxs("select",{id:"project_id",value:n,onChange:e=>{const t=e.target.value;s(t?{project_id:t}:{})},className:"input-field",children:[y.jsx("option",{value:"",children:"-- Ë´ãÈÅ∏ÊìáÂ∞àÊ°à --"}),u.map(e=>y.jsxs("option",{value:e.project_id,children:[e.project_id," - ",e.project_name]},e.project_id))]})]}),y.jsxs("div",{className:"flex items-end gap-2",children:[y.jsx("button",{onClick:()=>{const e=new Set,t=s=>{s.forEach(s=>{e.add(s.item_id),s.children&&s.children.length>0&&t(s.children)})};t(r),m(new Set(e))},disabled:!n||i,className:"btn-secondary",children:"ÂÖ®ÈÉ®Â±ïÈñã"}),y.jsx("button",{onClick:()=>{m(()=>new Set)},disabled:!n||i,className:"btn-secondary",children:"ÂÖ®ÈÉ®ÊäòÁñä"})]})]})}),n?i?y.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[y.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),y.jsx("p",{className:"mt-2 text-gray-600",children:"ËºâÂÖ•‰∏≠..."})]}):d?y.jsx("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:y.jsx("p",{className:"text-red-600",children:d})}):0===r.length?y.jsx("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:y.jsx("p",{className:"text-gray-500",children:"Ê≠§Â∞àÊ°àÁõÆÂâçÊ≤íÊúâ WBS È†ÖÁõÆ"})}):y.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[y.jsxs("div",{className:"bg-gray-50 border-b border-gray-200 px-3 py-3 flex items-center font-semibold text-sm text-gray-700",children:[y.jsx("div",{className:"w-6 flex-shrink-0"}),y.jsx("div",{className:"w-24 flex-shrink-0",children:"WBS ID"}),y.jsx("div",{className:"flex-1 min-w-0 px-2",children:"‰ªªÂãôÂêçÁ®±"}),y.jsx("div",{className:"w-20 flex-shrink-0 text-center",children:"È°ûÂà•"}),y.jsx("div",{className:"w-32 flex-shrink-0",children:"Ë≤†Ë≤¨ÂñÆ‰Ωç"}),y.jsx("div",{className:"w-24 flex-shrink-0 text-center",children:"ÁãÄÊÖã"}),y.jsx("div",{className:"w-32 flex-shrink-0 text-center",children:"ÈÄ≤Â∫¶"}),y.jsx("div",{className:"w-64 flex-shrink-0",children:"Ë®àÁï´ÊúüÈñì (ÂéüÂßã/Ë™øÊï¥)"})]}),y.jsx("div",{className:"tree-root",children:r.map(e=>y.jsx(j,{node:e,level:0},e.item_id))})]}):y.jsx("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:y.jsx("p",{className:"text-gray-500",children:"Ë´ãÈÅ∏ÊìáÂ∞àÊ°à‰ª•Êü•Áúã WBS Ê®πÁãÄÁµêÊßã"})})]})},es=({analysis:e,onClose:t})=>{if(!e)return null;const s=e=>e||"-";return y.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:y.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-5xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:y.jsxs("div",{className:"p-6",children:[y.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200",children:[y.jsxs("div",{children:[y.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"ÊôÇÁ®ãÂΩ±ÈüøÂàÜÊûê"}),y.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["ËÆäÊõ¥‰æÜÊ∫ê: ",y.jsx("span",{className:"font-semibold",children:e.source_wbs_id})," - ",e.source_task_name]})]}),y.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:"‚úï"})]}),y.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:[y.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"ÊôÇÁ®ãËÆäÊõ¥ÊëòË¶Å"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[y.jsxs("div",{children:[y.jsx("span",{className:"text-gray-600",children:"ËÆäÊõ¥Ê¨Ñ‰Ωç: "}),y.jsx("span",{className:"font-semibold",children:e.date_change.field})]}),y.jsxs("div",{children:[y.jsx("span",{className:"text-gray-600",children:"ÂéüÂßãÊó•Êúü: "}),y.jsx("span",{className:"font-semibold",children:s(e.date_change.old_value)})]}),y.jsxs("div",{children:[y.jsx("span",{className:"text-gray-600",children:"Êñ∞Êó•Êúü: "}),y.jsx("span",{className:"font-semibold text-blue-600",children:s(e.date_change.new_value)})]})]})]}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[y.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg text-center",children:[y.jsx("div",{className:"text-3xl font-bold text-gray-900",children:e.total_affected}),y.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"ÂèóÂΩ±ÈüøÈ†ÖÁõÆÊï∏"})]}),y.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg text-center",children:[y.jsx("div",{className:"text-3xl font-bold text-orange-600",children:e.affected_items.filter(e=>e.delay_days>0).length}),y.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"ÈúÄË¶ÅÂª∂Âæå"})]}),y.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg text-center",children:[y.jsx("div",{className:"text-3xl font-bold "+(e.critical_path_affected?"text-red-600":"text-green-600"),children:e.critical_path_affected?"ÊòØ":"Âê¶"}),y.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"ÂΩ±ÈüøÈóúÈçµË∑ØÂæë"})]})]}),y.jsxs("div",{children:[y.jsxs("h3",{className:"font-semibold text-gray-700 mb-3",children:["Âª∫Ë≠∞Ë™øÊï¥Ë®àÁï´ (",e.affected_items.length," È†Ö)"]}),0===e.affected_items.length?y.jsx("div",{className:"text-center py-8 text-gray-500",children:"Ê≤íÊúâÈ†ÖÁõÆÂèóÂà∞ÂΩ±Èüø"}):y.jsx("div",{className:"overflow-x-auto",children:y.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[y.jsx("thead",{className:"bg-gray-50",children:y.jsxs("tr",{children:[y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"WBS ID"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"‰ªªÂãôÂêçÁ®±"}),y.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"ÁõÆÂâçÈñãÂßã"}),y.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Âª∫Ë≠∞ÈñãÂßã"}),y.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"ÁõÆÂâçÁµêÊùü"}),y.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Âª∫Ë≠∞ÁµêÊùü"}),y.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Âª∂ÈÅ≤Â§©Êï∏"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"ÂéüÂõ†"})]})}),y.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.affected_items.map((e,t)=>{return y.jsxs("tr",{className:e.delay_days>5?"bg-red-50":e.delay_days>0?"bg-yellow-50":"",children:[y.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:e.wbs_id}),y.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 max-w-xs truncate",children:e.task_name}),y.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:s(e.current_start)}),y.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.suggested_start?y.jsx("span",{className:"font-semibold text-blue-600",children:s(e.suggested_start)}):y.jsx("span",{className:"text-gray-400",children:"-"})}),y.jsx("td",{className:"px-4 py-3 text-sm text-center text-gray-600",children:s(e.current_end)}),y.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.suggested_end?y.jsx("span",{className:"font-semibold text-blue-600",children:s(e.suggested_end)}):y.jsx("span",{className:"text-gray-400",children:"-"})}),y.jsx("td",{className:"px-4 py-3 text-sm text-center",children:y.jsxs("span",{className:"font-semibold "+(a=e.delay_days,0===a?"text-gray-700":a>0?"text-red-600":"text-green-600"),children:[e.delay_days>0?`+${e.delay_days}`:e.delay_days," Â§©"]})}),y.jsxs("td",{className:"px-4 py-3 text-sm text-gray-600 max-w-xs",children:[e.reason,e.dependency_chain.length>0&&y.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Èèà: ",e.dependency_chain.join(" ‚Üí ")]})]})]},t);var a})})]})})]}),y.jsxs("div",{className:"mt-6 flex justify-end gap-3 pt-4 border-t border-gray-200",children:[y.jsx("button",{onClick:t,className:"btn-secondary",children:"ÈóúÈñâ"}),y.jsx("button",{onClick:()=>{alert("Â•óÁî®Ë™øÊï¥ÂäüËÉΩÈñãÁôº‰∏≠...")},className:"btn-primary",disabled:0===e.affected_items.length,children:"Â•óÁî®Âª∫Ë≠∞Ë™øÊï¥"})]})]})})})},ts=()=>{const[t,s]=a(),n=t.get("project_id")||"",[r,l]=e.useState([]),[i,c]=e.useState(!1),[d,o]=e.useState(null),[x,m]=e.useState(!1),[u,p]=e.useState(null),[h,g]=e.useState(null),[j,f]=e.useState(!1),{projectsList:b,fetchProjects:v}=qt(),{wbsList:_,fetchWBS:N}=Kt(),[w,k]=e.useState({predecessor_id:"",successor_id:"",dependency_type:"FS",lag_days:0,impact_level:"Medium",impact_description:"",is_active:!0});e.useEffect(()=>{v()},[]),e.useEffect(()=>{n?(N({project_id:n,limit:1e3}),S()):l([])},[n]);const S=async()=>{try{c(!0),o(null);const e=await Wt.get("/dependencies/",{params:{project_id:n,limit:1e3}});l(e.items||[])}catch(e){o(e.message||"ËºâÂÖ•‰æùË≥¥Èóú‰øÇÂ§±Êïó")}finally{c(!1)}},C=e=>{const{name:t,value:s,type:a,checked:n}=e.target;k(e=>({...e,[t]:"checkbox"===a?n:s}))},E=()=>{k({predecessor_id:"",successor_id:"",dependency_type:"FS",lag_days:0,impact_level:"Medium",impact_description:"",is_active:!0}),p(null),m(!1)};return y.jsxs("div",{className:"container mx-auto px-4 py-6",children:[y.jsxs("div",{className:"mb-6",children:[y.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"‰æùË≥¥Èóú‰øÇÁÆ°ÁêÜ"}),y.jsx("p",{className:"text-gray-600",children:"ÁÆ°ÁêÜ WBS È†ÖÁõÆ‰πãÈñìÁöÑ‰æùË≥¥Èóú‰øÇÔºåÂàÜÊûêÊôÇÁ®ãÂΩ±Èüø"})]}),y.jsx("div",{className:"bg-white rounded-lg shadow mb-6 p-4",children:y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"project_id",className:"label",children:"ÈÅ∏ÊìáÂ∞àÊ°à *"}),y.jsxs("select",{id:"project_id",value:n,onChange:e=>{const t=e.target.value;s(t?{project_id:t}:{})},className:"input-field",children:[y.jsx("option",{value:"",children:"-- Ë´ãÈÅ∏ÊìáÂ∞àÊ°à --"}),b.map(e=>y.jsxs("option",{value:e.project_id,children:[e.project_id," - ",e.project_name]},e.project_id))]})]}),y.jsx("div",{className:"flex items-end",children:y.jsx("button",{onClick:()=>m(!x),disabled:!n,className:"btn-primary",children:x?"ÂèñÊ∂àÊñ∞Â¢û":"+ Êñ∞Â¢û‰æùË≥¥Èóú‰øÇ"})})]})}),x&&n&&y.jsxs("div",{className:"bg-blue-50 rounded-lg shadow mb-6 p-6",children:[y.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:u?"Á∑®ËºØ‰æùË≥¥Èóú‰øÇ":"Êñ∞Â¢û‰æùË≥¥Èóú‰øÇ"}),y.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),w.predecessor_id&&w.successor_id)if(w.predecessor_id!==w.successor_id)try{u?(await Wt.put(`/dependencies/${u}`,w),alert("‰æùË≥¥Èóú‰øÇÂ∑≤Êõ¥Êñ∞")):(await Wt.post("/dependencies/",w),alert("‰æùË≥¥Èóú‰øÇÂ∑≤Êñ∞Â¢û")),E(),S()}catch(t){alert(`Êìç‰ΩúÂ§±Êïó: ${t.message}`)}else alert("ÂâçÁΩÆÈ†ÖÁõÆÂíåÂæåÁ∫åÈ†ÖÁõÆ‰∏çËÉΩÁõ∏Âêå");else alert("Ë´ãÈÅ∏ÊìáÂâçÁΩÆÈ†ÖÁõÆÂíåÂæåÁ∫åÈ†ÖÁõÆ")},className:"space-y-4",children:[y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{className:"label",children:"ÂâçÁΩÆÈ†ÖÁõÆ (Ë¢´‰æùË≥¥ÁöÑ) *"}),y.jsxs("select",{name:"predecessor_id",value:w.predecessor_id,onChange:C,className:"input-field",required:!0,children:[y.jsx("option",{value:"",children:"-- ÈÅ∏ÊìáÂâçÁΩÆÈ†ÖÁõÆ --"}),_.map(e=>y.jsxs("option",{value:e.item_id,children:[e.wbs_id," - ",e.task_name]},e.item_id))]})]}),y.jsxs("div",{children:[y.jsx("label",{className:"label",children:"ÂæåÁ∫åÈ†ÖÁõÆ (‰æùË≥¥Âà•‰∫∫ÁöÑ) *"}),y.jsxs("select",{name:"successor_id",value:w.successor_id,onChange:C,className:"input-field",required:!0,children:[y.jsx("option",{value:"",children:"-- ÈÅ∏ÊìáÂæåÁ∫åÈ†ÖÁõÆ --"}),_.map(e=>y.jsxs("option",{value:e.item_id,children:[e.wbs_id," - ",e.task_name]},e.item_id))]})]}),y.jsxs("div",{children:[y.jsx("label",{className:"label",children:"‰æùË≥¥È°ûÂûã *"}),y.jsxs("select",{name:"dependency_type",value:w.dependency_type,onChange:C,className:"input-field",children:[y.jsx("option",{value:"FS",children:"FS (Finish-to-Start) - ÂÆåÊàêÂæåÊâçËÉΩÈñãÂßã"}),y.jsx("option",{value:"SS",children:"SS (Start-to-Start) - ÈñãÂßãÂæåÊâçËÉΩÈñãÂßã"}),y.jsx("option",{value:"FF",children:"FF (Finish-to-Finish) - ÂÆåÊàêÂæåÊâçËÉΩÂÆåÊàê"}),y.jsx("option",{value:"SF",children:"SF (Start-to-Finish) - ÈñãÂßãÂæåÊâçËÉΩÂÆåÊàê"})]})]}),y.jsxs("div",{children:[y.jsx("label",{className:"label",children:"Âª∂ÈÅ≤Â§©Êï∏ (Lag/Lead)"}),y.jsx("input",{type:"number",name:"lag_days",value:w.lag_days,onChange:C,className:"input-field",placeholder:"Ê≠£Êï∏=Âª∂ÈÅ≤ÔºåË≤†Êï∏=ÊèêÂâç"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"label",children:"ÂΩ±ÈüøÁ®ãÂ∫¶"}),y.jsxs("select",{name:"impact_level",value:w.impact_level,onChange:C,className:"input-field",children:[y.jsx("option",{value:"Critical",children:"Critical"}),y.jsx("option",{value:"High",children:"High"}),y.jsx("option",{value:"Medium",children:"Medium"}),y.jsx("option",{value:"Low",children:"Low"})]})]}),y.jsx("div",{children:y.jsxs("label",{className:"label flex items-center",children:[y.jsx("input",{type:"checkbox",name:"is_active",checked:w.is_active,onChange:C,className:"mr-2"}),"ÂïüÁî®Ê≠§‰æùË≥¥Èóú‰øÇ"]})})]}),y.jsxs("div",{children:[y.jsx("label",{className:"label",children:"ÂΩ±ÈüøË™™Êòé"}),y.jsx("textarea",{name:"impact_description",value:w.impact_description,onChange:C,className:"input-field",rows:"2",placeholder:"ÊèèËø∞Ê≠§‰æùË≥¥Èóú‰øÇÁöÑÂΩ±ÈüøÁØÑÂúç..."})]}),y.jsxs("div",{className:"flex gap-2",children:[y.jsx("button",{type:"submit",className:"btn-primary",children:u?"Êõ¥Êñ∞":"Êñ∞Â¢û"}),y.jsx("button",{type:"button",onClick:E,className:"btn-secondary",children:"ÂèñÊ∂à"})]})]})]}),n?i?y.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[y.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),y.jsx("p",{className:"mt-2 text-gray-600",children:"ËºâÂÖ•‰∏≠..."})]}):d?y.jsx("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:y.jsx("p",{className:"text-red-600",children:d})}):0===r.length?y.jsx("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:y.jsx("p",{className:"text-gray-500",children:"Ê≠§Â∞àÊ°àÁõÆÂâçÊ≤íÊúâ‰æùË≥¥Èóú‰øÇ"})}):y.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:y.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[y.jsx("thead",{className:"bg-gray-50",children:y.jsxs("tr",{children:[y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"ÂâçÁΩÆÈ†ÖÁõÆ"}),y.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"È°ûÂûã"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"ÂæåÁ∫åÈ†ÖÁõÆ"}),y.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Âª∂ÈÅ≤"}),y.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"ÂΩ±Èüø"}),y.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"ÁãÄÊÖã"}),y.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Êìç‰Ωú"})]})}),y.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(e=>{return y.jsxs("tr",{className:e.is_active?"":"opacity-50",children:[y.jsxs("td",{className:"px-4 py-4",children:[y.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.predecessor_wbs_id}),y.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:e.predecessor_task_name})]}),y.jsx("td",{className:"px-4 py-4 text-center",children:y.jsx("span",{className:"text-xs font-semibold px-2 py-1 bg-purple-100 text-purple-700 rounded",children:e.dependency_type})}),y.jsxs("td",{className:"px-4 py-4",children:[y.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.successor_wbs_id}),y.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:e.successor_task_name})]}),y.jsx("td",{className:"px-4 py-4 text-center",children:y.jsxs("span",{className:"text-sm text-gray-700",children:[e.lag_days>0?`+${e.lag_days}`:e.lag_days," Â§©"]})}),y.jsx("td",{className:"px-4 py-4 text-center",children:y.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${t=e.impact_level,{Critical:"text-red-600 bg-red-50",High:"text-orange-600 bg-orange-50",Medium:"text-yellow-600 bg-yellow-50",Low:"text-green-600 bg-green-50"}[t]||"text-gray-600 bg-gray-50"}`,children:e.impact_level})}),y.jsx("td",{className:"px-4 py-4 text-center",children:y.jsx("span",{className:"text-xs px-2 py-1 rounded-full "+(e.is_active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"),children:e.is_active?"ÂïüÁî®":"ÂÅúÁî®"})}),y.jsx("td",{className:"px-4 py-4 text-center",children:y.jsxs("div",{className:"flex gap-2 justify-center",children:[y.jsx("button",{onClick:()=>(e=>{k({predecessor_id:e.predecessor_id,successor_id:e.successor_id,dependency_type:e.dependency_type,lag_days:e.lag_days,impact_level:e.impact_level,impact_description:e.impact_description||"",is_active:e.is_active}),p(e.dependency_id),m(!0)})(e),className:"text-blue-600 hover:text-blue-900 text-sm",children:"Á∑®ËºØ"}),y.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§‰æùË≥¥Èóú‰øÇÂóéÔºü"))try{await Wt.delete(`/dependencies/${e}`),alert("‰æùË≥¥Èóú‰øÇÂ∑≤Âà™Èô§"),S()}catch(t){alert(`Âà™Èô§Â§±Êïó: ${t.message}`)}})(e.dependency_id),className:"text-red-600 hover:text-red-900 text-sm",children:"Âà™Èô§"}),y.jsx("button",{onClick:()=>(async e=>{try{c(!0);const t=await Wt.post(`/dependencies/item/${e.predecessor_id}/analyze-impact`,{field:"revised_planned_end",old_value:"2024-01-01",new_value:"2024-01-15"});g(t),f(!0)}catch(t){alert(`ÂàÜÊûêÂ§±Êïó: ${t.message}`)}finally{c(!1)}})(e),className:"text-green-600 hover:text-green-900 text-sm",children:"ÂàÜÊûêÂΩ±Èüø"})]})})]},e.dependency_id);var t})})]})}):y.jsx("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:y.jsx("p",{className:"text-gray-500",children:"Ë´ãÈÅ∏ÊìáÂ∞àÊ°à‰ª•Êü•Áúã‰æùË≥¥Èóú‰øÇ"})}),j&&h&&y.jsx(es,{analysis:h,onClose:()=>{f(!1),g(null)}})]})},ss=({initialData:t=null,onSubmit:s,onCancel:a,projectId:n})=>{const[r,l]=e.useState({project_id:n||"",task_date:(()=>{const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`})(),source_type:"ÂÆ¢Êà∂",contact_info:"",description:"",planned_start_date:"",expected_completion_date:"",handling_notes:"",related_wbs:"",related_action_item:"",related_issue_id:"",status:"ÂæÖËôïÁêÜ",priority:"Medium"}),[i,c]=e.useState({}),{wbsList:d,fetchWBS:o}=Kt(),{issuesList:x,fetchIssues:m}=Vt(),{projectsList:u,fetchProjects:p}=qt();e.useEffect(()=>{p()},[]),e.useEffect(()=>{r.project_id&&(o({project_id:r.project_id,limit:1e3}),m({project_id:r.project_id,limit:1e3}))},[r.project_id]),e.useEffect(()=>{t&&l({...t,task_date:t.task_date||"",planned_start_date:t.planned_start_date||"",expected_completion_date:t.expected_completion_date||"",related_issue_id:t.related_issue_id||""})},[t]);const h=e=>{const{name:t,value:s}=e.target;l(e=>({...e,[t]:s})),i[t]&&c(e=>({...e,[t]:null}))};return y.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!(()=>{const e={};return r.project_id||(e.project_id="Ë´ãËº∏ÂÖ•Â∞àÊ°à ID"),r.task_date||(e.task_date="Ë´ãÈÅ∏Êìá‰ªªÂãôÊó•Êúü"),r.source_type||(e.source_type="Ë´ãÈÅ∏Êìá‰æÜÊ∫êÈ°ûÂûã"),r.description||(e.description="Ë´ãËº∏ÂÖ•‰ªªÂãôË™™Êòé"),c(e),0===Object.keys(e).length})())return;const t={...r,related_issue_id:r.related_issue_id?parseInt(r.related_issue_id):null};Object.keys(t).forEach(e=>{""===t[e]&&(t[e]=null)}),s(t)},className:"space-y-6 bg-white p-6 rounded-lg shadow",children:[y.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t?"Á∑®ËºØÂæÖËæ¶È†ÖÁõÆ":"Êñ∞Â¢ûÂæÖËæ¶È†ÖÁõÆ"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"project_id",className:"label",children:"Â∞àÊ°à *"}),y.jsx("select",{id:"project_id",name:"project_id",value:r.project_id,onChange:h,disabled:!!t,className:"input-field",children:0===u.length?y.jsx("option",{value:"",children:"Ë´ãÂÖàÂª∫Á´ãÂ∞àÊ°à"}):y.jsxs(y.Fragment,{children:[y.jsx("option",{value:"",children:"Ë´ãÈÅ∏ÊìáÂ∞àÊ°à"}),u.map(e=>y.jsxs("option",{value:e.project_id,children:[e.project_id," - ",e.project_name]},e.project_id))]})}),i.project_id&&y.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.project_id})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"task_date",className:"label",children:"‰ªªÂãôÊó•Êúü *"}),y.jsx("input",{type:"date",id:"task_date",name:"task_date",value:r.task_date,onChange:h,className:"input-field"}),i.task_date&&y.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.task_date})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"source_type",className:"label",children:"‰æÜÊ∫êÈ°ûÂûã *"}),y.jsxs("select",{id:"source_type",name:"source_type",value:r.source_type,onChange:h,className:"input-field",children:[y.jsx("option",{value:"ÂÆ¢Êà∂",children:"ÂÆ¢Êà∂"}),y.jsx("option",{value:"Ëá™Â∑±",children:"Ëá™Â∑±"}),y.jsx("option",{value:"ÂÖßÈÉ®",children:"ÂÖßÈÉ®"})]}),i.source_type&&y.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.source_type})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"priority",className:"label",children:"ÂÑ™ÂÖàÁ¥ö"}),y.jsxs("select",{id:"priority",name:"priority",value:r.priority,onChange:h,className:"input-field",children:[y.jsx("option",{value:"High",children:"High"}),y.jsx("option",{value:"Medium",children:"Medium"}),y.jsx("option",{value:"Low",children:"Low"})]})]}),y.jsxs("div",{className:"md:col-span-2",children:[y.jsx("label",{htmlFor:"contact_info",className:"label",children:"ËÅØÁµ°‰∫∫Ë≥áË®ä"}),y.jsx("input",{type:"text",id:"contact_info",name:"contact_info",value:r.contact_info,onChange:h,placeholder:"‰æãÂ¶Ç: ÁéãÂ∞èÊòé (ÂÆ¢Êà∂Á™óÂè£)",className:"input-field"})]}),y.jsxs("div",{className:"md:col-span-2",children:[y.jsx("label",{htmlFor:"description",className:"label",children:"‰ªªÂãôË™™Êòé *"}),y.jsx("textarea",{id:"description",name:"description",value:r.description,onChange:h,rows:"3",className:"input-field"}),i.description&&y.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.description})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"planned_start_date",className:"label",children:"È†êË®àÈñãÂßãÊó•Êúü"}),y.jsx("input",{type:"date",id:"planned_start_date",name:"planned_start_date",value:r.planned_start_date,onChange:h,className:"input-field"})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"expected_completion_date",className:"label",children:"È†êË®àÂÆåÊàêÊó•Êúü"}),y.jsx("input",{type:"date",id:"expected_completion_date",name:"expected_completion_date",value:r.expected_completion_date,onChange:h,className:"input-field"})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"status",className:"label",children:"ÁãÄÊÖã"}),y.jsxs("select",{id:"status",name:"status",value:r.status,onChange:h,className:"input-field",children:[y.jsx("option",{value:"ÂæÖËôïÁêÜ",children:"ÂæÖËôïÁêÜ"}),y.jsx("option",{value:"ËôïÁêÜ‰∏≠",children:"ËôïÁêÜ‰∏≠"}),y.jsx("option",{value:"Â∑≤ÂÆåÊàê",children:"Â∑≤ÂÆåÊàê"}),y.jsx("option",{value:"Â∑≤ÂèñÊ∂à",children:"Â∑≤ÂèñÊ∂à"})]})]}),y.jsxs("div",{className:"md:col-span-2",children:[y.jsx("label",{htmlFor:"handling_notes",className:"label",children:"ËôïÁêÜÂÇôË®ª"}),y.jsx("textarea",{id:"handling_notes",name:"handling_notes",value:r.handling_notes,onChange:h,rows:"2",placeholder:"Ë®òÈåÑËôïÁêÜÈÅéÁ®ãÊàñÂÇôË®ª",className:"input-field"})]})]}),y.jsxs("div",{children:[y.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"ÈóúËÅØÈ†ÖÁõÆ"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"related_wbs",className:"label",children:"ÈóúËÅØ WBS"}),y.jsxs("select",{id:"related_wbs",name:"related_wbs",value:r.related_wbs,onChange:h,className:"input-field",children:[y.jsx("option",{value:"",children:"-- Ë´ãÈÅ∏Êìá WBS --"}),d&&d.length>0?d.map(e=>y.jsxs("option",{value:e.wbs_id,children:[e.wbs_id," - ",e.task_name]},e.item_id)):y.jsx("option",{value:"",disabled:!0,children:"ËºâÂÖ•‰∏≠..."})]})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"related_action_item",className:"label",children:"ÈóúËÅØ Action Item"}),y.jsx("input",{type:"text",id:"related_action_item",name:"related_action_item",value:r.related_action_item,onChange:h,placeholder:"ÊâãÂãïËº∏ÂÖ• Action Item",className:"input-field"})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"related_issue_id",className:"label",children:"ÈóúËÅØ Issue"}),y.jsxs("select",{id:"related_issue_id",name:"related_issue_id",value:r.related_issue_id,onChange:h,className:"input-field",children:[y.jsx("option",{value:"",children:"-- Ë´ãÈÅ∏Êìá Issue --"}),x&&x.length>0?x.map(e=>y.jsxs("option",{value:e.issue_id,children:[e.issue_number," - ",e.issue_title]},e.issue_id)):y.jsx("option",{value:"",disabled:!0,children:"ËºâÂÖ•‰∏≠..."})]})]})]})]}),y.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[y.jsx("button",{type:"button",onClick:a,className:"btn-secondary",children:"ÂèñÊ∂à"}),y.jsx("button",{type:"submit",className:"btn-primary",children:t?"Êõ¥Êñ∞":"Êñ∞Â¢û"})]})]})},as=({pendingItem:t,onClose:s,onReplyAdded:a})=>{const[n,r]=e.useState([]),[l,i]=e.useState(!0),[c,d]=e.useState(!1),[o,x]=e.useState({replied_by:"",reply_content:"",reply_date:(new Date).toISOString().split("T")[0]});e.useEffect(()=>{m()},[t.pending_id]);const m=async()=>{try{i(!0);const e=await Wt.get(`/pending/${t.pending_id}/replies`);r(e)}catch(e){console.error("Failed to fetch replies:",e)}finally{i(!1)}};return y.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:y.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:y.jsxs("div",{className:"p-6",children:[y.jsxs("div",{className:"flex justify-between items-center mb-4",children:[y.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"ÂõûË¶ÜÊ≠∑Âè≤"}),y.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:"‚úï"})]}),y.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:[y.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"ÂæÖËæ¶‰∫ãÈ†Ö"}),y.jsx("p",{className:"text-gray-900",children:t.description}),y.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[y.jsxs("span",{children:["‰æÜÊ∫ê: ",t.source_type]}),t.expected_reply_date&&y.jsxs("span",{className:"ml-4",children:["È†êË®àÂõûË¶Ü: ",t.expected_reply_date]})]})]}),!c&&y.jsx("button",{onClick:()=>d(!0),className:"btn-primary mb-4",children:"+ Êñ∞Â¢ûÂõûË¶Ü"}),c&&y.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),o.replied_by.trim())try{await Wt.post(`/pending/${t.pending_id}/replies`,o),alert("ÂõûË¶ÜÂ∑≤Ê∑ªÂä†"),x({replied_by:"",reply_content:"",reply_date:(new Date).toISOString().split("T")[0]}),d(!1),m(),a&&a()}catch(s){alert(`Ê∑ªÂä†ÂõûË¶ÜÂ§±Êïó: ${s.message}`)}else alert("Ë´ãËº∏ÂÖ•ÂõûË¶Ü‰∫∫")},className:"bg-blue-50 p-4 rounded-lg mb-4",children:[y.jsx("h4",{className:"font-semibold text-gray-700 mb-3",children:"Êñ∞Â¢ûÂõûË¶Ü"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[y.jsxs("div",{children:[y.jsx("label",{className:"label",children:"ÂõûË¶Ü‰∫∫ *"}),y.jsx("input",{type:"text",value:o.replied_by,onChange:e=>x({...o,replied_by:e.target.value}),className:"input-field",placeholder:"Ëº∏ÂÖ•ÂõûË¶Ü‰∫∫ÂßìÂêç"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"label",children:"ÂõûË¶ÜÊó•Êúü"}),y.jsx("input",{type:"date",value:o.reply_date,onChange:e=>x({...o,reply_date:e.target.value}),className:"input-field"})]})]}),y.jsxs("div",{className:"mb-4",children:[y.jsx("label",{className:"label",children:"ÂõûË¶ÜÂÖßÂÆπ"}),y.jsx("textarea",{value:o.reply_content,onChange:e=>x({...o,reply_content:e.target.value}),className:"input-field",rows:"3",placeholder:"Ëº∏ÂÖ•ÂõûË¶ÜÂÖßÂÆπÔºàÈÅ∏Â°´Ôºâ"})]}),y.jsxs("div",{className:"flex gap-2",children:[y.jsx("button",{type:"submit",className:"btn-primary",children:"ÈÄÅÂá∫"}),y.jsx("button",{type:"button",onClick:()=>d(!1),className:"btn-secondary",children:"ÂèñÊ∂à"})]})]}),y.jsxs("div",{children:[y.jsxs("h4",{className:"font-semibold text-gray-700 mb-3",children:["ÂõûË¶ÜË®òÈåÑ (",n.length,")"]}),l?y.jsxs("div",{className:"text-center py-8",children:[y.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),y.jsx("p",{className:"mt-2 text-gray-600",children:"ËºâÂÖ•‰∏≠..."})]}):0===n.length?y.jsx("div",{className:"text-center py-8 text-gray-500",children:"Â∞öÁÑ°ÂõûË¶ÜË®òÈåÑ"}):y.jsx("div",{className:"space-y-3",children:n.map((e,t)=>y.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:[y.jsxs("div",{className:"flex justify-between items-start mb-2",children:[y.jsxs("div",{children:[y.jsx("span",{className:"font-semibold text-gray-900",children:e.replied_by}),y.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["#",n.length-t]})]}),y.jsx("span",{className:"text-sm text-gray-600",children:e.reply_date})]}),e.reply_content&&y.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:e.reply_content}),y.jsxs("div",{className:"mt-2 text-xs text-gray-400",children:["Âª∫Á´ãÊôÇÈñì: ",new Date(e.created_at).toLocaleString("zh-TW")]})]},e.reply_id))})]}),y.jsx("div",{className:"mt-6 flex justify-end",children:y.jsx("button",{onClick:s,className:"btn-secondary",children:"ÈóúÈñâ"})})]})})})},ns=()=>{const[t,s]=a(),[n,r]=e.useState(!1),[l,i]=e.useState(null),[c,d]=e.useState(!1),[o,x]=e.useState(null),[m,u]=e.useState(t.get("project")||"PRJ001"),[p,h]=e.useState({status:"",source_type:"",priority:""}),[g,j]=e.useState({clientSource:!1,selfResponsibility:!1,internalOnly:!1,overdueOnly:!1,dueThisWeek:!1,notCompleted:!1,dateRange:""}),{pendingList:f,loading:b,error:v,total:_,fetchPending:N,createPending:w,updatePending:k,deletePending:S}=(()=>{const[t,s]=e.useState([]),[a,n]=e.useState(!1),[r,l]=e.useState(null),[i,c]=e.useState(0);return{pendingList:t,loading:a,error:r,total:i,fetchPending:e.useCallback(async(e={})=>{n(!0),l(null);try{const t={...e},a=await Wt.get("/pending/",{params:t});s(a.items||[]),c(a.total||0)}catch(t){l(t.message),s([])}finally{n(!1)}},[]),getPending:e.useCallback(async e=>{n(!0),l(null);try{return await Wt.get(`/pending/${e}`)}catch(t){throw l(t.message),t}finally{n(!1)}},[]),createPending:e.useCallback(async e=>{n(!0),l(null);try{return await Wt.post("/pending/",e)}catch(t){throw l(t.message),t}finally{n(!1)}},[]),updatePending:e.useCallback(async(e,t)=>{n(!0),l(null);try{return await Wt.put(`/pending/${e}`,t)}catch(s){throw l(s.message),s}finally{n(!1)}},[]),deletePending:e.useCallback(async e=>{n(!0),l(null);try{await Wt.delete(`/pending/${e}`)}catch(t){throw l(t.message),t}finally{n(!1)}},[]),markAsReplied:e.useCallback(async e=>{n(!0),l(null);try{return await Wt.put(`/pending/${e}/reply`)}catch(t){throw l(t.message),t}finally{n(!1)}},[]),getOverdueItems:e.useCallback(async(e=null)=>{n(!0),l(null);try{const t=e?{project_id:e}:{};return await Wt.get("/pending/overdue",{params:t})}catch(t){throw l(t.message),t}finally{n(!1)}},[]),getStats:e.useCallback(async(e=null)=>{n(!0),l(null);try{const t=e?{project_id:e}:{};return await Wt.get("/pending/stats",{params:t})}catch(t){throw l(t.message),t}finally{n(!1)}},[])}})(),{projectsList:C,fetchProjects:E}=qt(),{loading:O,exportPendingToExcel:D}=Yt();e.useEffect(()=>{E()},[E]),e.useEffect(()=>{N({project_id:m,...p})},[N,m,p]),e.useEffect(()=>{m&&s({project:m})},[m,s]);const R=async e=>{try{l?(await k(l.pending_id,e),alert("Êõ¥Êñ∞ÊàêÂäü")):(await w(e),alert("Êñ∞Â¢ûÊàêÂäü")),r(!1),i(null),N({project_id:m,...p})}catch(t){alert(`Êìç‰ΩúÂ§±Êïó: ${t.message}`)}},F=()=>{r(!1),i(null)},T=e=>{switch(e){case"Â∑≤ÂÆåÊàê":return"bg-green-100 text-green-800";case"ËôïÁêÜ‰∏≠":return"bg-blue-100 text-blue-800";case"ÂæÖËôïÁêÜ":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},P=e=>{switch(e){case"High":return"bg-red-100 text-red-800";case"Medium":return"bg-orange-100 text-orange-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},$=e=>{switch(e){case"ÂÆ¢Êà∂":return"bg-purple-100 text-purple-800";case"Ëá™Â∑±":return"bg-blue-100 text-blue-800";case"ÂÖßÈÉ®":return"bg-cyan-100 text-cyan-800";default:return"bg-gray-100 text-gray-800"}},L=(()=>{let e=[...f];if(g.clientSource&&(e=e.filter(e=>"ÂÆ¢Êà∂"===e.source_type)),g.selfResponsibility&&(e=e.filter(e=>"Ëá™Â∑±"===e.source_type)),g.internalOnly&&(e=e.filter(e=>"ÂÖßÈÉ®"===e.source_type)),g.overdueOnly&&(e=e.filter(e=>!0===e.is_overdue)),g.dueThisWeek){const t=new Date,s=new Date(t);s.setDate(t.getDate()+7),e=e.filter(e=>{if(!e.expected_completion_date)return!1;const a=new Date(e.expected_completion_date);return a>=t&&a<=s})}if(g.notCompleted&&(e=e.filter(e=>"ÂæÖËôïÁêÜ"===e.status||"ËôïÁêÜ‰∏≠"===e.status)),g.dateRange){const t=new Date;t.setHours(0,0,0,0),e=e.filter(e=>{if(!e.task_date)return!1;const s=new Date(e.task_date);switch(s.setHours(0,0,0,0),g.dateRange){case"today":return s.getTime()===t.getTime();case"yesterday":const e=new Date(t);return e.setDate(e.getDate()-1),s.getTime()===e.getTime();case"last7days":const a=new Date(t);return a.setDate(a.getDate()-7),s>=a&&s<=t;case"last30days":const n=new Date(t);return n.setDate(n.getDate()-30),s>=n&&s<=t;case"thisMonth":return s.getMonth()===t.getMonth()&&s.getFullYear()===t.getFullYear();case"lastMonth":const r=new Date(t.getFullYear(),t.getMonth()-1,1),l=new Date(t.getFullYear(),t.getMonth(),0);return s>=r&&s<=l;default:return!0}})}return e})();return n?y.jsx("div",{className:"container mx-auto px-4 py-8",children:y.jsx(ss,{initialData:l,onSubmit:R,onCancel:F,projectId:m})}):y.jsxs("div",{className:"container mx-auto px-4 py-8",children:[y.jsxs("div",{className:"mb-6",children:[y.jsxs("div",{className:"flex justify-between items-center mb-4",children:[y.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ÂæÖËæ¶Ê∏ÖÂñÆÁÆ°ÁêÜ"}),y.jsxs("div",{className:"flex gap-2",children:[y.jsx("button",{onClick:async()=>{if(m)try{await D(m),alert("ÂåØÂá∫ÊàêÂäü")}catch(e){alert(`ÂåØÂá∫Â§±Êïó: ${e.message}`)}else alert("Ë´ãÂÖàÈÅ∏ÊìáÂ∞àÊ°à")},disabled:O,className:"btn-secondary",children:O?"ÂåØÂá∫‰∏≠...":"üì• ÂåØÂá∫ Excel"}),y.jsx("button",{onClick:()=>{i(null),r(!0)},className:"btn-primary",children:"+ Êñ∞Â¢ûÂæÖËæ¶È†ÖÁõÆ"})]})]}),y.jsxs("div",{className:"flex gap-4 items-center flex-wrap",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"project-select",className:"label",children:"Â∞àÊ°à"}),y.jsx("select",{id:"project-select",value:m,onChange:e=>u(e.target.value),className:"input-field",children:0===C.length?y.jsx("option",{value:"",children:"Ë´ãÂÖàÂª∫Á´ãÂ∞àÊ°à"}):y.jsxs(y.Fragment,{children:[y.jsx("option",{value:"",children:"Ë´ãÈÅ∏ÊìáÂ∞àÊ°à"}),C.map(e=>y.jsxs("option",{value:e.project_id,children:[e.project_id," - ",e.project_name]},e.project_id))]})})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"source-filter",className:"label",children:"‰æÜÊ∫ê"}),y.jsxs("select",{id:"source-filter",value:p.source_type,onChange:e=>h({...p,source_type:e.target.value}),className:"input-field",children:[y.jsx("option",{value:"",children:"ÂÖ®ÈÉ®"}),y.jsx("option",{value:"ÂÆ¢Êà∂",children:"ÂÆ¢Êà∂"}),y.jsx("option",{value:"Ëá™Â∑±",children:"Ëá™Â∑±"}),y.jsx("option",{value:"ÂÖßÈÉ®",children:"ÂÖßÈÉ®"})]})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"status-filter",className:"label",children:"ÁãÄÊÖã"}),y.jsxs("select",{id:"status-filter",value:p.status,onChange:e=>h({...p,status:e.target.value}),className:"input-field",children:[y.jsx("option",{value:"",children:"ÂÖ®ÈÉ®"}),y.jsx("option",{value:"ÂæÖËôïÁêÜ",children:"ÂæÖËôïÁêÜ"}),y.jsx("option",{value:"ËôïÁêÜ‰∏≠",children:"ËôïÁêÜ‰∏≠"}),y.jsx("option",{value:"Â∑≤ÂÆåÊàê",children:"Â∑≤ÂÆåÊàê"}),y.jsx("option",{value:"Â∑≤ÂèñÊ∂à",children:"Â∑≤ÂèñÊ∂à"})]})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"priority-filter",className:"label",children:"ÂÑ™ÂÖàÁ¥ö"}),y.jsxs("select",{id:"priority-filter",value:p.priority,onChange:e=>h({...p,priority:e.target.value}),className:"input-field",children:[y.jsx("option",{value:"",children:"ÂÖ®ÈÉ®"}),y.jsx("option",{value:"High",children:"High"}),y.jsx("option",{value:"Medium",children:"Medium"}),y.jsx("option",{value:"Low",children:"Low"})]})]}),y.jsx("div",{className:"mt-6",children:y.jsx("button",{onClick:()=>N({project_id:m,...p}),className:"btn-secondary",children:"ÊêúÂ∞ã"})})]}),y.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[y.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Êô∫ÊÖßÁØ©ÈÅ∏"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[y.jsxs("label",{className:"flex items-center text-sm",children:[y.jsx("input",{type:"checkbox",checked:g.clientSource,onChange:e=>j({...g,clientSource:e.target.checked}),className:"mr-2 rounded"}),y.jsx("span",{className:"text-gray-700",children:"Âè™ÁúãÂÆ¢Êà∂‰æÜÊ∫ê"})]}),y.jsxs("label",{className:"flex items-center text-sm",children:[y.jsx("input",{type:"checkbox",checked:g.selfResponsibility,onChange:e=>j({...g,selfResponsibility:e.target.checked}),className:"mr-2 rounded"}),y.jsx("span",{className:"text-gray-700",children:"Âè™ÁúãËá™Â∑±Ë≤†Ë≤¨"})]}),y.jsxs("label",{className:"flex items-center text-sm",children:[y.jsx("input",{type:"checkbox",checked:g.internalOnly,onChange:e=>j({...g,internalOnly:e.target.checked}),className:"mr-2 rounded"}),y.jsx("span",{className:"text-gray-700",children:"Âè™ÁúãÂÖßÈÉ®È†ÖÁõÆ"})]}),y.jsxs("label",{className:"flex items-center text-sm",children:[y.jsx("input",{type:"checkbox",checked:g.overdueOnly,onChange:e=>j({...g,overdueOnly:e.target.checked}),className:"mr-2 rounded"}),y.jsxs("span",{className:"text-gray-700 flex items-center",children:["Âè™ÁúãÈÄæÊúüÈ†ÖÁõÆ",y.jsx("span",{className:"ml-1 text-red-500",children:"‚ö†Ô∏è"})]})]}),y.jsxs("label",{className:"flex items-center text-sm",children:[y.jsx("input",{type:"checkbox",checked:g.dueThisWeek,onChange:e=>j({...g,dueThisWeek:e.target.checked}),className:"mr-2 rounded"}),y.jsx("span",{className:"text-gray-700",children:"Âè™ÁúãÊú¨ÈÄ±Âà∞Êúü"})]}),y.jsxs("label",{className:"flex items-center text-sm",children:[y.jsx("input",{type:"checkbox",checked:g.notCompleted,onChange:e=>j({...g,notCompleted:e.target.checked}),className:"mr-2 rounded"}),y.jsx("span",{className:"text-gray-700",children:"Âè™ÁúãÊú™ÂÆåÊàê"})]}),y.jsxs("div",{className:"md:col-span-2 lg:col-span-1",children:[y.jsx("label",{htmlFor:"date-range-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"‰ªªÂãôÊó•ÊúüÂçÄÈñì"}),y.jsxs("select",{id:"date-range-filter",value:g.dateRange,onChange:e=>j({...g,dateRange:e.target.value}),className:"input-field text-sm w-full",children:[y.jsx("option",{value:"",children:"ÂÖ®ÈÉ®Êó•Êúü"}),y.jsx("option",{value:"today",children:"‰ªäÂ§©"}),y.jsx("option",{value:"yesterday",children:"Êò®Â§©"}),y.jsx("option",{value:"last7days",children:"ÊúÄËøë 7 Â§©"}),y.jsx("option",{value:"last30days",children:"ÊúÄËøë 30 Â§©"}),y.jsx("option",{value:"thisMonth",children:"Êú¨Êúà"}),y.jsx("option",{value:"lastMonth",children:"‰∏äÂÄãÊúà"})]})]}),Object.values(g).some(e=>e)&&y.jsx("button",{onClick:()=>j({clientSource:!1,selfResponsibility:!1,internalOnly:!1,overdueOnly:!1,dueThisWeek:!1,notCompleted:!1,dateRange:""}),className:"text-sm text-primary-600 hover:text-primary-800 underline",children:"Ê∏ÖÈô§ÊâÄÊúâÁØ©ÈÅ∏"})]})]})]}),v&&y.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4",children:v}),b&&y.jsxs("div",{className:"text-center py-8",children:[y.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),y.jsx("p",{className:"mt-2 text-gray-600",children:"ËºâÂÖ•‰∏≠..."})]}),!b&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-x-auto",children:y.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[y.jsx("thead",{className:"bg-gray-50",children:y.jsxs("tr",{children:[y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"‰ªªÂãôÊó•Êúü"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"‰æÜÊ∫ê"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ë™™Êòé"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"È†êË®àÈñãÂßã"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"È†êË®àÂÆåÊàê"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ÂØ¶ÈöõÂÆåÊàê"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ÂÑ™ÂÖàÁ¥ö"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ÁãÄÊÖã"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Êìç‰Ωú"})]})}),y.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:0===L.length?y.jsx("tr",{children:y.jsx("td",{colSpan:"9",className:"px-6 py-4 text-center text-gray-500",children:0===f.length?"Êö´ÁÑ°Ë≥áÊñô":"ÁÑ°Á¨¶ÂêàÁØ©ÈÅ∏Ê¢ù‰ª∂ÁöÑË≥áÊñô"})}):L.map(e=>y.jsxs("tr",{className:e.is_overdue?"bg-red-50":"",children:[y.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.task_date,e.is_overdue&&y.jsx("span",{className:"ml-2 text-red-500",children:"‚ö†Ô∏è"})]}),y.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:y.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${$(e.source_type)}`,children:e.source_type})}),y.jsxs("td",{className:"px-4 py-4 text-sm text-gray-900 max-w-xs",children:[y.jsx("div",{className:"truncate",children:e.description}),e.related_wbs&&y.jsxs("div",{className:"text-xs text-gray-500 mt-1 flex items-center gap-1",children:[y.jsx("span",{className:"font-semibold",children:"ÂΩ±Èüø:"}),y.jsx("span",{className:"truncate",children:e.related_wbs})]})]}),y.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500",children:e.planned_start_date||"-"}),y.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.expected_completion_date||"-",null!==e.days_until_due&&e.days_until_due<0&&y.jsxs("span",{className:"ml-2 text-red-600 text-xs",children:["(ÈÄæÊúü ",Math.abs(e.days_until_due)," Â§©)"]})]}),y.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500",children:e.actual_completion_date||"-"}),y.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:y.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${P(e.priority)}`,children:e.priority})}),y.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:y.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${T(e.status)}`,children:e.status})}),y.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium",children:[y.jsx("button",{onClick:()=>(e=>{i(e),r(!0)})(e),className:"text-primary-600 hover:text-primary-900 mr-3",children:"Á∑®ËºØ"}),y.jsx("button",{onClick:()=>(async e=>{if(window.confirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§ÂæÖËæ¶È†ÖÁõÆ„Äå${e.description.substring(0,30)}...„ÄçÂóéÔºü`))try{await S(e.pending_id),alert("Âà™Èô§ÊàêÂäü"),N({project_id:m,...p})}catch(t){alert(`Âà™Èô§Â§±Êïó: ${t.message}`)}})(e),className:"text-red-600 hover:text-red-900",children:"Âà™Èô§"})]})]},e.pending_id))})]})}),y.jsx("div",{className:"mt-4 text-sm text-gray-600",children:L.length!==f.length?y.jsxs(y.Fragment,{children:["È°ØÁ§∫ ",L.length," Á≠ÜÔºàÂÖ± ",_," Á≠ÜË≥áÊñôÔºâ"]}):y.jsxs(y.Fragment,{children:["ÂÖ± ",_," Á≠ÜË≥áÊñô"]})})]}),c&&o&&y.jsx(as,{pendingItem:o,onClose:()=>{d(!1),x(null)},onReplyAdded:()=>{N({project_id:m,...p})}})]})},rs=({initialData:t=null,onSubmit:s,onCancel:a,projectId:n})=>{const[r,l]=e.useState({project_id:n||"",issue_title:"",issue_description:"",issue_type:"ÊäÄË°ìÂïèÈ°å",issue_category:"ÈòªÁ§ôËÄÖ",severity:"Medium",priority:"Medium",reported_by:"",assigned_to:"",owner_type:"ÂÖßÈÉ®",affected_wbs:"",impact_description:"",estimated_impact_days:"",status:"Open",resolution:"",root_cause:"",target_resolution_date:"",reported_date:(new Date).toISOString().split("T")[0],source:"Manual"}),[i,c]=e.useState({}),[d,o]=e.useState([]),{wbsList:x,fetchWBS:m}=Kt(),{projectsList:u,fetchProjects:p}=qt();e.useEffect(()=>{p()},[]),e.useEffect(()=>{r.project_id&&m({project_id:r.project_id,limit:1e3})},[r.project_id]),e.useEffect(()=>{if(t&&(l({...t,target_resolution_date:t.target_resolution_date||"",reported_date:t.reported_date||"",estimated_impact_days:t.estimated_impact_days||""}),t.affected_wbs)){const e=t.affected_wbs.split(",").map(e=>e.trim()).filter(Boolean);o(e)}},[t]);const h=e=>{const{name:t,value:s}=e.target;l(e=>({...e,[t]:s})),i[t]&&c(e=>({...e,[t]:null}))};return y.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!(()=>{const e={};return r.project_id||(e.project_id="Ë´ãËº∏ÂÖ•Â∞àÊ°à ID"),r.issue_title||(e.issue_title="Ë´ãËº∏ÂÖ•ÂïèÈ°åÊ®ôÈ°å"),r.issue_type||(e.issue_type="Ë´ãÈÅ∏ÊìáÂïèÈ°åÈ°ûÂûã"),r.issue_category||(e.issue_category="Ë´ãÈÅ∏ÊìáÂïèÈ°åÂàÜÈ°û"),r.severity||(e.severity="Ë´ãÈÅ∏ÊìáÂö¥ÈáçÊÄß"),r.priority||(e.priority="Ë´ãÈÅ∏ÊìáÂÑ™ÂÖàÁ¥ö"),r.reported_by||(e.reported_by="Ë´ãËº∏ÂÖ•ÂõûÂ†±‰∫∫"),c(e),0===Object.keys(e).length})())return;const t={...r,estimated_impact_days:r.estimated_impact_days?parseInt(r.estimated_impact_days):null,affected_wbs:d.length>0?d.join(", "):null};Object.keys(t).forEach(e=>{""===t[e]&&(t[e]=null)}),s(t)},className:"space-y-6 bg-white p-6 rounded-lg shadow",children:[y.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t?"Á∑®ËºØÂïèÈ°å":"Êñ∞Â¢ûÂïèÈ°å"}),y.jsxs("div",{children:[y.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"Âü∫Êú¨Ë≥áË®ä"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.jsxs("div",{className:"md:col-span-2",children:[y.jsx("label",{htmlFor:"project_id",className:"label",children:"Â∞àÊ°à *"}),y.jsx("select",{id:"project_id",name:"project_id",value:r.project_id,onChange:h,disabled:!!t,className:"input-field",children:0===u.length?y.jsx("option",{value:"",children:"Ë´ãÂÖàÂª∫Á´ãÂ∞àÊ°à"}):y.jsxs(y.Fragment,{children:[y.jsx("option",{value:"",children:"Ë´ãÈÅ∏ÊìáÂ∞àÊ°à"}),u.map(e=>y.jsxs("option",{value:e.project_id,children:[e.project_id," - ",e.project_name]},e.project_id))]})}),i.project_id&&y.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.project_id})]}),y.jsxs("div",{className:"md:col-span-2",children:[y.jsx("label",{htmlFor:"issue_title",className:"label",children:"ÂïèÈ°åÊ®ôÈ°å *"}),y.jsx("input",{type:"text",id:"issue_title",name:"issue_title",value:r.issue_title,onChange:h,className:"input-field"}),i.issue_title&&y.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.issue_title})]}),y.jsxs("div",{className:"md:col-span-2",children:[y.jsx("label",{htmlFor:"issue_description",className:"label",children:"ÂïèÈ°åË™™Êòé"}),y.jsx("textarea",{id:"issue_description",name:"issue_description",value:r.issue_description,onChange:h,rows:"3",className:"input-field"})]})]})]}),y.jsxs("div",{children:[y.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"ÂàÜÈ°û"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"issue_type",className:"label",children:"ÂïèÈ°åÈ°ûÂûã *"}),y.jsxs("select",{id:"issue_type",name:"issue_type",value:r.issue_type,onChange:h,className:"input-field",children:[y.jsx("option",{value:"ÊäÄË°ìÂïèÈ°å",children:"ÊäÄË°ìÂïèÈ°å"}),y.jsx("option",{value:"ÈúÄÊ±ÇÂïèÈ°å",children:"ÈúÄÊ±ÇÂïèÈ°å"}),y.jsx("option",{value:"Ë≥áÊ∫êÂïèÈ°å",children:"Ë≥áÊ∫êÂïèÈ°å"}),y.jsx("option",{value:"ÊôÇÁ®ãÂïèÈ°å",children:"ÊôÇÁ®ãÂïèÈ°å"}),y.jsx("option",{value:"ÂÖ∂‰ªñ",children:"ÂÖ∂‰ªñ"})]}),i.issue_type&&y.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.issue_type})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"issue_category",className:"label",children:"ÂïèÈ°åÂàÜÈ°û *"}),y.jsxs("select",{id:"issue_category",name:"issue_category",value:r.issue_category,onChange:h,className:"input-field",children:[y.jsx("option",{value:"ÈòªÁ§ôËÄÖ",children:"ÈòªÁ§ôËÄÖ"}),y.jsx("option",{value:"È¢®Èö™",children:"È¢®Èö™"}),y.jsx("option",{value:"ËÆäÊõ¥Ë´ãÊ±Ç",children:"ËÆäÊõ¥Ë´ãÊ±Ç"}),y.jsx("option",{value:"Áº∫Èô∑",children:"Áº∫Èô∑"})]}),i.issue_category&&y.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.issue_category})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"severity",className:"label",children:"Âö¥ÈáçÊÄß *"}),y.jsxs("select",{id:"severity",name:"severity",value:r.severity,onChange:h,className:"input-field",children:[y.jsx("option",{value:"Critical",children:"Critical"}),y.jsx("option",{value:"High",children:"High"}),y.jsx("option",{value:"Medium",children:"Medium"}),y.jsx("option",{value:"Low",children:"Low"})]}),i.severity&&y.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.severity})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"priority",className:"label",children:"ÂÑ™ÂÖàÁ¥ö *"}),y.jsxs("select",{id:"priority",name:"priority",value:r.priority,onChange:h,className:"input-field",children:[y.jsx("option",{value:"Urgent",children:"Urgent"}),y.jsx("option",{value:"High",children:"High"}),y.jsx("option",{value:"Medium",children:"Medium"}),y.jsx("option",{value:"Low",children:"Low"})]}),i.priority&&y.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.priority})]})]})]}),y.jsxs("div",{children:[y.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"Ë≤†Ë≤¨‰∫∫"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"reported_by",className:"label",children:"ÂõûÂ†±‰∫∫ *"}),y.jsx("input",{type:"text",id:"reported_by",name:"reported_by",value:r.reported_by,onChange:h,className:"input-field"}),i.reported_by&&y.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.reported_by})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"assigned_to",className:"label",children:"ÊåáÊ¥æÁµ¶"}),y.jsx("input",{type:"text",id:"assigned_to",name:"assigned_to",value:r.assigned_to,onChange:h,className:"input-field"})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"owner_type",className:"label",children:"Ë≤†Ë≤¨È°ûÂûã"}),y.jsxs("select",{id:"owner_type",name:"owner_type",value:r.owner_type,onChange:h,className:"input-field",children:[y.jsx("option",{value:"ÂÆ¢Êà∂",children:"ÂÆ¢Êà∂"}),y.jsx("option",{value:"ÂÖßÈÉ®",children:"ÂÖßÈÉ®"}),y.jsx("option",{value:"Âª†ÂïÜ",children:"Âª†ÂïÜ"})]})]})]})]}),y.jsxs("div",{children:[y.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"ÂΩ±ÈüøÁØÑÂúç"}),y.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"affected_wbs_selector",className:"label",children:"ÂèóÂΩ±ÈüøÁöÑ WBS"}),y.jsxs("select",{id:"affected_wbs_selector",onChange:e=>{var t;e.target.value&&(t=e.target.value,o(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]),e.target.value="")},className:"input-field",children:[y.jsx("option",{value:"",children:"-- ÈªûÊìäÈÅ∏Êìá WBS --"}),x&&x.length>0?x.filter(e=>!d.includes(e.wbs_id)).map(e=>y.jsxs("option",{value:e.wbs_id,children:[e.wbs_id," - ",e.task_name]},e.item_id)):y.jsx("option",{value:"",disabled:!0,children:x?"ÁÑ°ÂèØÁî®ÁöÑ WBS È†ÖÁõÆ":"ËºâÂÖ•‰∏≠..."})]}),d.length>0&&y.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:d.map(e=>{const t=x.find(t=>t.wbs_id===e);return y.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:[y.jsxs("span",{children:[e,t&&` - ${t.task_name}`]}),y.jsx("button",{type:"button",onClick:()=>(e=>{o(t=>t.filter(t=>t!==e))})(e),className:"text-blue-600 hover:text-blue-800 font-bold",title:"ÁßªÈô§",children:"√ó"})]},e)})})]}),y.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:y.jsxs("div",{children:[y.jsx("label",{htmlFor:"estimated_impact_days",className:"label",children:"È†ê‰º∞ÂΩ±ÈüøÂ§©Êï∏"}),y.jsx("input",{type:"number",id:"estimated_impact_days",name:"estimated_impact_days",value:r.estimated_impact_days,onChange:h,min:"0",className:"input-field"})]})}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"impact_description",className:"label",children:"ÂΩ±ÈüøË™™Êòé"}),y.jsx("textarea",{id:"impact_description",name:"impact_description",value:r.impact_description,onChange:h,rows:"2",className:"input-field"})]})]})]}),y.jsxs("div",{children:[y.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"ÁãÄÊÖãËàáÊôÇÁ®ã"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"status",className:"label",children:"ÁãÄÊÖã"}),y.jsxs("select",{id:"status",name:"status",value:r.status,onChange:h,className:"input-field",children:[y.jsx("option",{value:"Open",children:"Open"}),y.jsx("option",{value:"In Progress",children:"In Progress"}),y.jsx("option",{value:"Pending",children:"Pending"}),y.jsx("option",{value:"Resolved",children:"Resolved"}),y.jsx("option",{value:"Closed",children:"Closed"}),y.jsx("option",{value:"Cancelled",children:"Cancelled"})]})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"reported_date",className:"label",children:"ÂõûÂ†±Êó•Êúü"}),y.jsx("input",{type:"date",id:"reported_date",name:"reported_date",value:r.reported_date,onChange:h,disabled:!!t,className:"input-field"})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"target_resolution_date",className:"label",children:"ÁõÆÊ®ôËß£Ê±∫Êó•Êúü"}),y.jsx("input",{type:"date",id:"target_resolution_date",name:"target_resolution_date",value:r.target_resolution_date,onChange:h,className:"input-field"})]})]})]}),y.jsxs("div",{children:[y.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"Ëß£Ê±∫ÊñπÊ°à"}),y.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"resolution",className:"label",children:"Ëß£Ê±∫ÊñπÊ°à"}),y.jsx("textarea",{id:"resolution",name:"resolution",value:r.resolution,onChange:h,rows:"2",className:"input-field"})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"root_cause",className:"label",children:"Ê†πÊú¨ÂéüÂõ†ÂàÜÊûê"}),y.jsx("textarea",{id:"root_cause",name:"root_cause",value:r.root_cause,onChange:h,rows:"2",className:"input-field"})]})]})]}),y.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[y.jsx("button",{type:"button",onClick:a,className:"btn-secondary",children:"ÂèñÊ∂à"}),y.jsx("button",{type:"submit",className:"btn-primary",children:t?"Êõ¥Êñ∞":"Êñ∞Â¢û"})]})]})},ls=()=>{const[t,s]=a(),[n,r]=e.useState(!1),[l,i]=e.useState(null),[c,d]=e.useState(t.get("project")||"PRJ001"),[o,x]=e.useState({status:"",severity:"",priority:""}),[m,u]=e.useState({myResponsibility:!1,clientOwner:!1,internalOnly:!1,overdueOnly:!1,escalatedOnly:!1,reportedDateRange:"",targetDateRange:""}),[p,h]=e.useState(""),{issuesList:g,loading:j,error:f,total:b,fetchIssues:v,createIssue:_,updateIssue:N,deleteIssue:w,escalateIssue:k,resolveIssue:S,closeIssue:C}=Vt(),{projectsList:E,fetchProjects:O}=qt(),{loading:D,exportIssuesToExcel:R}=Yt();e.useEffect(()=>{O()},[O]),e.useEffect(()=>{v({project_id:c,...o})},[v,c,o]),e.useEffect(()=>{c&&s({project:c})},[c,s]);const F=async e=>{try{l?(await N(l.issue_id,e),alert("Êõ¥Êñ∞ÊàêÂäü")):(await _(e),alert("Êñ∞Â¢ûÊàêÂäü")),r(!1),i(null),v({project_id:c,...o})}catch(t){alert(`Êìç‰ΩúÂ§±Êïó: ${t.message}`)}},T=()=>{r(!1),i(null)},P=e=>{switch(e){case"Open":return"bg-blue-100 text-blue-800";case"In Progress":return"bg-yellow-100 text-yellow-800";case"Pending":return"bg-orange-100 text-orange-800";case"Resolved":return"bg-green-100 text-green-800";case"Closed":default:return"bg-gray-100 text-gray-800";case"Cancelled":return"bg-red-100 text-red-800"}},$=e=>{switch(e){case"Urgent":return"bg-red-600 text-white";case"High":return"bg-red-100 text-red-800";case"Medium":return"bg-orange-100 text-orange-800";case"Low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},L=(()=>{let e=[...g];if(m.myResponsibility&&p&&(e=e.filter(e=>e.assigned_to===p)),m.clientOwner&&(e=e.filter(e=>"ÂÆ¢Êà∂"===e.owner_type)),m.internalOnly&&(e=e.filter(e=>"ÂÖßÈÉ®"===e.owner_type)),m.overdueOnly&&(e=e.filter(e=>!0===e.is_overdue)),m.escalatedOnly&&(e=e.filter(e=>!0===e.is_escalated)),m.reportedDateRange){const t=new Date;t.setHours(0,0,0,0),e=e.filter(e=>{if(!e.reported_date)return!1;const s=new Date(e.reported_date);switch(s.setHours(0,0,0,0),m.reportedDateRange){case"today":return s.getTime()===t.getTime();case"yesterday":const e=new Date(t);return e.setDate(e.getDate()-1),s.getTime()===e.getTime();case"last7days":const a=new Date(t);return a.setDate(a.getDate()-7),s>=a&&s<=t;case"last30days":const n=new Date(t);return n.setDate(n.getDate()-30),s>=n&&s<=t;case"thisMonth":return s.getMonth()===t.getMonth()&&s.getFullYear()===t.getFullYear();case"lastMonth":const r=new Date(t.getFullYear(),t.getMonth()-1,1),l=new Date(t.getFullYear(),t.getMonth(),0);return s>=r&&s<=l;default:return!0}})}if(m.targetDateRange){const t=new Date;t.setHours(0,0,0,0),e=e.filter(e=>{if(!e.target_resolution_date)return!1;const s=new Date(e.target_resolution_date);switch(s.setHours(0,0,0,0),m.targetDateRange){case"today":return s.getTime()===t.getTime();case"yesterday":const e=new Date(t);return e.setDate(e.getDate()-1),s.getTime()===e.getTime();case"last7days":const a=new Date(t);return a.setDate(a.getDate()-7),s>=a&&s<=t;case"last30days":const n=new Date(t);return n.setDate(n.getDate()-30),s>=n&&s<=t;case"thisMonth":return s.getMonth()===t.getMonth()&&s.getFullYear()===t.getFullYear();case"lastMonth":const r=new Date(t.getFullYear(),t.getMonth()-1,1),l=new Date(t.getFullYear(),t.getMonth(),0);return s>=r&&s<=l;case"next7days":const i=new Date(t);return i.setDate(i.getDate()+7),s>=t&&s<=i;case"next30days":const c=new Date(t);return c.setDate(c.getDate()+30),s>=t&&s<=c;default:return!0}})}return e})();return n?y.jsx("div",{className:"container mx-auto px-4 py-8",children:y.jsx(rs,{initialData:l,onSubmit:F,onCancel:T,projectId:c})}):y.jsxs("div",{className:"container mx-auto px-4 py-8",children:[y.jsxs("div",{className:"mb-6",children:[y.jsxs("div",{className:"flex justify-between items-center mb-4",children:[y.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ÂïèÈ°åËøΩËπ§ÁÆ°ÁêÜ"}),y.jsxs("div",{className:"flex gap-2",children:[y.jsx("button",{onClick:async()=>{if(c)try{await R(c),alert("ÂåØÂá∫ÊàêÂäü")}catch(e){alert(`ÂåØÂá∫Â§±Êïó: ${e.message}`)}else alert("Ë´ãÂÖàÈÅ∏ÊìáÂ∞àÊ°à")},disabled:D,className:"btn-secondary",children:D?"ÂåØÂá∫‰∏≠...":"üì• ÂåØÂá∫ Excel"}),y.jsx("button",{onClick:()=>{i(null),r(!0)},className:"btn-primary",children:"+ Êñ∞Â¢ûÂïèÈ°å"})]})]}),y.jsxs("div",{className:"flex gap-4 items-center flex-wrap",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"project-select",className:"label",children:"Â∞àÊ°à"}),y.jsx("select",{id:"project-select",value:c,onChange:e=>d(e.target.value),className:"input-field",children:0===E.length?y.jsx("option",{value:"",children:"Ë´ãÂÖàÂª∫Á´ãÂ∞àÊ°à"}):y.jsxs(y.Fragment,{children:[y.jsx("option",{value:"",children:"Ë´ãÈÅ∏ÊìáÂ∞àÊ°à"}),E.map(e=>y.jsxs("option",{value:e.project_id,children:[e.project_id," - ",e.project_name]},e.project_id))]})})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"status-filter",className:"label",children:"ÁãÄÊÖã"}),y.jsxs("select",{id:"status-filter",value:o.status,onChange:e=>x({...o,status:e.target.value}),className:"input-field",children:[y.jsx("option",{value:"",children:"ÂÖ®ÈÉ®"}),y.jsx("option",{value:"Open",children:"Open"}),y.jsx("option",{value:"In Progress",children:"In Progress"}),y.jsx("option",{value:"Pending",children:"Pending"}),y.jsx("option",{value:"Resolved",children:"Resolved"}),y.jsx("option",{value:"Closed",children:"Closed"}),y.jsx("option",{value:"Cancelled",children:"Cancelled"})]})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"severity-filter",className:"label",children:"Âö¥ÈáçÊÄß"}),y.jsxs("select",{id:"severity-filter",value:o.severity,onChange:e=>x({...o,severity:e.target.value}),className:"input-field",children:[y.jsx("option",{value:"",children:"ÂÖ®ÈÉ®"}),y.jsx("option",{value:"Critical",children:"Critical"}),y.jsx("option",{value:"High",children:"High"}),y.jsx("option",{value:"Medium",children:"Medium"}),y.jsx("option",{value:"Low",children:"Low"})]})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"priority-filter",className:"label",children:"ÂÑ™ÂÖàÁ¥ö"}),y.jsxs("select",{id:"priority-filter",value:o.priority,onChange:e=>x({...o,priority:e.target.value}),className:"input-field",children:[y.jsx("option",{value:"",children:"ÂÖ®ÈÉ®"}),y.jsx("option",{value:"Urgent",children:"Urgent"}),y.jsx("option",{value:"High",children:"High"}),y.jsx("option",{value:"Medium",children:"Medium"}),y.jsx("option",{value:"Low",children:"Low"})]})]}),y.jsx("div",{className:"mt-6",children:y.jsx("button",{onClick:()=>v({project_id:c,...o}),className:"btn-secondary",children:"ÊêúÂ∞ã"})})]}),y.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[y.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Êô∫ÊÖßÁØ©ÈÅ∏"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[y.jsxs("div",{className:"flex flex-col gap-2",children:[y.jsxs("label",{className:"flex items-center text-sm",children:[y.jsx("input",{type:"checkbox",checked:m.myResponsibility,onChange:e=>u({...m,myResponsibility:e.target.checked}),className:"mr-2 rounded"}),y.jsx("span",{className:"text-gray-700",children:"Âè™ÁúãÊàëË≤†Ë≤¨ÁöÑ"})]}),m.myResponsibility&&y.jsx("input",{type:"text",value:p,onChange:e=>h(e.target.value),placeholder:"Ëº∏ÂÖ•ÊÇ®ÁöÑÂßìÂêç",className:"input-field text-sm ml-6"})]}),y.jsxs("label",{className:"flex items-center text-sm",children:[y.jsx("input",{type:"checkbox",checked:m.clientOwner,onChange:e=>u({...m,clientOwner:e.target.checked}),className:"mr-2 rounded"}),y.jsx("span",{className:"text-gray-700",children:"Âè™ÁúãÂÆ¢Êà∂Ë≤¨‰ªª"})]}),y.jsxs("label",{className:"flex items-center text-sm",children:[y.jsx("input",{type:"checkbox",checked:m.internalOnly,onChange:e=>u({...m,internalOnly:e.target.checked}),className:"mr-2 rounded"}),y.jsx("span",{className:"text-gray-700",children:"Âè™ÁúãÂÖßÈÉ®È†ÖÁõÆ"})]}),y.jsxs("label",{className:"flex items-center text-sm",children:[y.jsx("input",{type:"checkbox",checked:m.overdueOnly,onChange:e=>u({...m,overdueOnly:e.target.checked}),className:"mr-2 rounded"}),y.jsxs("span",{className:"text-gray-700 flex items-center",children:["Âè™ÁúãÈÄæÊúüÈ†ÖÁõÆ",y.jsx("span",{className:"ml-1 text-red-500",children:"‚ö†Ô∏è"})]})]}),y.jsxs("label",{className:"flex items-center text-sm",children:[y.jsx("input",{type:"checkbox",checked:m.escalatedOnly,onChange:e=>u({...m,escalatedOnly:e.target.checked}),className:"mr-2 rounded"}),y.jsxs("span",{className:"text-gray-700 flex items-center",children:["Âè™ÁúãÂ∑≤ÂçáÁ¥ö",y.jsx("span",{className:"ml-1 text-orange-500",children:"‚¨ÜÔ∏è"})]})]}),y.jsxs("div",{className:"md:col-span-2 lg:col-span-1",children:[y.jsx("label",{htmlFor:"reported-date-range-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"ÂõûÂ†±Êó•ÊúüÂçÄÈñì"}),y.jsxs("select",{id:"reported-date-range-filter",value:m.reportedDateRange,onChange:e=>u({...m,reportedDateRange:e.target.value}),className:"input-field text-sm w-full",children:[y.jsx("option",{value:"",children:"ÂÖ®ÈÉ®Êó•Êúü"}),y.jsx("option",{value:"today",children:"‰ªäÂ§©"}),y.jsx("option",{value:"yesterday",children:"Êò®Â§©"}),y.jsx("option",{value:"last7days",children:"ÊúÄËøë 7 Â§©"}),y.jsx("option",{value:"last30days",children:"ÊúÄËøë 30 Â§©"}),y.jsx("option",{value:"thisMonth",children:"Êú¨Êúà"}),y.jsx("option",{value:"lastMonth",children:"‰∏äÂÄãÊúà"})]})]}),y.jsxs("div",{className:"md:col-span-2 lg:col-span-1",children:[y.jsx("label",{htmlFor:"target-date-range-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"ÁõÆÊ®ôËß£Ê±∫Êó•ÊúüÂçÄÈñì"}),y.jsxs("select",{id:"target-date-range-filter",value:m.targetDateRange,onChange:e=>u({...m,targetDateRange:e.target.value}),className:"input-field text-sm w-full",children:[y.jsx("option",{value:"",children:"ÂÖ®ÈÉ®Êó•Êúü"}),y.jsx("option",{value:"today",children:"‰ªäÂ§©"}),y.jsx("option",{value:"yesterday",children:"Êò®Â§©"}),y.jsx("option",{value:"last7days",children:"ÈÅéÂéª 7 Â§©"}),y.jsx("option",{value:"last30days",children:"ÈÅéÂéª 30 Â§©"}),y.jsx("option",{value:"next7days",children:"Êú™‰æÜ 7 Â§©"}),y.jsx("option",{value:"next30days",children:"Êú™‰æÜ 30 Â§©"}),y.jsx("option",{value:"thisMonth",children:"Êú¨Êúà"}),y.jsx("option",{value:"lastMonth",children:"‰∏äÂÄãÊúà"})]})]}),Object.values(m).some(e=>e)&&y.jsx("button",{onClick:()=>u({myResponsibility:!1,clientOwner:!1,internalOnly:!1,overdueOnly:!1,escalatedOnly:!1,reportedDateRange:"",targetDateRange:""}),className:"text-sm text-primary-600 hover:text-primary-800 underline",children:"Ê∏ÖÈô§ÊâÄÊúâÁØ©ÈÅ∏"})]})]})]}),f&&y.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4",children:f}),j&&y.jsxs("div",{className:"text-center py-8",children:[y.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),y.jsx("p",{className:"mt-2 text-gray-600",children:"ËºâÂÖ•‰∏≠..."})]}),!j&&y.jsxs(y.Fragment,{children:[y.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-x-auto",children:y.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[y.jsx("thead",{className:"bg-gray-50",children:y.jsxs("tr",{children:[y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Á∑®Ëôü"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ÂïèÈ°åÊ®ôÈ°å"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"È°ûÂûã"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ÂÑ™ÂÖàÁ¥ö"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ÂõûÂ†±Êó•Êúü"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ÁõÆÊ®ôËß£Ê±∫Êó•Êúü"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ÊåáÊ¥æÁµ¶"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ÁãÄÊÖã"}),y.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Êìç‰Ωú"})]})}),y.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:0===L.length?y.jsx("tr",{children:y.jsx("td",{colSpan:"9",className:"px-6 py-4 text-center text-gray-500",children:0===g.length?"Êö´ÁÑ°Ë≥áÊñô":"ÁÑ°Á¨¶ÂêàÁØ©ÈÅ∏Ê¢ù‰ª∂ÁöÑË≥áÊñô"})}):L.map(e=>y.jsxs("tr",{className:e.is_overdue?"bg-red-50":"",children:[y.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[e.issue_number,e.is_escalated&&y.jsx("span",{className:"ml-2 text-orange-500",children:"‚¨ÜÔ∏è"})]}),y.jsxs("td",{className:"px-4 py-4 text-sm text-gray-900 max-w-xs",children:[y.jsxs("div",{className:"truncate",children:[e.issue_title,e.is_overdue&&y.jsx("span",{className:"ml-2 text-red-500",children:"‚ö†Ô∏è"})]}),e.affected_wbs&&y.jsxs("div",{className:"text-xs text-gray-500 mt-1 flex items-center gap-1",children:[y.jsx("span",{className:"font-semibold",children:"ÂΩ±Èüø:"}),y.jsx("span",{className:"truncate",children:e.affected_wbs})]})]}),y.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500",children:e.issue_type}),y.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:y.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${$(e.priority)}`,children:e.priority})}),y.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-600",children:e.reported_date||"-"}),y.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-600",children:e.target_resolution_date||"-"}),y.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-500",children:e.assigned_to||"-"}),y.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:y.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${P(e.status)}`,children:e.status})}),y.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium",children:y.jsxs("div",{className:"flex gap-2",children:[y.jsx("button",{onClick:()=>(e=>{i(e),r(!0)})(e),className:"text-primary-600 hover:text-primary-900",title:"Á∑®ËºØ",children:"Á∑®ËºØ"}),"Resolved"!==e.status&&"Closed"!==e.status&&y.jsxs(y.Fragment,{children:[y.jsx("button",{onClick:()=>(async e=>{const t=prompt("Ë´ãËº∏ÂÖ•ÂçáÁ¥öÂ±§Á¥ö (PM/Senior Manager/Executive):"),s=prompt("Ë´ãËº∏ÂÖ•ÂçáÁ¥öÂéüÂõ†:"),a=prompt("Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑÂßìÂêç:");if(t&&s&&a)try{await k(e,{escalation_level:t,escalation_reason:s,changed_by:a}),alert("ÂçáÁ¥öÊàêÂäü"),v({project_id:c,...o})}catch(n){alert(`ÂçáÁ¥öÂ§±Êïó: ${n.message}`)}})(e.issue_id),className:"text-orange-600 hover:text-orange-900",title:"ÂçáÁ¥ö",children:"ÂçáÁ¥ö"}),y.jsx("button",{onClick:()=>(async e=>{const t=prompt("Ë´ãËº∏ÂÖ•Ëß£Ê±∫ÊñπÊ°à:"),s=prompt("Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑÂßìÂêç:");if(t&&s)try{await S(e,{resolution:t,resolved_by:s}),alert("Â∑≤Ê®ôË®òÁÇ∫Â∑≤Ëß£Ê±∫"),v({project_id:c,...o})}catch(a){alert(`Ê®ôË®òÂ§±Êïó: ${a.message}`)}})(e.issue_id),className:"text-green-600 hover:text-green-900",title:"Ëß£Ê±∫",children:"Ëß£Ê±∫"})]}),"Resolved"===e.status&&"Closed"!==e.status&&y.jsx("button",{onClick:()=>(async e=>{const t=prompt("Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑÂßìÂêç:");if(t)try{await C(e,{closed_by:t}),alert("Â∑≤ÈóúÈñâÂïèÈ°å"),v({project_id:c,...o})}catch(s){alert(`ÈóúÈñâÂ§±Êïó: ${s.message}`)}})(e.issue_id),className:"text-gray-600 hover:text-gray-900",title:"ÈóúÈñâ",children:"ÈóúÈñâ"}),y.jsx("button",{onClick:()=>(async e=>{if(window.confirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§ÂïèÈ°å„Äå${e.issue_title}„ÄçÂóéÔºü`))try{await w(e.issue_id),alert("Âà™Èô§ÊàêÂäü"),v({project_id:c,...o})}catch(t){alert(`Âà™Èô§Â§±Êïó: ${t.message}`)}})(e),className:"text-red-600 hover:text-red-900",title:"Âà™Èô§",children:"Âà™Èô§"})]})})]},e.issue_id))})]})}),y.jsx("div",{className:"mt-4 text-sm text-gray-600",children:L.length!==g.length?y.jsxs(y.Fragment,{children:["È°ØÁ§∫ ",L.length," Á≠ÜÔºàÂÖ± ",b," Á≠ÜË≥áÊñôÔºâ"]}):y.jsxs(y.Fragment,{children:["ÂÖ± ",b," Á≠ÜË≥áÊñô"]})})]})]})},is=({tasks:t,viewMode:s="Day",onTaskClick:a,onDateChange:n})=>{const r=e.useRef(null),l=e.useRef(null);e.useEffect(()=>{if(console.log("GanttChart effect triggered:",{hasRef:!!r.current,tasksCount:(null==t?void 0:t.length)||0,tasks:t}),!r.current||!t||0===t.length)return void console.log("Skipping Gantt render - missing requirements");const e=t.map(e=>{const t=e.revised_planned_start||e.original_planned_start||e.actual_start_date,s=e.revised_planned_end||e.original_planned_end||e.actual_end_date,a=new Date,n=new Date(a);n.setDate(n.getDate()+1);const r=t||a.toISOString().split("T")[0],l=s||n.toISOString().split("T")[0],c=new Date(r).getTime(),d=new Date(l).getTime()>c?l:new Date(c+864e5).toISOString().split("T")[0],o={id:e.wbs_id,name:e.task_name||e.wbs_id,start:r,end:d,progress:e.actual_progress||0,dependencies:e.dependencies||"",custom_class:i(e)};return console.log("Converted task:",e.wbs_id,o),o});console.log("Gantt tasks prepared:",e),l.current&&(l.current=null,r.current.innerHTML="");try{console.log("Creating Gantt instance with",e.length,"tasks"),l.current=new c(r.current,e,{view_mode:s,bar_height:30,bar_corner_radius:3,arrow_curve:5,padding:18,date_format:"YYYY-MM-DD",custom_popup_html:e=>{const s=t.find(t=>t.wbs_id===e.id),a=e._start?new Date(e._start).toLocaleDateString("zh-TW"):"N/A",n=e._end?new Date(e._end).toLocaleDateString("zh-TW"):"N/A";return`\n            <div class="gantt-popup">\n              <h3 style="margin: 0 0 10px 0; font-size: 14px;">${e.name}</h3>\n              <p style="margin: 5px 0; font-size: 12px;"><strong>WBS ID:</strong> ${e.id}</p>\n              <p style="margin: 5px 0; font-size: 12px;"><strong>ÈñãÂßã:</strong> ${a}</p>\n              <p style="margin: 5px 0; font-size: 12px;"><strong>ÁµêÊùü:</strong> ${n}</p>\n              <p style="margin: 5px 0; font-size: 12px;"><strong>ÈÄ≤Â∫¶:</strong> ${e.progress}%</p>\n              ${(null==s?void 0:s.primary_owner)?`<p style="margin: 5px 0; font-size: 12px;"><strong>Ë≤†Ë≤¨‰∫∫:</strong> ${s.primary_owner}</p>`:""}\n              ${(null==s?void 0:s.status)?`<p style="margin: 5px 0; font-size: 12px;"><strong>ÁãÄÊÖã:</strong> ${s.status}</p>`:""}\n            </div>\n          `},on_click:e=>{if(a){const s=t.find(t=>t.wbs_id===e.id);a(s)}},on_date_change:(e,t,s)=>{n&&n(e.id,t,s)}}),console.log("Gantt chart created successfully")}catch(d){console.error("Error creating Gantt chart:",d),console.error("Error stack:",d.stack),console.error("Tasks that caused error:",e)}return()=>{l.current&&(l.current=null)}},[t,s,a,n]);const i=e=>"Â∑≤ÂÆåÊàê"===e.status?"gantt-bar-complete":"ÈÄ≤Ë°å‰∏≠"===e.status?"gantt-bar-in-progress":"Âª∂ÈÅ≤"===e.status?"gantt-bar-delayed":e.progress_variance&&e.progress_variance<-10?"gantt-bar-behind":"";return y.jsx("div",{className:"gantt-container",children:y.jsx("svg",{ref:r})})},cs=()=>{const[t,s]=a(),[n,r]=e.useState(t.get("project")||"PRJ001"),[l,i]=e.useState("Day"),[c,d]=e.useState(null),[o,x]=e.useState(!1),[m,u]=e.useState({startDate:"",endDate:""}),{wbsList:p,loading:h,error:g,fetchWBS:j}=Kt(),{projectsList:f,fetchProjects:b}=qt(),{systemSettings:v,fetchSystemSettings:_,getSystemSetting:N}=Gt();e.useEffect(()=>{b(),_()},[b,_]),e.useEffect(()=>{if(v.length>0){const e=N("default_view_mode","Day");i(e)}},[v,N]),e.useEffect(()=>{if(n){console.log("Fetching WBS for project:",n);const e=N("items_per_page",1e3);j({project_id:n,limit:e})}},[n,j,v,N]),e.useEffect(()=>{n&&s({project:n})},[n,s]),e.useEffect(()=>{console.log("WBS List updated:",p.length,"items",p)},[p]);const w=p.filter(e=>{if(!m.startDate&&!m.endDate)return!0;const t=e.revised_planned_start||e.original_planned_start,s=e.revised_planned_end||e.original_planned_end;return!(m.startDate&&s&&s<m.startDate)&&!(m.endDate&&t&&t>m.endDate)}),k=e=>{const{name:t,value:s}=e.target;u(e=>({...e,[t]:s}))};return y.jsxs("div",{className:"container mx-auto px-4 py-8",children:[y.jsxs("div",{className:"mb-6",children:[y.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"ÁîòÁâπÂúñË¶ñÂúñ"}),y.jsxs("div",{className:"flex flex-wrap gap-4 items-center bg-white p-4 rounded-lg shadow",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"project-select",className:"label",children:"Â∞àÊ°à"}),y.jsx("select",{id:"project-select",value:n,onChange:e=>r(e.target.value),className:"input-field",children:0===f.length?y.jsx("option",{value:"",children:"Ë´ãÂÖàÂª∫Á´ãÂ∞àÊ°à"}):y.jsxs(y.Fragment,{children:[y.jsx("option",{value:"",children:"Ë´ãÈÅ∏ÊìáÂ∞àÊ°à"}),f.map(e=>y.jsxs("option",{value:e.project_id,children:[e.project_id," - ",e.project_name]},e.project_id))]})})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"view-mode",className:"label",children:"Ê™¢Ë¶ñÊ®°Âºè"}),y.jsx("select",{id:"view-mode",value:l,onChange:e=>i(e.target.value),className:"input-field",children:[{value:"Quarter Day",label:"Â≠£Êó•"},{value:"Half Day",label:"ÂçäÊó•"},{value:"Day",label:"Êó•"},{value:"Week",label:"ÈÄ±"},{value:"Month",label:"Êúà"}].map(e=>y.jsx("option",{value:e.value,children:e.label},e.value))})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"start-date",className:"label",children:"ÈñãÂßãÊó•Êúü"}),y.jsx("input",{type:"date",id:"start-date",name:"startDate",value:m.startDate,onChange:k,className:"input-field"})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"end-date",className:"label",children:"ÁµêÊùüÊó•Êúü"}),y.jsx("input",{type:"date",id:"end-date",name:"endDate",value:m.endDate,onChange:k,className:"input-field"})]}),(m.startDate||m.endDate)&&y.jsx("div",{className:"mt-6",children:y.jsx("button",{onClick:()=>{u({startDate:"",endDate:""})},className:"btn-secondary",children:"Ê∏ÖÈô§ÁØ©ÈÅ∏"})}),y.jsx("div",{className:"mt-6",children:y.jsx("button",{onClick:()=>{const e=N("items_per_page",1e3);j({project_id:n,limit:e})},className:"btn-secondary",disabled:h,children:h?"ËºâÂÖ•‰∏≠...":"ÈáçÊñ∞ËºâÂÖ•"})}),y.jsx("div",{className:"ml-auto text-sm text-gray-600",children:m.startDate||m.endDate?y.jsxs(y.Fragment,{children:["È°ØÁ§∫ ",w.length," / ",p.length," ÂÄã‰ªªÂãô"]}):y.jsxs(y.Fragment,{children:["ÂÖ± ",p.length," ÂÄã‰ªªÂãô"]})})]})]}),g&&y.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4",children:g}),h&&y.jsxs("div",{className:"text-center py-8",children:[y.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),y.jsx("p",{className:"mt-2 text-gray-600",children:"ËºâÂÖ•‰∏≠..."})]}),!h&&w.length>0&&y.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:y.jsx(is,{tasks:w,viewMode:l,onTaskClick:e=>{d(e),x(!0)},onDateChange:async(e,t,s)=>{console.log("Date changed:",e,t,s),alert(`‰ªªÂãô ${e} Êó•ÊúüÂ∑≤Êõ¥Êîπ:\nÈñãÂßã: ${t.toLocaleDateString("zh-TW")}\nÁµêÊùü: ${s.toLocaleDateString("zh-TW")}`)}})}),!h&&0===p.length&&y.jsxs("div",{className:"bg-white p-8 rounded-lg shadow text-center text-gray-500",children:[y.jsx("p",{className:"text-lg",children:"Êö´ÁÑ° WBS Ë≥áÊñô"}),y.jsx("p",{className:"mt-2 text-sm",children:"Ë´ãÂÖàÂª∫Á´ã WBS È†ÖÁõÆÊàñÈÅ∏ÊìáÂÖ∂‰ªñÂ∞àÊ°à"})]}),!h&&p.length>0&&0===w.length&&y.jsxs("div",{className:"bg-white p-8 rounded-lg shadow text-center text-gray-500",children:[y.jsx("p",{className:"text-lg",children:"ÁÑ°Á¨¶ÂêàÊ¢ù‰ª∂ÁöÑ WBS Ë≥áÊñô"}),y.jsx("p",{className:"mt-2 text-sm",children:"Ë´ãË™øÊï¥Êó•ÊúüÁØ©ÈÅ∏Ê¢ù‰ª∂"})]}),o&&c&&y.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:y.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:y.jsxs("div",{className:"p-6",children:[y.jsxs("div",{className:"flex justify-between items-center mb-4",children:[y.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"‰ªªÂãôË©≥ÊÉÖ"}),y.jsx("button",{onClick:()=>x(!1),className:"text-gray-400 hover:text-gray-600",children:"‚úï"})]}),y.jsx("div",{className:"space-y-3",children:y.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{className:"text-sm font-medium text-gray-500",children:"WBS ID"}),y.jsx("p",{className:"text-gray-900",children:c.wbs_id})]}),y.jsxs("div",{children:[y.jsx("label",{className:"text-sm font-medium text-gray-500",children:"‰ªªÂãôÂêçÁ®±"}),y.jsx("p",{className:"text-gray-900",children:c.task_name})]}),y.jsxs("div",{children:[y.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Ë≤†Ë≤¨‰∫∫"}),y.jsx("p",{className:"text-gray-900",children:c.primary_owner||"-"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"text-sm font-medium text-gray-500",children:"ÁãÄÊÖã"}),y.jsxs("p",{className:"text-gray-900",children:[c.status||"-",c.is_overdue&&y.jsx("span",{className:"ml-2 text-red-600 font-semibold",children:"ÈÄæÊúü"})]})]}),y.jsxs("div",{children:[y.jsx("label",{className:"text-sm font-medium text-gray-500",children:"È†êË®àÈñãÂßã"}),y.jsx("p",{className:"text-gray-900",children:c.original_planned_start||"-"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"text-sm font-medium text-gray-500",children:"È†êË®àÁµêÊùü"}),y.jsx("p",{className:"text-gray-900",children:c.original_planned_end||"-"})]}),c.revised_planned_start&&y.jsxs("div",{children:[y.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Ë™øÊï¥ÂæåÈñãÂßã"}),y.jsx("p",{className:"text-blue-600",children:c.revised_planned_start})]}),c.revised_planned_end&&y.jsxs("div",{children:[y.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Ë™øÊï¥ÂæåÁµêÊùü"}),y.jsx("p",{className:"text-blue-600",children:c.revised_planned_end})]}),y.jsxs("div",{children:[y.jsx("label",{className:"text-sm font-medium text-gray-500",children:"ÂØ¶ÈöõÈÄ≤Â∫¶"}),y.jsxs("p",{className:"text-gray-900",children:[c.actual_progress||0,"%"]})]}),y.jsxs("div",{children:[y.jsx("label",{className:"text-sm font-medium text-gray-500",children:"È†ê‰º∞ÈÄ≤Â∫¶"}),y.jsxs("p",{className:"text-gray-900",children:[c.estimated_progress||0,"%"]})]}),null!==c.progress_variance&&void 0!==c.progress_variance&&y.jsxs("div",{children:[y.jsx("label",{className:"text-sm font-medium text-gray-500",children:"ÈÄ≤Â∫¶Â∑ÆÁï∞"}),y.jsxs("p",{className:c.progress_variance<0?"text-red-600":"text-green-600",children:[c.progress_variance>0?"+":"",c.progress_variance,"%"]})]})]})}),y.jsx("div",{className:"mt-6 flex justify-end",children:y.jsx("button",{onClick:()=>x(!1),className:"btn-secondary",children:"ÈóúÈñâ"})})]})})})]})},ds=()=>{const[t,s]=e.useState([]),[a,n]=e.useState(null),[r,l]=e.useState(!1),[i,c]=e.useState(null),[d,o]=e.useState("");e.useEffect(()=>{x(),m()},[]);const x=async()=>{try{l(!0),c(null);const e=await Wt.get("/backup/list");s(e.backups||[])}catch(e){c(e.message||"ËºâÂÖ•ÂÇô‰ªΩÂàóË°®Â§±Êïó")}finally{l(!1)}},m=async()=>{try{const e=await Wt.get("/backup/stats");n(e.stats)}catch(e){console.error("Failed to fetch stats:",e)}},u=e=>e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(2)} KB`:`${(e/1048576).toFixed(2)} MB`;return y.jsxs("div",{className:"container mx-auto px-4 py-6",children:[y.jsxs("div",{className:"mb-6",children:[y.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Ë≥áÊñôÂ∫´ÂÇô‰ªΩÁÆ°ÁêÜ"}),y.jsx("p",{className:"text-gray-600",children:"Âª∫Á´ã„ÄÅ‰∏ãËºâ„ÄÅÈÇÑÂéüÂíåÁÆ°ÁêÜË≥áÊñôÂ∫´ÂÇô‰ªΩ"})]}),a&&y.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded",children:[y.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ÁõÆÂâçË≥áÊñôÂ∫´Ë≥áË®ä"}),y.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-blue-800",children:[y.jsxs("div",{children:[y.jsx("span",{className:"font-semibold",children:"Ë≥áÊñôÂ∫´Â§ßÂ∞èÔºö"}),u(a.size)]}),y.jsxs("div",{children:[y.jsx("span",{className:"font-semibold",children:"Â∞àÊ°àÊï∏Ôºö"}),a.tables.projects||0]}),y.jsxs("div",{children:[y.jsx("span",{className:"font-semibold",children:"WBS È†ÖÁõÆÔºö"}),a.tables.tracking_items||0]}),y.jsxs("div",{children:[y.jsx("span",{className:"font-semibold",children:"ÂæÖËæ¶‰∫ãÈ†ÖÔºö"}),a.tables.pending_items||0]})]})]}),y.jsxs("div",{className:"bg-white rounded-lg shadow mb-6 p-6",children:[y.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Âª∫Á´ãÊñ∞ÂÇô‰ªΩ"}),y.jsxs("div",{className:"flex gap-4",children:[y.jsx("input",{type:"text",value:d,onChange:e=>o(e.target.value),placeholder:"ÂÇô‰ªΩË™™ÊòéÔºàÈÅ∏Â°´Ôºâ",className:"input-field flex-1"}),y.jsx("button",{onClick:async()=>{if(window.confirm("Á¢∫ÂÆöË¶ÅÂª∫Á´ãÊñ∞ÁöÑË≥áÊñôÂ∫´ÂÇô‰ªΩÂóéÔºü"))try{l(!0),await Wt.post("/backup/create",{description:d}),alert("ÂÇô‰ªΩÂª∫Á´ãÊàêÂäüÔºÅ"),o(""),x(),m()}catch(e){alert(`Âª∫Á´ãÂÇô‰ªΩÂ§±Êïó: ${e.message}`)}finally{l(!1)}},disabled:r,className:"btn-primary whitespace-nowrap",children:"üíæ Âª∫Á´ãÂÇô‰ªΩ"}),y.jsx("button",{onClick:async()=>{const e=prompt("Ë´ãËº∏ÂÖ•Ë¶Å‰øùÁïôÁöÑÂÇô‰ªΩÊï∏ÈáèÔºàÂÖ∂È§òÂ∞áË¢´Âà™Èô§ÔºâÔºö","10");if(!(!e||isNaN(e)||parseInt(e)<1)&&window.confirm(`Á¢∫ÂÆöË¶ÅÊ∏ÖÁêÜËàäÂÇô‰ªΩÔºåÂè™‰øùÁïôÊúÄËøëÁöÑ ${e} ÂÄãÂÇô‰ªΩÂóéÔºü`))try{l(!0);const t=await Wt.post(`/backup/cleanup?keep_count=${e}`);alert(t.message),x()}catch(t){alert(`Ê∏ÖÁêÜÂÇô‰ªΩÂ§±Êïó: ${t.message}`)}finally{l(!1)}},disabled:r,className:"btn-secondary whitespace-nowrap",children:"üßπ Ê∏ÖÁêÜËàäÂÇô‰ªΩ"})]})]}),y.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[y.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:y.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["ÂÇô‰ªΩÂàóË°® (",t.length,")"]})}),r&&0===t.length?y.jsxs("div",{className:"p-8 text-center",children:[y.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),y.jsx("p",{className:"mt-2 text-gray-600",children:"ËºâÂÖ•‰∏≠..."})]}):i?y.jsx("div",{className:"p-8 text-center text-red-600",children:i}):0===t.length?y.jsx("div",{className:"p-8 text-center text-gray-500",children:"ÁõÆÂâçÊ≤íÊúâÂÇô‰ªΩ"}):y.jsx("div",{className:"overflow-x-auto",children:y.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[y.jsx("thead",{className:"bg-gray-50",children:y.jsxs("tr",{children:[y.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Ê™îÊ°àÂêçÁ®±"}),y.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Ë™™Êòé"}),y.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Â§ßÂ∞è"}),y.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Âª∫Á´ãÊôÇÈñì"}),y.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Êìç‰Ωú"})]})}),y.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>{return y.jsxs("tr",{className:"hover:bg-gray-50",children:[y.jsx("td",{className:"px-6 py-4 text-sm font-mono text-gray-900",children:e.filename}),y.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:e.description}),y.jsx("td",{className:"px-6 py-4 text-sm text-center text-gray-600",children:u(e.size)}),y.jsx("td",{className:"px-6 py-4 text-sm text-center text-gray-600",children:(t=e.created_at,new Date(t).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}))}),y.jsx("td",{className:"px-6 py-4 text-sm text-center",children:y.jsxs("div",{className:"flex gap-2 justify-center",children:[y.jsx("button",{onClick:()=>(async e=>{try{const t=`${Wt.defaults.baseURL}/backup/download/${e}`,s=document.createElement("a");s.href=t,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s)}catch(t){alert(`‰∏ãËºâÂÇô‰ªΩÂ§±Êïó: ${t.message}`)}})(e.filename),className:"text-blue-600 hover:text-blue-900",title:"‰∏ãËºâÂÇô‰ªΩ",children:"üì• ‰∏ãËºâ"}),y.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Ë≠¶ÂëäÔºöÈÇÑÂéüÂÇô‰ªΩÂ∞áÊúÉË¶ÜËìãÁõÆÂâçÁöÑË≥áÊñôÂ∫´ÔºÅ\n\nÁ≥ªÁµ±ÊúÉÂú®ÈÇÑÂéüÂâçËá™ÂãïÂª∫Á´ãÁõÆÂâçË≥áÊñôÂ∫´ÁöÑÂÇô‰ªΩ„ÄÇ\n\nÁ¢∫ÂÆöË¶ÅÁπºÁ∫åÂóéÔºü"))try{l(!0),await Wt.post("/backup/restore",{filename:e}),alert("Ë≥áÊñôÂ∫´Â∑≤ÊàêÂäüÈÇÑÂéüÔºÅ\n\nÈ†ÅÈù¢Â∞áÈáçÊñ∞ËºâÂÖ•‰ª•ÂèçÊò†ËÆäÊõ¥„ÄÇ"),window.location.reload()}catch(t){alert(`ÈÇÑÂéüÂÇô‰ªΩÂ§±Êïó: ${t.message}`),l(!1)}})(e.filename),className:"text-green-600 hover:text-green-900",title:"ÈÇÑÂéüÂÇô‰ªΩ",disabled:r,children:"‚Ü©Ô∏è ÈÇÑÂéü"}),y.jsx("button",{onClick:()=>(async e=>{if(window.confirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§ÂÇô‰ªΩ "${e}" ÂóéÔºü\n\nÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©ÂéüÔºÅ`))try{l(!0),await Wt.delete(`/backup/delete/${e}`),alert("ÂÇô‰ªΩÂ∑≤Âà™Èô§"),x()}catch(t){alert(`Âà™Èô§ÂÇô‰ªΩÂ§±Êïó: ${t.message}`)}finally{l(!1)}})(e.filename),className:"text-red-600 hover:text-red-900",title:"Âà™Èô§ÂÇô‰ªΩ",disabled:r,children:"üóëÔ∏è Âà™Èô§"})]})})]},e.filename);var t})})]})})]}),y.jsx("div",{className:"mt-6 bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded",children:y.jsxs("div",{className:"flex",children:[y.jsx("div",{className:"flex-shrink-0",children:y.jsx("span",{className:"text-2xl",children:"‚ö†Ô∏è"})}),y.jsxs("div",{className:"ml-3",children:[y.jsx("h3",{className:"text-sm font-semibold text-yellow-800",children:"ÈáçË¶ÅÊèêÈÜí"}),y.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:y.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[y.jsx("li",{children:"ÂÇô‰ªΩÊ™îÊ°àÂÑ≤Â≠òÂú®‰º∫ÊúçÂô®ÁöÑ data/backups ÁõÆÈåÑ‰∏≠"}),y.jsx("li",{children:"Âª∫Ë≠∞ÂÆöÊúüÂª∫Á´ãÂÇô‰ªΩÔºå‰∏¶‰∏ãËºâÂà∞Êú¨Ê©ü‰øùÂ≠ò"}),y.jsx("li",{children:"ÈÇÑÂéüÂÇô‰ªΩÂâçÔºåÁ≥ªÁµ±ÊúÉËá™ÂãïÂª∫Á´ãÁõÆÂâçË≥áÊñôÂ∫´ÁöÑÂÇô‰ªΩ"}),y.jsx("li",{children:"Âà™Èô§ÂÇô‰ªΩÂæåÁÑ°Ê≥ïÂæ©ÂéüÔºåË´ãË¨πÊÖéÊìç‰Ωú"}),y.jsx("li",{children:"Âª∫Ë≠∞‰øùÁïôÊúÄËøë 10-20 ÂÄãÂÇô‰ªΩÔºåÂÆöÊúüÊ∏ÖÁêÜËàäÂÇô‰ªΩÁØÄÁúÅÁ©∫Èñì"})]})})]})]})})]})},os=()=>{const{systemSettings:t,loading:s,error:a,fetchSystemSettings:n,updateSystemSetting:r}=Gt(),[l,i]=e.useState(""),[c,d]=e.useState({});e.useEffect(()=>{n()},[]),e.useEffect(()=>{const e={};t.forEach(t=>{e[t.setting_key]=t.setting_value}),d(e)},[t]);const o=e=>{const{name:t,value:s,type:a,checked:n}=e.target;d(e=>({...e,[t]:"checkbox"===a?n?"true":"false":s}))};return s&&0===t.length?y.jsx("div",{className:"container mx-auto px-4 py-8",children:y.jsxs("div",{className:"text-center",children:[y.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),y.jsx("p",{className:"mt-2 text-gray-600",children:"ËºâÂÖ•Ë®≠ÂÆö‰∏≠..."})]})}):y.jsxs("div",{className:"container mx-auto px-4 py-8",children:[y.jsxs("div",{className:"mb-6",children:[y.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Á≥ªÁµ±Ë®≠ÂÆö"}),y.jsx("p",{className:"mt-2 text-gray-600",children:"ÁÆ°ÁêÜÁ≥ªÁµ±ÁöÑÂÖ®ÂüüË®≠ÂÆöÂèÉÊï∏"})]}),l&&y.jsx("div",{className:"mb-4 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded",children:l}),a&&y.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:a}),y.jsxs("form",{onSubmit:async e=>{e.preventDefault(),i("");try{const e=Object.keys(c).map(e=>{const s=t.find(t=>t.setting_key===e);return s&&s.setting_value!==c[e]?r(e,c[e]):null});await Promise.all(e.filter(e=>null!==e)),i("Ë®≠ÂÆöÂ∑≤ÊàêÂäüÂÑ≤Â≠òÔºÅ"),setTimeout(()=>i(""),3e3)}catch(s){alert("ÂÑ≤Â≠òË®≠ÂÆöÊôÇÁôºÁîüÈåØË™§Ôºö"+s.message)}},className:"space-y-6",children:[y.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[y.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"È°ØÁ§∫Ë®≠ÂÆö"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"date_format",className:"label",children:"Êó•ÊúüÊ†ºÂºè"}),y.jsxs("select",{id:"date_format",name:"date_format",value:c.date_format||"yyyy/MM/dd",onChange:o,className:"input-field",children:[y.jsx("option",{value:"yyyy/MM/dd",children:"yyyy/MM/dd (2024/01/15)"}),y.jsx("option",{value:"yyyy-MM-dd",children:"yyyy-MM-dd (2024-01-15)"}),y.jsx("option",{value:"MM/dd/yyyy",children:"MM/dd/yyyy (01/15/2024)"}),y.jsx("option",{value:"dd/MM/yyyy",children:"dd/MM/yyyy (15/01/2024)"})]})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"default_view_mode",className:"label",children:"È†êË®≠Ë¶ñÂúñÊ®°ÂºèÔºàÁîòÁâπÂúñÔºâ"}),y.jsxs("select",{id:"default_view_mode",name:"default_view_mode",value:c.default_view_mode||"Day",onChange:o,className:"input-field",children:[y.jsx("option",{value:"Quarter Day",children:"Â≠£Êó•"}),y.jsx("option",{value:"Half Day",children:"ÂçäÊó•"}),y.jsx("option",{value:"Day",children:"Êó•"}),y.jsx("option",{value:"Week",children:"ÈÄ±"}),y.jsx("option",{value:"Month",children:"Êúà"})]})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"items_per_page",className:"label",children:"ÊØèÈ†ÅÈ°ØÁ§∫Á≠ÜÊï∏"}),y.jsxs("select",{id:"items_per_page",name:"items_per_page",value:c.items_per_page||"50",onChange:o,className:"input-field",children:[y.jsx("option",{value:"20",children:"20"}),y.jsx("option",{value:"50",children:"50"}),y.jsx("option",{value:"100",children:"100"}),y.jsx("option",{value:"200",children:"200"})]})]})]})]}),y.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[y.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Ë®àÁÆóË¶èÂâá"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{htmlFor:"progress_calculation",className:"label",children:"ÈÄ≤Â∫¶Ë®àÁÆóÊñπÂºè"}),y.jsxs("select",{id:"progress_calculation",name:"progress_calculation",value:c.progress_calculation||"date_based",onChange:o,className:"input-field",children:[y.jsx("option",{value:"date_based",children:"Âü∫ÊñºÊó•ÊúüËá™ÂãïË®àÁÆó"}),y.jsx("option",{value:"manual",children:"ÊâãÂãïËº∏ÂÖ•"})]}),y.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Âü∫ÊñºÊó•ÊúüÔºöÊ†πÊìöÈñãÂßã/ÁµêÊùüÊó•ÊúüËá™ÂãïË®àÁÆóÈ†ê‰º∞ÈÄ≤Â∫¶"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"label",children:"Â∑•‰ΩúÂ§©Êï∏Ë®àÁÆó"}),y.jsxs("div",{className:"flex items-center mt-2",children:[y.jsx("input",{type:"checkbox",id:"include_weekends",name:"include_weekends",checked:"true"===c.include_weekends,onChange:o,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),y.jsx("label",{htmlFor:"include_weekends",className:"ml-2 block text-sm text-gray-700",children:"ÂåÖÂê´ÈÄ±Êú´ÔºàÈÄ±ÂÖ≠„ÄÅÈÄ±Êó•Ôºâ"})]}),y.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"ÂèñÊ∂àÂãæÈÅ∏ÂâáÂ∑•‰ΩúÂ§©Êï∏Âè™Ë®àÁÆóÈÄ±‰∏ÄËá≥ÈÄ±‰∫î"})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"overdue_warning_days",className:"label",children:"ÈÄæÊúüË≠¶Á§∫Â§©Êï∏"}),y.jsx("input",{type:"number",id:"overdue_warning_days",name:"overdue_warning_days",value:c.overdue_warning_days||"3",onChange:o,min:"0",max:"30",className:"input-field"}),y.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"ÊèêÂâçÂπæÂ§©ÈñãÂßãÈ°ØÁ§∫ÈÄæÊúüË≠¶Á§∫"})]})]})]}),y.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[y.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"ÈÄöÁü•Ë®≠ÂÆö"}),y.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.jsxs("div",{children:[y.jsx("label",{className:"label",children:"ÈÄæÊúüÊèêÈÜí"}),y.jsxs("div",{className:"flex items-center mt-2",children:[y.jsx("input",{type:"checkbox",id:"enable_overdue_alert",name:"enable_overdue_alert",checked:"true"===c.enable_overdue_alert,onChange:o,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),y.jsx("label",{htmlFor:"enable_overdue_alert",className:"ml-2 block text-sm text-gray-700",children:"ÂïüÁî®ÈÄæÊúüÊèêÈÜí"})]})]}),y.jsxs("div",{children:[y.jsx("label",{htmlFor:"progress_lag_threshold",className:"label",children:"ÈÄ≤Â∫¶ËêΩÂæåË≠¶Á§∫ÈñæÂÄºÔºà%Ôºâ"}),y.jsx("input",{type:"number",id:"progress_lag_threshold",name:"progress_lag_threshold",value:c.progress_lag_threshold||"10",onChange:o,min:"0",max:"100",className:"input-field"}),y.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"ÂØ¶ÈöõÈÄ≤Â∫¶ËêΩÂæåÈ†ê‰º∞ÈÄ≤Â∫¶ÈÅîÊ≠§ÁôæÂàÜÊØîÊôÇÈ°ØÁ§∫Ë≠¶Á§∫"})]})]})]}),y.jsxs("div",{className:"flex justify-end space-x-3",children:[y.jsx("button",{type:"button",onClick:()=>n(),className:"btn-secondary",children:"ÈáçÊñ∞ËºâÂÖ•"}),y.jsx("button",{type:"submit",className:"btn-primary",disabled:s,children:s?"ÂÑ≤Â≠ò‰∏≠...":"ÂÑ≤Â≠òË®≠ÂÆö"})]})]})]})};function xs(){return y.jsx(n,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:y.jsxs("div",{className:"min-h-screen bg-gray-50",children:[y.jsx("header",{className:"bg-white shadow",children:y.jsx("div",{className:"max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8",children:y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Project Tracker"}),y.jsxs("nav",{className:"flex space-x-4",children:[y.jsx(s,{to:"/",className:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"È¶ñÈ†Å"}),y.jsx(s,{to:"/projects",className:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"Â∞àÊ°àÁÆ°ÁêÜ"}),y.jsx(s,{to:"/wbs",className:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"WBS ÁÆ°ÁêÜ"}),y.jsx(s,{to:"/wbs/tree",className:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"WBS Ê®πÁãÄÂúñ"}),y.jsx(s,{to:"/dependencies",className:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"‰æùË≥¥Èóú‰øÇ"}),y.jsx(s,{to:"/pending",className:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"ÂæÖËæ¶Ê∏ÖÂñÆ"}),y.jsx(s,{to:"/issues",className:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"ÂïèÈ°åËøΩËπ§"}),y.jsx(s,{to:"/gantt",className:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"ÁîòÁâπÂúñ"}),y.jsx(s,{to:"/backup",className:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"ÂÇô‰ªΩÁÆ°ÁêÜ"}),y.jsx(s,{to:"/settings",className:"text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium",children:"Á≥ªÁµ±Ë®≠ÂÆö"})]})]})})}),y.jsx("main",{children:y.jsxs(r,{children:[y.jsx(l,{path:"/",element:y.jsx(Ht,{})}),y.jsx(l,{path:"/projects",element:y.jsx(Jt,{})}),y.jsx(l,{path:"/wbs",element:y.jsx(Qt,{})}),y.jsx(l,{path:"/wbs/tree",element:y.jsx(Zt,{})}),y.jsx(l,{path:"/dependencies",element:y.jsx(ts,{})}),y.jsx(l,{path:"/pending",element:y.jsx(ns,{})}),y.jsx(l,{path:"/issues",element:y.jsx(ls,{})}),y.jsx(l,{path:"/gantt",element:y.jsx(cs,{})}),y.jsx(l,{path:"/backup",element:y.jsx(ds,{})}),y.jsx(l,{path:"/settings",element:y.jsx(os,{})})]})})]})})}f.createRoot(document.getElementById("root")).render(y.jsx(i.StrictMode,{children:y.jsx(xs,{})}));
